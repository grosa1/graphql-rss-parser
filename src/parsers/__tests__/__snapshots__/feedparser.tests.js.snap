// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`should parse string from google.blogspot.com/feeds/posts/default 1`] = `
Object {
  "#ns": Array [
    Object {
      "xmlns": "http://www.w3.org/2005/Atom",
    },
    Object {
      "xmlns:opensearch": "http://a9.com/-/spec/opensearchrss/1.0/",
    },
    Object {
      "xmlns:blogger": "http://schemas.google.com/blogger/2008",
    },
    Object {
      "xmlns:georss": "http://www.georss.org/georss",
    },
    Object {
      "xmlns:gd": "http://schemas.google.com/g/2005",
    },
    Object {
      "xmlns:thr": "http://purl.org/syndication/thread/1.0",
    },
    Object {
      "xmlns:media": "http://search.yahoo.com/mrss/",
    },
  ],
  "#type": "atom",
  "#version": "1.0",
  "#xml": Object {
    "encoding": "UTF-8",
    "version": "1.0",
  },
  "@": Array [
    Object {
      "xmlns": "http://www.w3.org/2005/Atom",
    },
    Object {
      "xmlns:opensearch": "http://a9.com/-/spec/opensearchrss/1.0/",
    },
    Object {
      "xmlns:blogger": "http://schemas.google.com/blogger/2008",
    },
    Object {
      "xmlns:georss": "http://www.georss.org/georss",
    },
    Object {
      "xmlns:gd": "http://schemas.google.com/g/2005",
    },
    Object {
      "xmlns:thr": "http://purl.org/syndication/thread/1.0",
    },
  ],
  "atom:@": Object {
    "xmlns": "http://www.w3.org/2005/Atom",
    "xmlns:blogger": "http://schemas.google.com/blogger/2008",
    "xmlns:gd": "http://schemas.google.com/g/2005",
    "xmlns:georss": "http://www.georss.org/georss",
    "xmlns:opensearch": "http://a9.com/-/spec/opensearchrss/1.0/",
    "xmlns:thr": "http://purl.org/syndication/thread/1.0",
  },
  "atom:author": Object {
    "@": Object {},
    "email": Object {
      "#": "noreply@blogger.com",
      "@": Object {},
    },
    "gd:image": Object {
      "@": Object {
        "height": "32",
        "rel": "http://schemas.google.com/g/2005#thumbnail",
        "src": "http://3.bp.blogspot.com/_YA50adQ-7vQ/S1gfIm66ItI/AAAAAAAAAAM/afcQKdbbZaU/S220/brett.png",
        "width": "32",
      },
    },
    "name": Object {
      "#": "Brett Wiltshire",
      "@": Object {},
    },
    "uri": Object {
      "#": "http://www.blogger.com/profile/01430672582309320414",
      "@": Object {},
    },
  },
  "atom:generator": Object {
    "#": "Blogger",
    "@": Object {
      "uri": "http://www.blogger.com",
      "version": "7.00",
    },
  },
  "atom:id": Object {
    "#": "tag:blogger.com,1999:blog-2120328063286836889",
    "@": Object {},
  },
  "atom:link": Array [
    Object {
      "@": Object {
        "href": "http://google.blogspot.com/feeds/posts/default",
        "rel": "http://schemas.google.com/g/2005#feed",
        "type": "application/atom+xml",
      },
    },
    Object {
      "@": Object {
        "href": "http://www.blogger.com/feeds/2120328063286836889/posts/default",
        "rel": "self",
        "type": "application/atom+xml",
      },
    },
    Object {
      "@": Object {
        "href": "http://google.blogspot.com/",
        "rel": "alternate",
        "type": "text/html",
      },
    },
    Object {
      "@": Object {
        "href": "http://pubsubhubbub.appspot.com/",
        "rel": "hub",
      },
    },
  ],
  "atom:subtitle": Object {
    "@": Object {
      "type": "html",
    },
  },
  "atom:title": Object {
    "#": "Google on BlogSpot",
    "@": Object {
      "type": "text",
    },
  },
  "atom:updated": Object {
    "#": "2020-09-29T03:08:22.029-07:00",
    "@": Object {},
  },
  "author": "Brett Wiltshire",
  "categories": Array [],
  "cloud": Object {
    "href": "http://pubsubhubbub.appspot.com/",
    "type": "hub",
  },
  "copyright": null,
  "date": 2020-09-29T10:08:22.029Z,
  "description": null,
  "entries": Array [
    Object {
      "atom:@": Object {},
      "atom:author": Object {
        "@": Object {},
        "email": Object {
          "#": "noreply@blogger.com",
          "@": Object {},
        },
        "gd:image": Object {
          "@": Object {
            "height": "32",
            "rel": "http://schemas.google.com/g/2005#thumbnail",
            "src": "http://3.bp.blogspot.com/_YA50adQ-7vQ/S1gfIm66ItI/AAAAAAAAAAM/afcQKdbbZaU/S220/brett.png",
            "width": "32",
          },
        },
        "name": Object {
          "#": "Brett Wiltshire",
          "@": Object {},
        },
        "uri": Object {
          "#": "http://www.blogger.com/profile/01430672582309320414",
          "@": Object {},
        },
      },
      "atom:content": Object {
        "#": "<i>Posted by Brett Wiltshire, Blogger CEO</i><br /><br />This morning we’re beyond thrilled to announce that Blogger has signed a definitive agreement to be acquired by Google, the Internet search company. This is exciting news not only for all of us on the Blogger team, but for our users, our partners, and most importantly -- the blogosphere itself. <br /><br />Understandably, you probably have lots of questions about what this means for Blogger and Blogger users. Below, we've put together some initial answers to many of the biggest questions. More info will be available as we figure it out. Thanks for your support as we transfer into this next exciting phase. &nbsp; <br /><br /><br /><b>Q: Why did Blogger sell to Google?</b><br />A: Well, on the surface, it may look obvious: A company of Google's size could give Blogger the resources we needed to do things better, faster, bigger. It's been a long eleven+ years since we started the company, and not all of them were very fun. We had been making serious progress over the last year or so, but bootstrapping (growing without funding) is always a slow process, and we were a long way from where we wanted to be. We wanted to offer a better service. And with Google, it wasn't just their size, of course. They had clearly done an incredible job building their technology and business, and we'd been big fans. <br /><br />However, that doesn't mean it was an easy decision. We'd seen many small companies doing interesting things die (or at least become uninteresting) after getting acquired. It was only after becoming convinced that: a) There were sensible, cool, powerful things we could do on the technology/product side with Google that we couldn't do otherwise; and b) It was a good company, run by people we liked, who wanted the same things we did (i.e., they wouldn't screw up Blogger or make our lives miserable). <br /><br />We became convinced both of these were the case rather quickly after thinking about the product side and talking to lots of Googlers. &nbsp; Also, Google liked our logo. And we liked their food. <br /><br /><b>Q: Will Blogger go away?&nbsp;</b><br />A: Nope. Blogger is going to maintain its branding and services. While we may integrate with Google in certain areas there will always be a Blogger. <br /><br /><b>Q: What does the acquisition mean to Blogger users?&nbsp;</b><br />A: Greater reliability, new innovative products and a whole lot more that we aren't ready to share quite yet (truth is, we're still figuring a lot of it out). Right now, we're mostly bolstering up our hardware -- making things faster and more reliable -- and getting settled. Next, we're going to be working on some killer ideas we've been wanting to implement for years. It'll be fun. <br /><br /><b>Q: Will there be any changes to my account?&nbsp;</b><br />A: Not right now but if anything does change we will notify you ahead of time, as we've done in the past.<br /><br /><b>Q: Will there be any changes to the Blogger products?&nbsp;</b><br />A: We will be making some changes in our product line. We've been working on a new version of Blogger for some time now that will be coming out soon. We'll tell you more as soon as we know. <br /><br /><b>Q: What are your plans for the future?&nbsp;</b><br />A: We are building a nuclear powered... Wait, you almost had us. We aren't telling, yet! But we will have more in a few weeks. <br /><br /><b>Q: Does this mean my blog will rank higher in Google search results?&nbsp;</b><br />A: Nope. It does mean your blog might be stored physically closer to Google but that's about it. The people at Google have done a great job over the years making sure their search results are honest and objective and there's no reason they would change that policy for Blogger or anyone else. <br /><br /><b>Q: What will happen to all the nice kids that work on Blogger?&nbsp;</b><br />A: We’ll still be working on Blogger and making it better. <br /><br /><b>Q: Are you still as handsome as ever?&nbsp;</b><br />A:<br /><div class=\\"separator\\" style=\\"clear: both; text-align: center;\\"><a href=\\"http://1.bp.blogspot.com/_UUTay7LUoq0/TXVACrMZNOI/AAAAAAAAADI/_WWawmSQnIM/s1600/_MG_1538.jpg\\" imageanchor=\\"1\\" style=\\"margin-left: 1em; margin-right: 1em;\\"><img border=\\"0\\" src=\\"http://1.bp.blogspot.com/_UUTay7LUoq0/TXVACrMZNOI/AAAAAAAAADI/_WWawmSQnIM/s400/_MG_1538.jpg\\" width=\\"500\\" /></a></div>",
        "@": Object {
          "type": "html",
        },
      },
      "atom:id": Object {
        "#": "tag:blogger.com,1999:blog-2120328063286836889.post-7340716506563491347",
        "@": Object {},
      },
      "atom:link": Array [
        Object {
          "@": Object {
            "href": "http://google.blogspot.com/feeds/7340716506563491347/comments/default",
            "rel": "replies",
            "title": "Post Comments",
            "type": "application/atom+xml",
          },
        },
        Object {
          "@": Object {
            "href": "http://google.blogspot.com/2011/04/google-to-acquire-blogger.html#comment-form",
            "rel": "replies",
            "title": "20 Comments",
            "type": "text/html",
          },
        },
        Object {
          "@": Object {
            "href": "http://www.blogger.com/feeds/2120328063286836889/posts/default/7340716506563491347",
            "rel": "edit",
            "type": "application/atom+xml",
          },
        },
        Object {
          "@": Object {
            "href": "http://www.blogger.com/feeds/2120328063286836889/posts/default/7340716506563491347",
            "rel": "self",
            "type": "application/atom+xml",
          },
        },
        Object {
          "@": Object {
            "href": "http://google.blogspot.com/2011/04/google-to-acquire-blogger.html",
            "rel": "alternate",
            "title": "Google to Acquire Blogger",
            "type": "text/html",
          },
        },
      ],
      "atom:published": Object {
        "#": "2011-04-01T08:06:00.000-07:00",
        "@": Object {},
      },
      "atom:title": Object {
        "#": "Google to Acquire Blogger",
        "@": Object {
          "type": "text",
        },
      },
      "atom:updated": Object {
        "#": "2011-04-01T08:13:07.987-07:00",
        "@": Object {},
      },
      "author": "Brett Wiltshire",
      "categories": Array [],
      "comments": "http://google.blogspot.com/2011/04/google-to-acquire-blogger.html#comment-form",
      "date": 2011-04-01T15:13:07.987Z,
      "description": "<i>Posted by Brett Wiltshire, Blogger CEO</i><br /><br />This morning we’re beyond thrilled to announce that Blogger has signed a definitive agreement to be acquired by Google, the Internet search company. This is exciting news not only for all of us on the Blogger team, but for our users, our partners, and most importantly -- the blogosphere itself. <br /><br />Understandably, you probably have lots of questions about what this means for Blogger and Blogger users. Below, we've put together some initial answers to many of the biggest questions. More info will be available as we figure it out. Thanks for your support as we transfer into this next exciting phase. &nbsp; <br /><br /><br /><b>Q: Why did Blogger sell to Google?</b><br />A: Well, on the surface, it may look obvious: A company of Google's size could give Blogger the resources we needed to do things better, faster, bigger. It's been a long eleven+ years since we started the company, and not all of them were very fun. We had been making serious progress over the last year or so, but bootstrapping (growing without funding) is always a slow process, and we were a long way from where we wanted to be. We wanted to offer a better service. And with Google, it wasn't just their size, of course. They had clearly done an incredible job building their technology and business, and we'd been big fans. <br /><br />However, that doesn't mean it was an easy decision. We'd seen many small companies doing interesting things die (or at least become uninteresting) after getting acquired. It was only after becoming convinced that: a) There were sensible, cool, powerful things we could do on the technology/product side with Google that we couldn't do otherwise; and b) It was a good company, run by people we liked, who wanted the same things we did (i.e., they wouldn't screw up Blogger or make our lives miserable). <br /><br />We became convinced both of these were the case rather quickly after thinking about the product side and talking to lots of Googlers. &nbsp; Also, Google liked our logo. And we liked their food. <br /><br /><b>Q: Will Blogger go away?&nbsp;</b><br />A: Nope. Blogger is going to maintain its branding and services. While we may integrate with Google in certain areas there will always be a Blogger. <br /><br /><b>Q: What does the acquisition mean to Blogger users?&nbsp;</b><br />A: Greater reliability, new innovative products and a whole lot more that we aren't ready to share quite yet (truth is, we're still figuring a lot of it out). Right now, we're mostly bolstering up our hardware -- making things faster and more reliable -- and getting settled. Next, we're going to be working on some killer ideas we've been wanting to implement for years. It'll be fun. <br /><br /><b>Q: Will there be any changes to my account?&nbsp;</b><br />A: Not right now but if anything does change we will notify you ahead of time, as we've done in the past.<br /><br /><b>Q: Will there be any changes to the Blogger products?&nbsp;</b><br />A: We will be making some changes in our product line. We've been working on a new version of Blogger for some time now that will be coming out soon. We'll tell you more as soon as we know. <br /><br /><b>Q: What are your plans for the future?&nbsp;</b><br />A: We are building a nuclear powered... Wait, you almost had us. We aren't telling, yet! But we will have more in a few weeks. <br /><br /><b>Q: Does this mean my blog will rank higher in Google search results?&nbsp;</b><br />A: Nope. It does mean your blog might be stored physically closer to Google but that's about it. The people at Google have done a great job over the years making sure their search results are honest and objective and there's no reason they would change that policy for Blogger or anyone else. <br /><br /><b>Q: What will happen to all the nice kids that work on Blogger?&nbsp;</b><br />A: We’ll still be working on Blogger and making it better. <br /><br /><b>Q: Are you still as handsome as ever?&nbsp;</b><br />A:<br /><div class=\\"separator\\" style=\\"clear: both; text-align: center;\\"><a href=\\"http://1.bp.blogspot.com/_UUTay7LUoq0/TXVACrMZNOI/AAAAAAAAADI/_WWawmSQnIM/s1600/_MG_1538.jpg\\" imageanchor=\\"1\\" style=\\"margin-left: 1em; margin-right: 1em;\\"><img border=\\"0\\" src=\\"http://1.bp.blogspot.com/_UUTay7LUoq0/TXVACrMZNOI/AAAAAAAAADI/_WWawmSQnIM/s400/_MG_1538.jpg\\" width=\\"500\\" /></a></div>",
      "enclosures": Array [],
      "guid": "tag:blogger.com,1999:blog-2120328063286836889.post-7340716506563491347",
      "image": Object {
        "url": "http://1.bp.blogspot.com/_UUTay7LUoq0/TXVACrMZNOI/AAAAAAAAADI/_WWawmSQnIM/s72-c/_MG_1538.jpg",
      },
      "link": "http://google.blogspot.com/2011/04/google-to-acquire-blogger.html",
      "media:thumbnail": Object {
        "@": Object {
          "height": "72",
          "url": "http://1.bp.blogspot.com/_UUTay7LUoq0/TXVACrMZNOI/AAAAAAAAADI/_WWawmSQnIM/s72-c/_MG_1538.jpg",
          "width": "72",
          "xmlns:media": "http://search.yahoo.com/mrss/",
        },
      },
      "origlink": null,
      "pubDate": "2011-04-01T15:06:00.000Z",
      "pubdate": 2011-04-01T15:06:00.000Z,
      "source": Object {},
      "summary": null,
      "thr:total": Object {
        "#": "20",
        "@": Object {},
      },
      "title": "Google to Acquire Blogger",
    },
  ],
  "favicon": null,
  "generator": "Blogger v7.00 (http://www.blogger.com)",
  "image": Object {},
  "language": null,
  "link": "http://google.blogspot.com/",
  "opensearch:itemsperpage": Object {
    "#": "25",
    "@": Object {},
  },
  "opensearch:startindex": Object {
    "#": "1",
    "@": Object {},
  },
  "opensearch:totalresults": Object {
    "#": "1",
    "@": Object {},
  },
  "parser": "FEEDPARSER",
  "pubDate": 2020-09-29T10:08:22.029Z,
  "pubdate": 2020-09-29T10:08:22.029Z,
  "title": "Google on BlogSpot",
  "xmlUrl": "http://www.blogger.com/feeds/2120328063286836889/posts/default",
  "xmlurl": "http://www.blogger.com/feeds/2120328063286836889/posts/default",
}
`;

exports[`should parse string from rolflekang.com/feed.xml 1`] = `
Object {
  "#ns": Array [
    Object {
      "xmlns:dc": "http://purl.org/dc/elements/1.1/",
    },
    Object {
      "xmlns:content": "http://purl.org/rss/1.0/modules/content/",
    },
    Object {
      "xmlns:atom": "http://www.w3.org/2005/Atom",
    },
  ],
  "#type": "rss",
  "#version": "2.0",
  "#xml": Object {
    "encoding": "UTF-8",
    "version": "1.0",
  },
  "@": Array [
    Object {
      "xmlns:dc": "http://purl.org/dc/elements/1.1/",
    },
    Object {
      "xmlns:content": "http://purl.org/rss/1.0/modules/content/",
    },
    Object {
      "xmlns:atom": "http://www.w3.org/2005/Atom",
    },
  ],
  "author": null,
  "categories": Array [],
  "cloud": Object {},
  "copyright": null,
  "date": 2020-09-12T14:51:45.000Z,
  "description": "Writing by Rolf Erik Lekang",
  "entries": Array [
    Object {
      "author": undefined,
      "categories": Array [
        "ansible",
        "devops",
        "ops",
        "infrastructure-as-code",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>Recently I have been dusting of my old ansible playbooks that I use to deploy personal
stuff. Everything from side projects like <a href=\\"https://feedhuddler.com\\">feedhuddler.com</a> to the unifi controller for
my home network. In that setup I have a projects role that takes a list of projects and
deploy them either running directly on the host with systemd services or docker containers.
The systemd setup was using a task to restart the service after changing them. I wanted to
change this to be done with a handler instead. However, handlers does not accept arguments.
The posts describes a workaround for that problem, enabling dynamic use of handlers.</p>
<p>First let us look at what a handler is and how it differs from a task. The handlers are
actions that can be triggered by other tasks. On a task you can define which handlers they
should trigger. Very useful for things like \\"Configuration file was updated so we want to restart
an application\\". A nice feature is that these handlers are triggered at the end of the playbook,
and they only run once. Thus, if you have 5 tasks that triggers the same handler it will only
run once at the end.</p>
<p>The problem at hand is that handlers does not accept any arguments. Thus, when a task have a loop
going through a list of projects it is not straight forward how to be able to keep one handler for
all these services. Below is an example setup, we will be looking at single file playbooks to make
it easier to follow the changes that would usually be across different files in roles.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"yml\\"><pre class=\\"language-yml\\"><code class=\\"language-yml\\"><span class=\\"token punctuation\\">---</span>
<span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">hosts</span><span class=\\"token punctuation\\">:</span> all
  <span class=\\"token key atrule\\">vars</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token key atrule\\">projects</span><span class=\\"token punctuation\\">:</span>
      <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> super<span class=\\"token punctuation\\">-</span>project
        <span class=\\"token key atrule\\">port</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">4000</span>
      <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> not<span class=\\"token punctuation\\">-</span>so<span class=\\"token punctuation\\">-</span>super<span class=\\"token punctuation\\">-</span>project
        <span class=\\"token key atrule\\">port</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">5000</span>
  <span class=\\"token key atrule\\">tasks</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'Create systemd config for {{ item.name }}'</span>
      <span class=\\"token key atrule\\">loop</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'{{ projects }}'</span>
      <span class=\\"token key atrule\\">template</span><span class=\\"token punctuation\\">:</span>
        <span class=\\"token key atrule\\">src</span><span class=\\"token punctuation\\">:</span> web.service.jinja2
        <span class=\\"token key atrule\\">dest</span><span class=\\"token punctuation\\">:</span> /etc/systemd/system/<span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">{</span> item.name <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">}</span>.service
        <span class=\\"token key atrule\\">owner</span><span class=\\"token punctuation\\">:</span> root
        <span class=\\"token key atrule\\">group</span><span class=\\"token punctuation\\">:</span> root
      <span class=\\"token key atrule\\">notify</span><span class=\\"token punctuation\\">:</span>
        <span class=\\"token punctuation\\">-</span> reload systemd
        <span class=\\"token punctuation\\">-</span> <span class=\\"token string\\">'restart {{ item.name }}'</span>

  <span class=\\"token key atrule\\">handlers</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> reload systemd
      <span class=\\"token key atrule\\">systemd</span><span class=\\"token punctuation\\">:</span>
        <span class=\\"token key atrule\\">daemon_reload</span><span class=\\"token punctuation\\">:</span> yes
    <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> restart super<span class=\\"token punctuation\\">-</span>project
      <span class=\\"token key atrule\\">service</span><span class=\\"token punctuation\\">:</span>
        <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'{{ item }}'</span>
        <span class=\\"token key atrule\\">state</span><span class=\\"token punctuation\\">:</span> restarted
    <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> restart not<span class=\\"token punctuation\\">-</span>so<span class=\\"token punctuation\\">-</span>super<span class=\\"token punctuation\\">-</span>project
      <span class=\\"token key atrule\\">service</span><span class=\\"token punctuation\\">:</span>
        <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'{{ item }}'</span>
        <span class=\\"token key atrule\\">state</span><span class=\\"token punctuation\\">:</span> restarted</code></pre></div>
<p>This works, but when adding a new project it is necessary to add a new handler. This is not the end of
the world. However, I do not touch this code very often and when I do it is usually because I need to
change the configuration for a service or add a new service. Thus, it would be nice to be able to that without
editing the role every time.</p>
<p>There is another feature in ansible we can use to work around the fact that handlers does not support
arguments. Each task has the ability to store the result in a variable, and if the task has a loop that
variable will be a list of these results. This is done by adding <code class=\\"language-text\\">register: variable_name</code> to the task.
Even though handlers does not work with arguments, it has access to the global variable scope. This means
we can make a handler looping over the result and restart the services. See the highlighted changes below.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"yml\\"><pre class=\\"language-yml\\"><code class=\\"language-yml\\"><span class=\\"token punctuation\\">---</span>
<span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">hosts</span><span class=\\"token punctuation\\">:</span> all
  <span class=\\"token key atrule\\">vars</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token key atrule\\">projects</span><span class=\\"token punctuation\\">:</span>
      <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> super<span class=\\"token punctuation\\">-</span>project
        <span class=\\"token key atrule\\">port</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">4000</span>
      <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> not<span class=\\"token punctuation\\">-</span>so<span class=\\"token punctuation\\">-</span>super<span class=\\"token punctuation\\">-</span>project
        <span class=\\"token key atrule\\">port</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">5000</span>
  <span class=\\"token key atrule\\">tasks</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> Create systemd config for projects
      <span class=\\"token key atrule\\">loop</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'{{ projects }}'</span>
      <span class=\\"token key atrule\\">template</span><span class=\\"token punctuation\\">:</span>
        <span class=\\"token key atrule\\">src</span><span class=\\"token punctuation\\">:</span> web.service.jinja2
        <span class=\\"token key atrule\\">dest</span><span class=\\"token punctuation\\">:</span> /etc/systemd/system/<span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">{</span> item.name <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">}</span>.service
        <span class=\\"token key atrule\\">owner</span><span class=\\"token punctuation\\">:</span> root
        <span class=\\"token key atrule\\">group</span><span class=\\"token punctuation\\">:</span> root
<span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token key atrule\\">register</span><span class=\\"token punctuation\\">:</span> systemd_projects</span>      <span class=\\"token key atrule\\">notify</span><span class=\\"token punctuation\\">:</span>
        <span class=\\"token punctuation\\">-</span> reload systemd
<span class=\\"gatsby-highlight-code-line\\">        <span class=\\"token punctuation\\">-</span> restart systemd projects</span>
  <span class=\\"token key atrule\\">handlers</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> reload systemd
      <span class=\\"token key atrule\\">systemd</span><span class=\\"token punctuation\\">:</span>
        <span class=\\"token key atrule\\">daemon_reload</span><span class=\\"token punctuation\\">:</span> yes
<span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> restart systemd projects</span><span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token key atrule\\">loop</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">\\"{{ systemd_projects.results | selectattr('changed', 'equalto', true) | map(attribute='item') | map(attribute='name') | list }}\\"</span></span><span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token key atrule\\">service</span><span class=\\"token punctuation\\">:</span></span><span class=\\"gatsby-highlight-code-line\\">        <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'{{ item }}'</span></span><span class=\\"gatsby-highlight-code-line\\">        <span class=\\"token key atrule\\">state</span><span class=\\"token punctuation\\">:</span> restarted</span></code></pre></div>
<p>The playbook now have one handler for restarting the projects: <code class=\\"language-text\\">restart systemd projects</code>. Let's have a closer look
at the loop for that handler. <code class=\\"language-text\\">systemd_projects.results</code> is the result list from the task above creating the
systemd service files. <code class=\\"language-text\\">selectattr(&#39;changed&#39;, &#39;equalto&#39;, true)</code> is a filter that will select only the items
in the list that has a property changed set to true. The two next filters <code class=\\"language-text\\">map(attribute=&#39;item&#39;) | map(attribute=&#39;name&#39;)</code>
maps the items to certain attributes. The last filter <code class=\\"language-text\\">list</code> converts a generator into a list.</p>
<p>This means that this list</p>
<div class=\\"gatsby-highlight\\" data-language=\\"json\\"><pre class=\\"language-json\\"><code class=\\"language-json\\"><span class=\\"token punctuation\\">[</span>
  <span class=\\"token punctuation\\">{</span> <span class=\\"token property\\">\\"changed\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token boolean\\">true</span><span class=\\"token punctuation\\">,</span> <span class=\\"token property\\">\\"item\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">{</span> <span class=\\"token property\\">\\"name\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"super-project\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token property\\">\\"port\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token number\\">4000</span> <span class=\\"token punctuation\\">}</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token punctuation\\">{</span> <span class=\\"token property\\">\\"changed\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token boolean\\">false</span><span class=\\"token punctuation\\">,</span> <span class=\\"token property\\">\\"item\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">{</span> <span class=\\"token property\\">\\"name\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"not-so-super-project\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token property\\">\\"port\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token number\\">5000</span> <span class=\\"token punctuation\\">}</span> <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">]</span></code></pre></div>
<p>would turn into</p>
<div class=\\"gatsby-highlight\\" data-language=\\"json\\"><pre class=\\"language-json\\"><code class=\\"language-json\\"><span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"super-project\\"</span><span class=\\"token punctuation\\">]</span></code></pre></div>
<p>which in turn would result in the handler running</p>
<div class=\\"gatsby-highlight\\" data-language=\\"yml\\"><pre class=\\"language-yml\\"><code class=\\"language-yml\\"><span class=\\"token key atrule\\">service</span><span class=\\"token punctuation\\">:</span>
  <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> super<span class=\\"token punctuation\\">-</span>project
  <span class=\\"token key atrule\\">state</span><span class=\\"token punctuation\\">:</span> restarted</code></pre></div>
<p>In other words, we have a dynamic handler that can restart services based on changes so that we can
focus on only the configuration whenever there is a new side-project to deploy.</p>",
        "@": Object {},
      },
      "date": 2020-09-12T00:00:00.000Z,
      "description": "<p>Recently I have been dusting of my old ansible playbooks that I use to deploy personal
stuff. Everything from side projects like <a href=\\"https://feedhuddler.com\\">feedhuddler.com</a> to the unifi controller for
my home network. In that setup I have a projects role that takes a list of projects and
deploy them either running directly on the host with systemd services or docker containers.
The systemd setup was using a task to restart the service after changing them. I wanted to
change this to be done with a handler instead. However, handlers does not accept arguments.
The posts describes a workaround for that problem, enabling dynamic use of handlers.</p>
<p>First let us look at what a handler is and how it differs from a task. The handlers are
actions that can be triggered by other tasks. On a task you can define which handlers they
should trigger. Very useful for things like \\"Configuration file was updated so we want to restart
an application\\". A nice feature is that these handlers are triggered at the end of the playbook,
and they only run once. Thus, if you have 5 tasks that triggers the same handler it will only
run once at the end.</p>
<p>The problem at hand is that handlers does not accept any arguments. Thus, when a task have a loop
going through a list of projects it is not straight forward how to be able to keep one handler for
all these services. Below is an example setup, we will be looking at single file playbooks to make
it easier to follow the changes that would usually be across different files in roles.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"yml\\"><pre class=\\"language-yml\\"><code class=\\"language-yml\\"><span class=\\"token punctuation\\">---</span>
<span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">hosts</span><span class=\\"token punctuation\\">:</span> all
  <span class=\\"token key atrule\\">vars</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token key atrule\\">projects</span><span class=\\"token punctuation\\">:</span>
      <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> super<span class=\\"token punctuation\\">-</span>project
        <span class=\\"token key atrule\\">port</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">4000</span>
      <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> not<span class=\\"token punctuation\\">-</span>so<span class=\\"token punctuation\\">-</span>super<span class=\\"token punctuation\\">-</span>project
        <span class=\\"token key atrule\\">port</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">5000</span>
  <span class=\\"token key atrule\\">tasks</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'Create systemd config for {{ item.name }}'</span>
      <span class=\\"token key atrule\\">loop</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'{{ projects }}'</span>
      <span class=\\"token key atrule\\">template</span><span class=\\"token punctuation\\">:</span>
        <span class=\\"token key atrule\\">src</span><span class=\\"token punctuation\\">:</span> web.service.jinja2
        <span class=\\"token key atrule\\">dest</span><span class=\\"token punctuation\\">:</span> /etc/systemd/system/<span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">{</span> item.name <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">}</span>.service
        <span class=\\"token key atrule\\">owner</span><span class=\\"token punctuation\\">:</span> root
        <span class=\\"token key atrule\\">group</span><span class=\\"token punctuation\\">:</span> root
      <span class=\\"token key atrule\\">notify</span><span class=\\"token punctuation\\">:</span>
        <span class=\\"token punctuation\\">-</span> reload systemd
        <span class=\\"token punctuation\\">-</span> <span class=\\"token string\\">'restart {{ item.name }}'</span>

  <span class=\\"token key atrule\\">handlers</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> reload systemd
      <span class=\\"token key atrule\\">systemd</span><span class=\\"token punctuation\\">:</span>
        <span class=\\"token key atrule\\">daemon_reload</span><span class=\\"token punctuation\\">:</span> yes
    <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> restart super<span class=\\"token punctuation\\">-</span>project
      <span class=\\"token key atrule\\">service</span><span class=\\"token punctuation\\">:</span>
        <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'{{ item }}'</span>
        <span class=\\"token key atrule\\">state</span><span class=\\"token punctuation\\">:</span> restarted
    <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> restart not<span class=\\"token punctuation\\">-</span>so<span class=\\"token punctuation\\">-</span>super<span class=\\"token punctuation\\">-</span>project
      <span class=\\"token key atrule\\">service</span><span class=\\"token punctuation\\">:</span>
        <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'{{ item }}'</span>
        <span class=\\"token key atrule\\">state</span><span class=\\"token punctuation\\">:</span> restarted</code></pre></div>
<p>This works, but when adding a new project it is necessary to add a new handler. This is not the end of
the world. However, I do not touch this code very often and when I do it is usually because I need to
change the configuration for a service or add a new service. Thus, it would be nice to be able to that without
editing the role every time.</p>
<p>There is another feature in ansible we can use to work around the fact that handlers does not support
arguments. Each task has the ability to store the result in a variable, and if the task has a loop that
variable will be a list of these results. This is done by adding <code class=\\"language-text\\">register: variable_name</code> to the task.
Even though handlers does not work with arguments, it has access to the global variable scope. This means
we can make a handler looping over the result and restart the services. See the highlighted changes below.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"yml\\"><pre class=\\"language-yml\\"><code class=\\"language-yml\\"><span class=\\"token punctuation\\">---</span>
<span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">hosts</span><span class=\\"token punctuation\\">:</span> all
  <span class=\\"token key atrule\\">vars</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token key atrule\\">projects</span><span class=\\"token punctuation\\">:</span>
      <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> super<span class=\\"token punctuation\\">-</span>project
        <span class=\\"token key atrule\\">port</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">4000</span>
      <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> not<span class=\\"token punctuation\\">-</span>so<span class=\\"token punctuation\\">-</span>super<span class=\\"token punctuation\\">-</span>project
        <span class=\\"token key atrule\\">port</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">5000</span>
  <span class=\\"token key atrule\\">tasks</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> Create systemd config for projects
      <span class=\\"token key atrule\\">loop</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'{{ projects }}'</span>
      <span class=\\"token key atrule\\">template</span><span class=\\"token punctuation\\">:</span>
        <span class=\\"token key atrule\\">src</span><span class=\\"token punctuation\\">:</span> web.service.jinja2
        <span class=\\"token key atrule\\">dest</span><span class=\\"token punctuation\\">:</span> /etc/systemd/system/<span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">{</span> item.name <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">}</span>.service
        <span class=\\"token key atrule\\">owner</span><span class=\\"token punctuation\\">:</span> root
        <span class=\\"token key atrule\\">group</span><span class=\\"token punctuation\\">:</span> root
<span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token key atrule\\">register</span><span class=\\"token punctuation\\">:</span> systemd_projects</span>      <span class=\\"token key atrule\\">notify</span><span class=\\"token punctuation\\">:</span>
        <span class=\\"token punctuation\\">-</span> reload systemd
<span class=\\"gatsby-highlight-code-line\\">        <span class=\\"token punctuation\\">-</span> restart systemd projects</span>
  <span class=\\"token key atrule\\">handlers</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> reload systemd
      <span class=\\"token key atrule\\">systemd</span><span class=\\"token punctuation\\">:</span>
        <span class=\\"token key atrule\\">daemon_reload</span><span class=\\"token punctuation\\">:</span> yes
<span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> restart systemd projects</span><span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token key atrule\\">loop</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">\\"{{ systemd_projects.results | selectattr('changed', 'equalto', true) | map(attribute='item') | map(attribute='name') | list }}\\"</span></span><span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token key atrule\\">service</span><span class=\\"token punctuation\\">:</span></span><span class=\\"gatsby-highlight-code-line\\">        <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">'{{ item }}'</span></span><span class=\\"gatsby-highlight-code-line\\">        <span class=\\"token key atrule\\">state</span><span class=\\"token punctuation\\">:</span> restarted</span></code></pre></div>
<p>The playbook now have one handler for restarting the projects: <code class=\\"language-text\\">restart systemd projects</code>. Let's have a closer look
at the loop for that handler. <code class=\\"language-text\\">systemd_projects.results</code> is the result list from the task above creating the
systemd service files. <code class=\\"language-text\\">selectattr(&#39;changed&#39;, &#39;equalto&#39;, true)</code> is a filter that will select only the items
in the list that has a property changed set to true. The two next filters <code class=\\"language-text\\">map(attribute=&#39;item&#39;) | map(attribute=&#39;name&#39;)</code>
maps the items to certain attributes. The last filter <code class=\\"language-text\\">list</code> converts a generator into a list.</p>
<p>This means that this list</p>
<div class=\\"gatsby-highlight\\" data-language=\\"json\\"><pre class=\\"language-json\\"><code class=\\"language-json\\"><span class=\\"token punctuation\\">[</span>
  <span class=\\"token punctuation\\">{</span> <span class=\\"token property\\">\\"changed\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token boolean\\">true</span><span class=\\"token punctuation\\">,</span> <span class=\\"token property\\">\\"item\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">{</span> <span class=\\"token property\\">\\"name\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"super-project\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token property\\">\\"port\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token number\\">4000</span> <span class=\\"token punctuation\\">}</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token punctuation\\">{</span> <span class=\\"token property\\">\\"changed\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token boolean\\">false</span><span class=\\"token punctuation\\">,</span> <span class=\\"token property\\">\\"item\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">{</span> <span class=\\"token property\\">\\"name\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"not-so-super-project\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token property\\">\\"port\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token number\\">5000</span> <span class=\\"token punctuation\\">}</span> <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">]</span></code></pre></div>
<p>would turn into</p>
<div class=\\"gatsby-highlight\\" data-language=\\"json\\"><pre class=\\"language-json\\"><code class=\\"language-json\\"><span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"super-project\\"</span><span class=\\"token punctuation\\">]</span></code></pre></div>
<p>which in turn would result in the handler running</p>
<div class=\\"gatsby-highlight\\" data-language=\\"yml\\"><pre class=\\"language-yml\\"><code class=\\"language-yml\\"><span class=\\"token key atrule\\">service</span><span class=\\"token punctuation\\">:</span>
  <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> super<span class=\\"token punctuation\\">-</span>project
  <span class=\\"token key atrule\\">state</span><span class=\\"token punctuation\\">:</span> restarted</code></pre></div>
<p>In other words, we have a dynamic handler that can restart services based on changes so that we can
focus on only the configuration whenever there is a new side-project to deploy.</p>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/ansible-handlers-in-loops",
      "image": Object {},
      "link": "https://rolflekang.com/ansible-handlers-in-loops",
      "origlink": null,
      "pubDate": "2020-09-12T00:00:00.000Z",
      "pubdate": 2020-09-12T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "ansible",
          "@": Object {},
        },
        Object {
          "#": "devops",
          "@": Object {},
        },
        Object {
          "#": "ops",
          "@": Object {},
        },
        Object {
          "#": "infrastructure-as-code",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "Recently I have been dusting of my old ansible playbooks that I use to deploy personal
stuff. Everything from side projects like feedhuddler…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/ansible-handlers-in-loops",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/ansible-handlers-in-loops",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Sat, 12 Sep 2020 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Using Ansible handlers in loops",
        "@": Object {},
      },
      "source": Object {},
      "summary": "Recently I have been dusting of my old ansible playbooks that I use to deploy personal
stuff. Everything from side projects like feedhuddler…",
      "title": "Using Ansible handlers in loops",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "nextjs",
        "javascript",
        "curl",
        "nodejs",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>I have recently been trying out the <a href=\\"https://nextjs.org/\\">Next.js</a> for some projects again. I have
had earlier projects where I have been really happy with Next, but for some time now
<a href=\\"https://www.gatsbyjs.org/\\">Gatsby</a> has been my go to. One of the big things separating these two are that Next
has runtime server side rendering and thought it would be a neat to utilize this to
have separate content-types based on the client. The idea is that if the client is a
CLI based client like <a href=\\"https://curl.haxx.se/\\">curl</a> the server should respond with a plain text response.
This should not be the case if the accept header is set to something specific. The
default accept header in curl is <code class=\\"language-text\\">*/*</code>.</p>
<p>Next has a feature where you can drop in your own http server and still let the
framework handle the rendering. This is helpful in many situations like protecting
things with login or using Next as a part of an already existing application. Below is
a minimal custom server. The highlighted line is where the rendering of the response
is handed of to Next.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"javascript\\"><pre class=\\"language-javascript\\"><code class=\\"language-javascript\\"><span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">{</span> createServer <span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">require</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"http\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">{</span> parse <span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">require</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"url\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">const</span> next <span class=\\"token operator\\">=</span> <span class=\\"token function\\">require</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"next\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token keyword\\">const</span> dev <span class=\\"token operator\\">=</span> process<span class=\\"token punctuation\\">.</span>env<span class=\\"token punctuation\\">.</span><span class=\\"token constant\\">NODE_ENV</span> <span class=\\"token operator\\">!==</span> <span class=\\"token string\\">\\"production\\"</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">const</span> app <span class=\\"token operator\\">=</span> <span class=\\"token function\\">next</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> dev <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">const</span> handle <span class=\\"token operator\\">=</span> app<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getRequestHandler</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">const</span> port <span class=\\"token operator\\">=</span> <span class=\\"token function\\">parseInt</span><span class=\\"token punctuation\\">(</span>process<span class=\\"token punctuation\\">.</span>env<span class=\\"token punctuation\\">.</span><span class=\\"token constant\\">PORT</span> <span class=\\"token operator\\">||</span> <span class=\\"token string\\">\\"3000\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

app<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">prepare</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">then</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">createServer</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">req<span class=\\"token punctuation\\">,</span> res</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">const</span> parsedUrl <span class=\\"token operator\\">=</span> <span class=\\"token function\\">parse</span><span class=\\"token punctuation\\">(</span>req<span class=\\"token punctuation\\">.</span>url<span class=\\"token punctuation\\">,</span> <span class=\\"token boolean\\">true</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token function\\">handle</span><span class=\\"token punctuation\\">(</span>req<span class=\\"token punctuation\\">,</span> res<span class=\\"token punctuation\\">,</span> parsedUrl<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">listen</span><span class=\\"token punctuation\\">(</span>port<span class=\\"token punctuation\\">,</span> <span class=\\"token parameter\\">err</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>err<span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">throw</span> err<span class=\\"token punctuation\\">;</span>
    console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span><span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">> Ready on http://localhost:</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>port<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>This custom server does nothing that the default Next server does not, so putting this
a project does not make very much sense unless one adds something more. That said, if
this is put in <code class=\\"language-text\\">server.js</code> in a Next project running <code class=\\"language-text\\">node server.js</code> in dev and
<code class=\\"language-text\\">NODE_ENV=production node server.js</code> in production should work nicely.</p>
<p>To achieve the custom content type responses without duplicating the content we can
use Next to render the content. Then we will pass it through a npm module that returns
text from HTML. It could also be interesting to do the same with something that returns
markdown if you want to keep more of semantic elements. In order to get the html from
Next we need to give it a fake response that we can read from afterwords. I will admit,
this is a hack, but hey it works. 🤷‍♂️</p>
<div class=\\"gatsby-highlight\\" data-language=\\"javascript\\"><pre class=\\"language-javascript\\"><code class=\\"language-javascript\\"><span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">FakeResponse</span> <span class=\\"token keyword\\">extends</span> <span class=\\"token class-name\\">EventEmitter</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">constructor</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">super</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>headers <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>data <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"\\"</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>

  <span class=\\"token function\\">getHeader</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">key</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>headers<span class=\\"token punctuation\\">[</span>key<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>

  <span class=\\"token function\\">setHeader</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">key<span class=\\"token punctuation\\">,</span> value</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>headers<span class=\\"token punctuation\\">[</span>key<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> value<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>

  <span class=\\"token function\\">write</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">data</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>data <span class=\\"token operator\\">+=</span> data<span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>

  <span class=\\"token function\\">end</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">data</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>data <span class=\\"token operator\\">+=</span> data<span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">emit</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"end\\"</span><span class=\\"token punctuation\\">,</span> data<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>The class above emulates the part of Node's <code class=\\"language-text\\">http.ServerResponse</code> that is needed and emits
<code class=\\"language-text\\">end</code> when the response is done. This makes it possible to get the HTML generated by Next
and the headers set by Next. Below is a function that takes the same arguments as Next's
handle function, but it uses the fake response to get the generated HTML and pass that to
<a href=\\"https://www.npmjs.com/package/html-to-text\\">html-to-text</a>. It also copies all the headers from the fake response to the real response.
<code class=\\"language-text\\">Content-Length</code> and <code class=\\"language-text\\">Content-Type</code> is excluded from this copying since those will be
different from what Next has set.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"javascript\\"><pre class=\\"language-javascript\\"><code class=\\"language-javascript\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">handleWithText</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">req<span class=\\"token punctuation\\">,</span> res<span class=\\"token punctuation\\">,</span> parsedUrl</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> fakeRes <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">FakeResponse</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  fakeRes<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">on</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"end\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token parameter\\">data</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    Object<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">keys</span><span class=\\"token punctuation\\">(</span>fakeRes<span class=\\"token punctuation\\">.</span>headers<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">forEach</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">key</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>key <span class=\\"token operator\\">!==</span> <span class=\\"token string\\">\\"Content-Length\\"</span> <span class=\\"token operator\\">&amp;&amp;</span> key <span class=\\"token operator\\">!==</span> <span class=\\"token string\\">\\"Content-Type\\"</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
        res<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">setHeader</span><span class=\\"token punctuation\\">(</span>key<span class=\\"token punctuation\\">,</span> fakeRes<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getHeader</span><span class=\\"token punctuation\\">(</span>key<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
      <span class=\\"token punctuation\\">}</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    res<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">setHeader</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"Content-Type\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"text/plain\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    res<span class=\\"token punctuation\\">.</span>statusCode <span class=\\"token operator\\">=</span> fakeRes<span class=\\"token punctuation\\">.</span>statusCode <span class=\\"token operator\\">||</span> <span class=\\"token number\\">200</span>
    res<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">end</span><span class=\\"token punctuation\\">(</span>htmlToText<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">fromString</span><span class=\\"token punctuation\\">(</span>data<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token function\\">handle</span><span class=\\"token punctuation\\">(</span>req<span class=\\"token punctuation\\">,</span> fakeRes<span class=\\"token punctuation\\">,</span> parsedUrl<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>With that set up, the custom server code can be changed to the following. The code
below checks the accept header and uses the new <code class=\\"language-text\\">handleWithText</code> function if the
accept header is set to <code class=\\"language-text\\">text/plain</code> or the user agent is <a href=\\"https://curl.haxx.se/\\">curl</a> or <a href=\\"https://httpie.org/\\">httpie</a>,
the two CLI based http clients I know of, with an accept header set to <code class=\\"language-text\\">*/*</code>.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"javascript\\"><pre class=\\"language-javascript\\"><code class=\\"language-javascript\\">app<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">prepare</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">then</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">createServer</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">req<span class=\\"token punctuation\\">,</span> res</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">const</span> parsedUrl <span class=\\"token operator\\">=</span> <span class=\\"token function\\">parse</span><span class=\\"token punctuation\\">(</span>req<span class=\\"token punctuation\\">.</span>url<span class=\\"token punctuation\\">,</span> <span class=\\"token boolean\\">true</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>accept<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span>req<span class=\\"token punctuation\\">.</span>headers<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"accept\\"</span><span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">||</span> <span class=\\"token string\\">\\"\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">split</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\";\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>
      accept <span class=\\"token operator\\">===</span> <span class=\\"token string\\">\\"text/plain\\"</span> <span class=\\"token operator\\">||</span>
      <span class=\\"token punctuation\\">(</span>accept <span class=\\"token operator\\">===</span> <span class=\\"token string\\">\\"*/*\\"</span> <span class=\\"token operator\\">&amp;&amp;</span> <span class=\\"token regex\\">/curl|HTTPie/</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">test</span><span class=\\"token punctuation\\">(</span>req<span class=\\"token punctuation\\">.</span>headers<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"user-agent\\"</span><span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">||</span> <span class=\\"token string\\">\\"\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>
    <span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token function\\">handleWithText</span><span class=\\"token punctuation\\">(</span>req<span class=\\"token punctuation\\">,</span> res<span class=\\"token punctuation\\">,</span> parsedUrl<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">else</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token function\\">handle</span><span class=\\"token punctuation\\">(</span>req<span class=\\"token punctuation\\">,</span> res<span class=\\"token punctuation\\">,</span> parsedUrl<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">listen</span><span class=\\"token punctuation\\">(</span>port<span class=\\"token punctuation\\">,</span> <span class=\\"token parameter\\">err</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>err<span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">throw</span> err<span class=\\"token punctuation\\">;</span>
    console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span><span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">> Ready on http://localhost:</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>port<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>This would result in this output if it would be used on the front page of this website
(which would require me to rewrite it from Gatsby first, but that is another thing).</p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\">$ curl -L rolflekang.com
RL [/]

Hi, I am Rolf

I am an independent software developer who enjoys working
with the whole stack. I occationally write posts [/writing], take photographs
[/photography], ride mountain bikes and snowboards. I do consulting work, if
that is something you are looking I might be able to help out [/hire].</code></pre></div>
<p>This might not be the most useful feature, but it might be neat if your website
contains information that people often would want to get from the terminal. Anyhow,
it is a fun little easter egg. 🐣</p>",
        "@": Object {},
      },
      "date": 2020-05-26T00:00:00.000Z,
      "description": "<p>I have recently been trying out the <a href=\\"https://nextjs.org/\\">Next.js</a> for some projects again. I have
had earlier projects where I have been really happy with Next, but for some time now
<a href=\\"https://www.gatsbyjs.org/\\">Gatsby</a> has been my go to. One of the big things separating these two are that Next
has runtime server side rendering and thought it would be a neat to utilize this to
have separate content-types based on the client. The idea is that if the client is a
CLI based client like <a href=\\"https://curl.haxx.se/\\">curl</a> the server should respond with a plain text response.
This should not be the case if the accept header is set to something specific. The
default accept header in curl is <code class=\\"language-text\\">*/*</code>.</p>
<p>Next has a feature where you can drop in your own http server and still let the
framework handle the rendering. This is helpful in many situations like protecting
things with login or using Next as a part of an already existing application. Below is
a minimal custom server. The highlighted line is where the rendering of the response
is handed of to Next.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"javascript\\"><pre class=\\"language-javascript\\"><code class=\\"language-javascript\\"><span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">{</span> createServer <span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">require</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"http\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">{</span> parse <span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">require</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"url\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">const</span> next <span class=\\"token operator\\">=</span> <span class=\\"token function\\">require</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"next\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token keyword\\">const</span> dev <span class=\\"token operator\\">=</span> process<span class=\\"token punctuation\\">.</span>env<span class=\\"token punctuation\\">.</span><span class=\\"token constant\\">NODE_ENV</span> <span class=\\"token operator\\">!==</span> <span class=\\"token string\\">\\"production\\"</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">const</span> app <span class=\\"token operator\\">=</span> <span class=\\"token function\\">next</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> dev <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">const</span> handle <span class=\\"token operator\\">=</span> app<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getRequestHandler</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">const</span> port <span class=\\"token operator\\">=</span> <span class=\\"token function\\">parseInt</span><span class=\\"token punctuation\\">(</span>process<span class=\\"token punctuation\\">.</span>env<span class=\\"token punctuation\\">.</span><span class=\\"token constant\\">PORT</span> <span class=\\"token operator\\">||</span> <span class=\\"token string\\">\\"3000\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

app<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">prepare</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">then</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">createServer</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">req<span class=\\"token punctuation\\">,</span> res</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">const</span> parsedUrl <span class=\\"token operator\\">=</span> <span class=\\"token function\\">parse</span><span class=\\"token punctuation\\">(</span>req<span class=\\"token punctuation\\">.</span>url<span class=\\"token punctuation\\">,</span> <span class=\\"token boolean\\">true</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token function\\">handle</span><span class=\\"token punctuation\\">(</span>req<span class=\\"token punctuation\\">,</span> res<span class=\\"token punctuation\\">,</span> parsedUrl<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">listen</span><span class=\\"token punctuation\\">(</span>port<span class=\\"token punctuation\\">,</span> <span class=\\"token parameter\\">err</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>err<span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">throw</span> err<span class=\\"token punctuation\\">;</span>
    console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span><span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">> Ready on http://localhost:</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>port<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>This custom server does nothing that the default Next server does not, so putting this
a project does not make very much sense unless one adds something more. That said, if
this is put in <code class=\\"language-text\\">server.js</code> in a Next project running <code class=\\"language-text\\">node server.js</code> in dev and
<code class=\\"language-text\\">NODE_ENV=production node server.js</code> in production should work nicely.</p>
<p>To achieve the custom content type responses without duplicating the content we can
use Next to render the content. Then we will pass it through a npm module that returns
text from HTML. It could also be interesting to do the same with something that returns
markdown if you want to keep more of semantic elements. In order to get the html from
Next we need to give it a fake response that we can read from afterwords. I will admit,
this is a hack, but hey it works. 🤷‍♂️</p>
<div class=\\"gatsby-highlight\\" data-language=\\"javascript\\"><pre class=\\"language-javascript\\"><code class=\\"language-javascript\\"><span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">FakeResponse</span> <span class=\\"token keyword\\">extends</span> <span class=\\"token class-name\\">EventEmitter</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">constructor</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">super</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>headers <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>data <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"\\"</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>

  <span class=\\"token function\\">getHeader</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">key</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>headers<span class=\\"token punctuation\\">[</span>key<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>

  <span class=\\"token function\\">setHeader</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">key<span class=\\"token punctuation\\">,</span> value</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>headers<span class=\\"token punctuation\\">[</span>key<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> value<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>

  <span class=\\"token function\\">write</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">data</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>data <span class=\\"token operator\\">+=</span> data<span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>

  <span class=\\"token function\\">end</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">data</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span>data <span class=\\"token operator\\">+=</span> data<span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">emit</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"end\\"</span><span class=\\"token punctuation\\">,</span> data<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>The class above emulates the part of Node's <code class=\\"language-text\\">http.ServerResponse</code> that is needed and emits
<code class=\\"language-text\\">end</code> when the response is done. This makes it possible to get the HTML generated by Next
and the headers set by Next. Below is a function that takes the same arguments as Next's
handle function, but it uses the fake response to get the generated HTML and pass that to
<a href=\\"https://www.npmjs.com/package/html-to-text\\">html-to-text</a>. It also copies all the headers from the fake response to the real response.
<code class=\\"language-text\\">Content-Length</code> and <code class=\\"language-text\\">Content-Type</code> is excluded from this copying since those will be
different from what Next has set.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"javascript\\"><pre class=\\"language-javascript\\"><code class=\\"language-javascript\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">handleWithText</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">req<span class=\\"token punctuation\\">,</span> res<span class=\\"token punctuation\\">,</span> parsedUrl</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> fakeRes <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token class-name\\">FakeResponse</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  fakeRes<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">on</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"end\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token parameter\\">data</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    Object<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">keys</span><span class=\\"token punctuation\\">(</span>fakeRes<span class=\\"token punctuation\\">.</span>headers<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">forEach</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">key</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>key <span class=\\"token operator\\">!==</span> <span class=\\"token string\\">\\"Content-Length\\"</span> <span class=\\"token operator\\">&amp;&amp;</span> key <span class=\\"token operator\\">!==</span> <span class=\\"token string\\">\\"Content-Type\\"</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
        res<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">setHeader</span><span class=\\"token punctuation\\">(</span>key<span class=\\"token punctuation\\">,</span> fakeRes<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getHeader</span><span class=\\"token punctuation\\">(</span>key<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
      <span class=\\"token punctuation\\">}</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    res<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">setHeader</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"Content-Type\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"text/plain\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    res<span class=\\"token punctuation\\">.</span>statusCode <span class=\\"token operator\\">=</span> fakeRes<span class=\\"token punctuation\\">.</span>statusCode <span class=\\"token operator\\">||</span> <span class=\\"token number\\">200</span>
    res<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">end</span><span class=\\"token punctuation\\">(</span>htmlToText<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">fromString</span><span class=\\"token punctuation\\">(</span>data<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token function\\">handle</span><span class=\\"token punctuation\\">(</span>req<span class=\\"token punctuation\\">,</span> fakeRes<span class=\\"token punctuation\\">,</span> parsedUrl<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>With that set up, the custom server code can be changed to the following. The code
below checks the accept header and uses the new <code class=\\"language-text\\">handleWithText</code> function if the
accept header is set to <code class=\\"language-text\\">text/plain</code> or the user agent is <a href=\\"https://curl.haxx.se/\\">curl</a> or <a href=\\"https://httpie.org/\\">httpie</a>,
the two CLI based http clients I know of, with an accept header set to <code class=\\"language-text\\">*/*</code>.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"javascript\\"><pre class=\\"language-javascript\\"><code class=\\"language-javascript\\">app<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">prepare</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">then</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token function\\">createServer</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">req<span class=\\"token punctuation\\">,</span> res</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">const</span> parsedUrl <span class=\\"token operator\\">=</span> <span class=\\"token function\\">parse</span><span class=\\"token punctuation\\">(</span>req<span class=\\"token punctuation\\">.</span>url<span class=\\"token punctuation\\">,</span> <span class=\\"token boolean\\">true</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">[</span>accept<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span>req<span class=\\"token punctuation\\">.</span>headers<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"accept\\"</span><span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">||</span> <span class=\\"token string\\">\\"\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">split</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\";\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>
      accept <span class=\\"token operator\\">===</span> <span class=\\"token string\\">\\"text/plain\\"</span> <span class=\\"token operator\\">||</span>
      <span class=\\"token punctuation\\">(</span>accept <span class=\\"token operator\\">===</span> <span class=\\"token string\\">\\"*/*\\"</span> <span class=\\"token operator\\">&amp;&amp;</span> <span class=\\"token regex\\">/curl|HTTPie/</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">test</span><span class=\\"token punctuation\\">(</span>req<span class=\\"token punctuation\\">.</span>headers<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"user-agent\\"</span><span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">||</span> <span class=\\"token string\\">\\"\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>
    <span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token function\\">handleWithText</span><span class=\\"token punctuation\\">(</span>req<span class=\\"token punctuation\\">,</span> res<span class=\\"token punctuation\\">,</span> parsedUrl<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">else</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token function\\">handle</span><span class=\\"token punctuation\\">(</span>req<span class=\\"token punctuation\\">,</span> res<span class=\\"token punctuation\\">,</span> parsedUrl<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">listen</span><span class=\\"token punctuation\\">(</span>port<span class=\\"token punctuation\\">,</span> <span class=\\"token parameter\\">err</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>err<span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">throw</span> err<span class=\\"token punctuation\\">;</span>
    console<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span><span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">> Ready on http://localhost:</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>port<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>This would result in this output if it would be used on the front page of this website
(which would require me to rewrite it from Gatsby first, but that is another thing).</p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\">$ curl -L rolflekang.com
RL [/]

Hi, I am Rolf

I am an independent software developer who enjoys working
with the whole stack. I occationally write posts [/writing], take photographs
[/photography], ride mountain bikes and snowboards. I do consulting work, if
that is something you are looking I might be able to help out [/hire].</code></pre></div>
<p>This might not be the most useful feature, but it might be neat if your website
contains information that people often would want to get from the terminal. Anyhow,
it is a fun little easter egg. 🐣</p>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/serving-plain-text-with-nextjs",
      "image": Object {},
      "link": "https://rolflekang.com/serving-plain-text-with-nextjs",
      "origlink": null,
      "pubDate": "2020-05-26T00:00:00.000Z",
      "pubdate": 2020-05-26T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "nextjs",
          "@": Object {},
        },
        Object {
          "#": "javascript",
          "@": Object {},
        },
        Object {
          "#": "curl",
          "@": Object {},
        },
        Object {
          "#": "nodejs",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "I have recently been trying out the Next.js for some projects again. I have
had earlier projects where I have been really happy with Next…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/serving-plain-text-with-nextjs",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/serving-plain-text-with-nextjs",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Tue, 26 May 2020 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Serving text/plain for curl with Next",
        "@": Object {},
      },
      "source": Object {},
      "summary": "I have recently been trying out the Next.js for some projects again. I have
had earlier projects where I have been really happy with Next…",
      "title": "Serving text/plain for curl with Next",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "networking",
        "unifi",
        "ubiquiti",
        "homelab",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>In the apartment I live in there is only ethernet between the place where the fiber
connection is and the tv point in the living room. In the place with where the fiber
connection is located there is a technical closet without room for anything more than
the ISP modem. Thus, we have an home office without an ethernet connection. In that office
we need some equipment that gives a lot more value if we are connected to it with gigabit
ethernet.</p>
<p>I already had the network set up with Ubiquiti Unifi equipment that I am quite happy with
so I looked into if I could have two different wired networks and have them connected with
wifi. They have a feature called wireless uplinks, which is usually used to create mesh
networks, but it can also be used to share the wireless connection with a switch. I decided
to buy another access point and switch to try to connect everything. The experience of setting
it up was straight forward. I connected the switch first to another switch and updated an
adopted it. Then I disconnected it from the switch and connected the access point and adopted
the access point which then reconnected the switch.</p>
<p>The setup is as following. In the office there is an unifi nanoHD connected to a 8 port <abbr title=\\"Power Over Ethernet\\">POE</abbr> switch.
The nanoHD is connected to a unifi flexHD over wireless uplink, which again is also connected to a
8 port <abbr title=\\"Power Over Ethernet\\">POE</abbr> switch. The diagram below will hopefully make it clear. I started out with the Unifi mesh
access point but figured I would get more speed with a more high end access point.</p>
<br />
<br />
<p><span
      class=\\"gatsby-resp-image-wrapper\\"
      style=\\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 640px;\\"
    >
      <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"/static/0903810b05ba9955217c2178b498c8b3/6af66/wireless-uplink-diagram.png\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >
    <span
    class=\\"gatsby-resp-image-background-image\\"
    style=\\"padding-bottom: 14.893617021276595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAA7ElEQVQI12PYsn238Jw580SraxpEC4rKJBiA4Obdh0HXb9/vBLH3HTjMXFhawQhif/r8teb9x887X758pQTib9m+k2/mrDliU6fPFgXh2XPmCTMsWrr88sSJk0/39/cfa2ttudve3ln18MHDqGtXry0AaYqIiOAGUkzrV6+QePP+838QePjoST1IbsHiZVMnTZp8c/r06cemTpl6dvr0mWcZ+iZO5tbS0pbR1dFWzclMFQcpvHbtusGNGzeDQOwNGzYy1dc3gl347PnLsucvXm28/+CRAtiFO/ZyODs7i6mpKKtamZtKLVywkBsAcJ9ue2L09AQAAAAASUVORK5CYII='); background-size: cover; display: block;\\"
  ></span>
  <img
        class=\\"gatsby-resp-image-image\\"
        alt=\\"Diagram of network connections\\"
        title=\\"Diagram of network connections\\"
        src=\\"/static/0903810b05ba9955217c2178b498c8b3/6af66/wireless-uplink-diagram.png\\"
        srcset=\\"/static/0903810b05ba9955217c2178b498c8b3/4dcb9/wireless-uplink-diagram.png 188w,
/static/0903810b05ba9955217c2178b498c8b3/5ff7e/wireless-uplink-diagram.png 375w,
/static/0903810b05ba9955217c2178b498c8b3/6af66/wireless-uplink-diagram.png 640w\\"
        sizes=\\"(max-width: 640px) 100vw, 640px\\"
        style=\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\"
        loading=\\"lazy\\"
      />
  </a>
    </span></p>
<br />
<br />
<p>This setup has been working nicely. The speeds do vary, which I guess is due to inference, but it is
more than acceptable as an uplink to the computers and the network storage connected to it.</p>
<h2>A few tips when setting up with wireless uplinks</h2>
<ul>
<li>Set the channel explicitly. This is probably a good idea wether you use wireless
uplinks or not.</li>
<li>If you are moving an endpoint that was previously using wired uplinks it might help
to reset it and adopt it over a wireless connection.</li>
<li>Turn off the wireless networks on the AP that does only have a wireless uplink. If
you don't need it for extending range this will keep your wireless network faster.</li>
</ul>",
        "@": Object {},
      },
      "date": 2020-05-03T00:00:00.000Z,
      "description": "<p>In the apartment I live in there is only ethernet between the place where the fiber
connection is and the tv point in the living room. In the place with where the fiber
connection is located there is a technical closet without room for anything more than
the ISP modem. Thus, we have an home office without an ethernet connection. In that office
we need some equipment that gives a lot more value if we are connected to it with gigabit
ethernet.</p>
<p>I already had the network set up with Ubiquiti Unifi equipment that I am quite happy with
so I looked into if I could have two different wired networks and have them connected with
wifi. They have a feature called wireless uplinks, which is usually used to create mesh
networks, but it can also be used to share the wireless connection with a switch. I decided
to buy another access point and switch to try to connect everything. The experience of setting
it up was straight forward. I connected the switch first to another switch and updated an
adopted it. Then I disconnected it from the switch and connected the access point and adopted
the access point which then reconnected the switch.</p>
<p>The setup is as following. In the office there is an unifi nanoHD connected to a 8 port <abbr title=\\"Power Over Ethernet\\">POE</abbr> switch.
The nanoHD is connected to a unifi flexHD over wireless uplink, which again is also connected to a
8 port <abbr title=\\"Power Over Ethernet\\">POE</abbr> switch. The diagram below will hopefully make it clear. I started out with the Unifi mesh
access point but figured I would get more speed with a more high end access point.</p>
<br />
<br />
<p><span
      class=\\"gatsby-resp-image-wrapper\\"
      style=\\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 640px;\\"
    >
      <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"/static/0903810b05ba9955217c2178b498c8b3/6af66/wireless-uplink-diagram.png\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >
    <span
    class=\\"gatsby-resp-image-background-image\\"
    style=\\"padding-bottom: 14.893617021276595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAA7ElEQVQI12PYsn238Jw580SraxpEC4rKJBiA4Obdh0HXb9/vBLH3HTjMXFhawQhif/r8teb9x887X758pQTib9m+k2/mrDliU6fPFgXh2XPmCTMsWrr88sSJk0/39/cfa2ttudve3ln18MHDqGtXry0AaYqIiOAGUkzrV6+QePP+838QePjoST1IbsHiZVMnTZp8c/r06cemTpl6dvr0mWcZ+iZO5tbS0pbR1dFWzclMFQcpvHbtusGNGzeDQOwNGzYy1dc3gl347PnLsucvXm28/+CRAtiFO/ZyODs7i6mpKKtamZtKLVywkBsAcJ9ue2L09AQAAAAASUVORK5CYII='); background-size: cover; display: block;\\"
  ></span>
  <img
        class=\\"gatsby-resp-image-image\\"
        alt=\\"Diagram of network connections\\"
        title=\\"Diagram of network connections\\"
        src=\\"/static/0903810b05ba9955217c2178b498c8b3/6af66/wireless-uplink-diagram.png\\"
        srcset=\\"/static/0903810b05ba9955217c2178b498c8b3/4dcb9/wireless-uplink-diagram.png 188w,
/static/0903810b05ba9955217c2178b498c8b3/5ff7e/wireless-uplink-diagram.png 375w,
/static/0903810b05ba9955217c2178b498c8b3/6af66/wireless-uplink-diagram.png 640w\\"
        sizes=\\"(max-width: 640px) 100vw, 640px\\"
        style=\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\"
        loading=\\"lazy\\"
      />
  </a>
    </span></p>
<br />
<br />
<p>This setup has been working nicely. The speeds do vary, which I guess is due to inference, but it is
more than acceptable as an uplink to the computers and the network storage connected to it.</p>
<h2>A few tips when setting up with wireless uplinks</h2>
<ul>
<li>Set the channel explicitly. This is probably a good idea wether you use wireless
uplinks or not.</li>
<li>If you are moving an endpoint that was previously using wired uplinks it might help
to reset it and adopt it over a wireless connection.</li>
<li>Turn off the wireless networks on the AP that does only have a wireless uplink. If
you don't need it for extending range this will keep your wireless network faster.</li>
</ul>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/wireless-uplinks-with-unifi",
      "image": Object {},
      "link": "https://rolflekang.com/wireless-uplinks-with-unifi",
      "origlink": null,
      "pubDate": "2020-05-03T00:00:00.000Z",
      "pubdate": 2020-05-03T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "networking",
          "@": Object {},
        },
        Object {
          "#": "unifi",
          "@": Object {},
        },
        Object {
          "#": "ubiquiti",
          "@": Object {},
        },
        Object {
          "#": "homelab",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "In the apartment I live in there is only ethernet between the place where the fiber
connection is and the tv point in the living room. In…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/wireless-uplinks-with-unifi",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/wireless-uplinks-with-unifi",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Sun, 03 May 2020 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Wireless uplinks with Unifi",
        "@": Object {},
      },
      "source": Object {},
      "summary": "In the apartment I live in there is only ethernet between the place where the fiber
connection is and the tv point in the living room. In…",
      "title": "Wireless uplinks with Unifi",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "git",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>Over the years I have time and time again run into the problem of getting
conflicts when popping from the git stash. Somehow this has resulted in loss
of parts of the work I have done. There is probably a correct way to use stash
in these situations. However, commits is a much bigger part of my workflow and
I have deeper knowledge of how to work with commits. Furthermore, if I learn
more about tricks around commits it will be helpful in the rest of my workflow.</p>
<p>I started to use wip commits a lot instead. I just add everything and commit it
with the commit message <code class=\\"language-text\\">wip</code>. Git has this nice feature to make new commands
that are either aliases to other git commands or shell commands. To aid working
with wip commits I created these two aliases:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"ini\\"><pre class=\\"language-ini\\"><code class=\\"language-ini\\"><span class=\\"token constant\\">wip</span> <span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span> \\"!git add . &amp;&amp; git commit -nm'wip'\\"</span>
<span class=\\"token constant\\">pop</span> <span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span> reset HEAD^</span></code></pre></div>
<p>The first alias, wip, does two git operation through a shell command. The exclamation
mark in the beginning of the alias indicates that this is a shell command. The
first operation is adding everything in the current folder, and then the
second operation is committing the changes. The flag <code class=\\"language-text\\">-n</code> in this command
tells git to skip any pre-commit hooks since I don't want a linter or anything
stopping the creation of the wip commit.</p>
<p>The second alias, pop, will remove the last commit and unstage the changes. This means
that if I do some changes in a repo and run <code class=\\"language-text\\">git wip</code> and then <code class=\\"language-text\\">git pop</code> the state
would be the same after <code class=\\"language-text\\">git pop</code> as it was before <code class=\\"language-text\\">git wip</code>.</p>
<p>Adding this to my workflow has made it much easier to put away work temporary by
running git wip in a branch. Or rebasing my current work on the latest master,
which has the possibility of creating tedious conflict situations.</p>",
        "@": Object {},
      },
      "date": 2019-11-14T00:00:00.000Z,
      "description": "<p>Over the years I have time and time again run into the problem of getting
conflicts when popping from the git stash. Somehow this has resulted in loss
of parts of the work I have done. There is probably a correct way to use stash
in these situations. However, commits is a much bigger part of my workflow and
I have deeper knowledge of how to work with commits. Furthermore, if I learn
more about tricks around commits it will be helpful in the rest of my workflow.</p>
<p>I started to use wip commits a lot instead. I just add everything and commit it
with the commit message <code class=\\"language-text\\">wip</code>. Git has this nice feature to make new commands
that are either aliases to other git commands or shell commands. To aid working
with wip commits I created these two aliases:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"ini\\"><pre class=\\"language-ini\\"><code class=\\"language-ini\\"><span class=\\"token constant\\">wip</span> <span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span> \\"!git add . &amp;&amp; git commit -nm'wip'\\"</span>
<span class=\\"token constant\\">pop</span> <span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span> reset HEAD^</span></code></pre></div>
<p>The first alias, wip, does two git operation through a shell command. The exclamation
mark in the beginning of the alias indicates that this is a shell command. The
first operation is adding everything in the current folder, and then the
second operation is committing the changes. The flag <code class=\\"language-text\\">-n</code> in this command
tells git to skip any pre-commit hooks since I don't want a linter or anything
stopping the creation of the wip commit.</p>
<p>The second alias, pop, will remove the last commit and unstage the changes. This means
that if I do some changes in a repo and run <code class=\\"language-text\\">git wip</code> and then <code class=\\"language-text\\">git pop</code> the state
would be the same after <code class=\\"language-text\\">git pop</code> as it was before <code class=\\"language-text\\">git wip</code>.</p>
<p>Adding this to my workflow has made it much easier to put away work temporary by
running git wip in a branch. Or rebasing my current work on the latest master,
which has the possibility of creating tedious conflict situations.</p>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/using-git-commits-instead-of-stash",
      "image": Object {},
      "link": "https://rolflekang.com/using-git-commits-instead-of-stash",
      "origlink": null,
      "pubDate": "2019-11-14T00:00:00.000Z",
      "pubdate": 2019-11-14T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Object {
        "#": "git",
        "@": Object {},
      },
      "rss:description": Object {
        "#": "Over the years I have time and time again run into the problem of getting
conflicts when popping from the git stash. Somehow this has…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/using-git-commits-instead-of-stash",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/using-git-commits-instead-of-stash",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Thu, 14 Nov 2019 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Using git commits instead of git stash",
        "@": Object {},
      },
      "source": Object {},
      "summary": "Over the years I have time and time again run into the problem of getting
conflicts when popping from the git stash. Somehow this has…",
      "title": "Using git commits instead of git stash",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "gatsby",
        "canvas",
        "javascript",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>Previously this blog had the default article twitter card. I have seen some
other sited like <a href=\\"https://dev.to/\\">dev.to</a> have these nice title images for the twitter cards.
I wanted to add these to this site for two reasons: they look kind of nice and
I would like to look into what it would take to create these. The idea I had
for my own cards was for it to resemble the current header with RL and the
purple line and then the title of the post below it. This first version
was written with Node.js and <a href=\\"https://github.com/Automattic/node-canvas\\">node-canvas</a>, maybe in the feature I will try
to convert it to native reason. Here is a preview of the twitter card for this
post.</p>
<p><img
  src=\\"/twitter-cards-for-gatsby-posts-link-card.png\\"
  alt=\\"Twitter card for this post\\"
  style=\\"border: 1px solid gray; border-radius: 20px; display: block;\\"
/></p>
<p>Twitter has <a href=\\"https://cards-dev.twitter.com/validator\\">a tool to validate</a> the cards for different
pages. It will show how the card will be viewed in a tweet. Below is an
example with this post.</p>
<p><span
      class=\\"gatsby-resp-image-wrapper\\"
      style=\\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;\\"
    >
      <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"/static/36777abb8ab99f65a937a1d20bc6178f/1ff84/card-screenshot.png\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >
    <span
    class=\\"gatsby-resp-image-background-image\\"
    style=\\"padding-bottom: 76.59574468085107%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB9klEQVQ4y61TyW7UQBDNLyPBp/ATHCEXTgHBIRFBIplkNDPelx6H2O143+1HV9uehWEQB0p66u7q8vMr1esL0zLx6s1r6LoOVVVhmiY0TYPjOAjDUKKuazRNIzCu+/O4xzCAou97XGRZBt0wUBQFoihCHCdI0xRJksD3fYQ8FGsAzjkCsQZBIPME2hOIaEeIKQbs43D/LzEIhb1A1wlCYp1BFzv0I+2T4WPzzcDLzxjWI0PCsx3JjDm6rhsJKdUfktEfu7GN+09rfHl3K9ebD3cIvWhq77h+kApnQkqcaefxq4LLt1dCpYnvHx/g6T7yuPxjbddPLVPUVYMyqySKtESelGibDvef11jdaLi7WuH6/Q+p0lg4aOoWhagpslJ+U+U0+XZPGPkptuozuBMhdGOELIZvheCuOLMEL14ic1zcRU8pAlE31z5bXCov82rf8hxs60LVVSiagoD7YB6DqqmwXVvcMXm/3qzgipXudENDlqfHLcshTFPlwneWZcG2bek9xhhsy8aWbeF5nsyT8anG0A0YwsPkX4p2Hso48l4a+vAVkNmrqprO7V+9SIK6Q8K2bbFYPGCjKFivN1KFIvbL5VI+Sdd1d6/hd5zYZv5DWQtVVS3QSF+eqBhOvXfswwPbyMHsSCZzn1FyDv08FJL6P0BcvwC0soPIDRnrOQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\"
  ></span>
  <img
        class=\\"gatsby-resp-image-image\\"
        alt=\\"Screenshot of a twitter card\\"
        title=\\"Screenshot of a twitter card\\"
        src=\\"/static/36777abb8ab99f65a937a1d20bc6178f/1d69c/card-screenshot.png\\"
        srcset=\\"/static/36777abb8ab99f65a937a1d20bc6178f/4dcb9/card-screenshot.png 188w,
/static/36777abb8ab99f65a937a1d20bc6178f/5ff7e/card-screenshot.png 375w,
/static/36777abb8ab99f65a937a1d20bc6178f/1d69c/card-screenshot.png 750w,
/static/36777abb8ab99f65a937a1d20bc6178f/1ff84/card-screenshot.png 1040w\\"
        sizes=\\"(max-width: 750px) 100vw, 750px\\"
        style=\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\"
        loading=\\"lazy\\"
      />
  </a>
    </span></p>
<p>So how to build this? Two things is necessary to get this to work. Creating
the image and then add the meta tags to each posts according to the twitter
documentation.</p>
<p>Firstly, let us look at the creating of the images themselves. <a href=\\"https://github.com/Automattic/node-canvas\\">node-canvas</a>
is a nice tool to do drawing in Node.js that we want to store in a file. It
can do many of the things possible to do with browser side canvas. Below is
the implementation of the card for this site. What parts each section draws
is put in comments above them. In the end of the function the
<code class=\\"language-text\\">canvas.toBuffer(&#39;image/png&#39;)</code> function is used to create a buffer that we
can write to a file, which then is written to the file.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">{</span> createCanvas <span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">require</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'canvas'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">const</span> fs <span class=\\"token operator\\">=</span> <span class=\\"token function\\">require</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'fs'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">createLinkCards</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\"><span class=\\"token punctuation\\">{</span> title<span class=\\"token punctuation\\">,</span> path <span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> canvas <span class=\\"token operator\\">=</span> <span class=\\"token function\\">createCanvas</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">600</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">300</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> context <span class=\\"token operator\\">=</span> canvas<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getContext</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'2d'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token comment\\">// Create a white background</span>
  context<span class=\\"token punctuation\\">.</span>fillStyle <span class=\\"token operator\\">=</span> <span class=\\"token string\\">'white'</span><span class=\\"token punctuation\\">;</span>
  context<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">fillRect</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">,</span> canvas<span class=\\"token punctuation\\">.</span>width<span class=\\"token punctuation\\">,</span> canvas<span class=\\"token punctuation\\">.</span>height<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token comment\\">// Create the big RL in purple</span>
  context<span class=\\"token punctuation\\">.</span>font <span class=\\"token operator\\">=</span> <span class=\\"token string\\">'100pt serif'</span><span class=\\"token punctuation\\">;</span>
  context<span class=\\"token punctuation\\">.</span>fillStyle <span class=\\"token operator\\">=</span> <span class=\\"token string\\">'#6C3082'</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> header <span class=\\"token operator\\">=</span> context<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">measureText</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'RL'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  context<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">fillText</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'RL'</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">(</span>canvas<span class=\\"token punctuation\\">.</span>width <span class=\\"token operator\\">-</span> header<span class=\\"token punctuation\\">.</span>width<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">/</span> <span class=\\"token number\\">2</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">160</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token comment\\">// Create the purple line across the image</span>
  context<span class=\\"token punctuation\\">.</span>strokeStyle <span class=\\"token operator\\">=</span> <span class=\\"token string\\">'#6C3082'</span><span class=\\"token punctuation\\">;</span>
  context<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">beginPath</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  context<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">lineTo</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">180</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  context<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">lineTo</span><span class=\\"token punctuation\\">(</span>canvas<span class=\\"token punctuation\\">.</span>width<span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">180</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  context<span class=\\"token punctuation\\">.</span>lineWidth <span class=\\"token operator\\">=</span> <span class=\\"token number\\">6</span><span class=\\"token punctuation\\">;</span>
  context<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">stroke</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token comment\\">// Insert the title text beneath the purple line</span>
  <span class=\\"token function\\">setFontSizeForWidth</span><span class=\\"token punctuation\\">(</span>canvas<span class=\\"token punctuation\\">.</span>width <span class=\\"token operator\\">*</span> <span class=\\"token number\\">0.75</span><span class=\\"token punctuation\\">)</span>
  context<span class=\\"token punctuation\\">.</span>fillStyle <span class=\\"token operator\\">=</span> <span class=\\"token string\\">'black'</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> text <span class=\\"token operator\\">=</span> context<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">measureText</span><span class=\\"token punctuation\\">(</span>title<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  context<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">fillText</span><span class=\\"token punctuation\\">(</span>title<span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">(</span>canvas<span class=\\"token punctuation\\">.</span>width <span class=\\"token operator\\">-</span> text<span class=\\"token punctuation\\">.</span>width<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">/</span> <span class=\\"token number\\">2</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">250</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  fs<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">writeFileSync</span><span class=\\"token punctuation\\">(</span>path<span class=\\"token punctuation\\">,</span> canvas<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">toBuffer</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'image/png'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>There are a few things to take a closer look at. Several places
<code class=\\"language-text\\">context.measureText</code> is used. It will take use the current font config to
measure how wide the string passed as the first argument will be. This is
useful to center the text since we can use it to calculate the placement of
the text. Furthermore, it can be used to decide the font size if we do not
know the amount of text to render beforehand. In this case, that is done for
the title with the function below, which will test any font size from 100pt
and downwards until the text fits within a certain limit. In the case of the
card title it is set to 75 % of the canvas with.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">setFontSizeForWidth</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">context<span class=\\"token punctuation\\">,</span> width</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">let</span> fontSize <span class=\\"token operator\\">=</span> <span class=\\"token number\\">100</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">do</span> <span class=\\"token punctuation\\">{</span>
    fontSize<span class=\\"token operator\\">--</span><span class=\\"token punctuation\\">;</span>
    context<span class=\\"token punctuation\\">.</span>font <span class=\\"token operator\\">=</span> fontSize <span class=\\"token operator\\">+</span> <span class=\\"token string\\">'pt serif'</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">while</span> <span class=\\"token punctuation\\">(</span>context<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">measureText</span><span class=\\"token punctuation\\">(</span>title<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span>width <span class=\\"token operator\\">></span> width<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">return</span> fontSize<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>The next thing needed is to call the <code class=\\"language-text\\">createLinkCards</code> in the same place
where <code class=\\"language-text\\">createPage</code> is called in <code class=\\"language-text\\">gatsby-node.js</code>. In this example I have used
<a href=\\"https://www.gatsbyjs.org/packages/gatsby-transformer-remark/\\">gatsby-transformer-remark</a> the code snippet below is looping over the result
of the graphql query similar to the documentation for
<a href=\\"https://www.gatsbyjs.org/packages/gatsby-transformer-remark/\\">gatsby-transformer-remark</a>.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\">posts<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">forEach</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\"><span class=\\"token punctuation\\">{</span> node <span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">{</span> slug<span class=\\"token punctuation\\">,</span> layout<span class=\\"token punctuation\\">,</span> tags<span class=\\"token punctuation\\">,</span> title <span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">=</span> node<span class=\\"token punctuation\\">.</span>frontmatter<span class=\\"token punctuation\\">;</span>
  <span class=\\"token function\\">createPage</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span>
    path<span class=\\"token punctuation\\">:</span> <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">/</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>slug<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">,</span>
    component<span class=\\"token punctuation\\">:</span> path<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">join</span><span class=\\"token punctuation\\">(</span>templatePath<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'blogpost.js'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token function\\">createLinkCards</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span>
    title<span class=\\"token punctuation\\">,</span>
    path<span class=\\"token punctuation\\">:</span> path<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">join</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'public'</span><span class=\\"token punctuation\\">,</span> <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>slug<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token string\\">-link-card.png</span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>After running <code class=\\"language-text\\">gatsby build</code> the public folder will now have a link card file
for each post. Open one and check how it looks. Next step will be to link this
in the blogpost template. These things needs to be linked in meta tags in the
head tag. To change metadata with Gatsby it is recommended to use react-helmet.
There is a [guide on how to change metadata][gatsby-docs-metadata] in the Gatsby
documentation. In the component in the <code class=\\"language-text\\">blogpost.js</code> template add the following
snippet of code.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token operator\\">&lt;</span>Helmet<span class=\\"token operator\\">></span>
  <span class=\\"token operator\\">&lt;</span>meta name<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"twitter:title\\"</span> content<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span>title<span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">/</span><span class=\\"token operator\\">></span>
  <span class=\\"token operator\\">&lt;</span>meta name<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"twitter:card\\"</span> content<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"summary_large_image\\"</span> <span class=\\"token operator\\">/</span><span class=\\"token operator\\">></span>
  <span class=\\"token operator\\">&lt;</span>meta name<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"twitter:author\\"</span> content<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"@&lt;your twitter handle>\\"</span> <span class=\\"token operator\\">/</span><span class=\\"token operator\\">></span>
  <span class=\\"token operator\\">&lt;</span>meta name<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"twitter:image:src\\"</span> content<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>window<span class=\\"token punctuation\\">.</span>location<span class=\\"token punctuation\\">.</span>origin<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token string\\">/</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>slug<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token string\\">-link-card.png</span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">/</span><span class=\\"token operator\\">></span>
<span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>Helmet<span class=\\"token operator\\">></span></code></pre></div>
<p>This is all that is needed to get these nice cards in tweets with links to your blog.
It might be worth looking into more meta tags for getting the same behavior on other
sites that have similar functionality. Remember that <a href=\\"https://cards-dev.twitter.com/validator\\">twitter has a tool to test</a>
your new cards.</p>",
        "@": Object {},
      },
      "date": 2019-02-26T00:00:00.000Z,
      "description": "<p>Previously this blog had the default article twitter card. I have seen some
other sited like <a href=\\"https://dev.to/\\">dev.to</a> have these nice title images for the twitter cards.
I wanted to add these to this site for two reasons: they look kind of nice and
I would like to look into what it would take to create these. The idea I had
for my own cards was for it to resemble the current header with RL and the
purple line and then the title of the post below it. This first version
was written with Node.js and <a href=\\"https://github.com/Automattic/node-canvas\\">node-canvas</a>, maybe in the feature I will try
to convert it to native reason. Here is a preview of the twitter card for this
post.</p>
<p><img
  src=\\"/twitter-cards-for-gatsby-posts-link-card.png\\"
  alt=\\"Twitter card for this post\\"
  style=\\"border: 1px solid gray; border-radius: 20px; display: block;\\"
/></p>
<p>Twitter has <a href=\\"https://cards-dev.twitter.com/validator\\">a tool to validate</a> the cards for different
pages. It will show how the card will be viewed in a tweet. Below is an
example with this post.</p>
<p><span
      class=\\"gatsby-resp-image-wrapper\\"
      style=\\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;\\"
    >
      <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"/static/36777abb8ab99f65a937a1d20bc6178f/1ff84/card-screenshot.png\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >
    <span
    class=\\"gatsby-resp-image-background-image\\"
    style=\\"padding-bottom: 76.59574468085107%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB9klEQVQ4y61TyW7UQBDNLyPBp/ATHCEXTgHBIRFBIplkNDPelx6H2O143+1HV9uehWEQB0p66u7q8vMr1esL0zLx6s1r6LoOVVVhmiY0TYPjOAjDUKKuazRNIzCu+/O4xzCAou97XGRZBt0wUBQFoihCHCdI0xRJksD3fYQ8FGsAzjkCsQZBIPME2hOIaEeIKQbs43D/LzEIhb1A1wlCYp1BFzv0I+2T4WPzzcDLzxjWI0PCsx3JjDm6rhsJKdUfktEfu7GN+09rfHl3K9ebD3cIvWhq77h+kApnQkqcaefxq4LLt1dCpYnvHx/g6T7yuPxjbddPLVPUVYMyqySKtESelGibDvef11jdaLi7WuH6/Q+p0lg4aOoWhagpslJ+U+U0+XZPGPkptuozuBMhdGOELIZvheCuOLMEL14ic1zcRU8pAlE31z5bXCov82rf8hxs60LVVSiagoD7YB6DqqmwXVvcMXm/3qzgipXudENDlqfHLcshTFPlwneWZcG2bek9xhhsy8aWbeF5nsyT8anG0A0YwsPkX4p2Hso48l4a+vAVkNmrqprO7V+9SIK6Q8K2bbFYPGCjKFivN1KFIvbL5VI+Sdd1d6/hd5zYZv5DWQtVVS3QSF+eqBhOvXfswwPbyMHsSCZzn1FyDv08FJL6P0BcvwC0soPIDRnrOQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\\"
  ></span>
  <img
        class=\\"gatsby-resp-image-image\\"
        alt=\\"Screenshot of a twitter card\\"
        title=\\"Screenshot of a twitter card\\"
        src=\\"/static/36777abb8ab99f65a937a1d20bc6178f/1d69c/card-screenshot.png\\"
        srcset=\\"/static/36777abb8ab99f65a937a1d20bc6178f/4dcb9/card-screenshot.png 188w,
/static/36777abb8ab99f65a937a1d20bc6178f/5ff7e/card-screenshot.png 375w,
/static/36777abb8ab99f65a937a1d20bc6178f/1d69c/card-screenshot.png 750w,
/static/36777abb8ab99f65a937a1d20bc6178f/1ff84/card-screenshot.png 1040w\\"
        sizes=\\"(max-width: 750px) 100vw, 750px\\"
        style=\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\"
        loading=\\"lazy\\"
      />
  </a>
    </span></p>
<p>So how to build this? Two things is necessary to get this to work. Creating
the image and then add the meta tags to each posts according to the twitter
documentation.</p>
<p>Firstly, let us look at the creating of the images themselves. <a href=\\"https://github.com/Automattic/node-canvas\\">node-canvas</a>
is a nice tool to do drawing in Node.js that we want to store in a file. It
can do many of the things possible to do with browser side canvas. Below is
the implementation of the card for this site. What parts each section draws
is put in comments above them. In the end of the function the
<code class=\\"language-text\\">canvas.toBuffer(&#39;image/png&#39;)</code> function is used to create a buffer that we
can write to a file, which then is written to the file.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">{</span> createCanvas <span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">=</span> <span class=\\"token function\\">require</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'canvas'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">const</span> fs <span class=\\"token operator\\">=</span> <span class=\\"token function\\">require</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'fs'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">createLinkCards</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\"><span class=\\"token punctuation\\">{</span> title<span class=\\"token punctuation\\">,</span> path <span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> canvas <span class=\\"token operator\\">=</span> <span class=\\"token function\\">createCanvas</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">600</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">300</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> context <span class=\\"token operator\\">=</span> canvas<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getContext</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'2d'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token comment\\">// Create a white background</span>
  context<span class=\\"token punctuation\\">.</span>fillStyle <span class=\\"token operator\\">=</span> <span class=\\"token string\\">'white'</span><span class=\\"token punctuation\\">;</span>
  context<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">fillRect</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">,</span> canvas<span class=\\"token punctuation\\">.</span>width<span class=\\"token punctuation\\">,</span> canvas<span class=\\"token punctuation\\">.</span>height<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token comment\\">// Create the big RL in purple</span>
  context<span class=\\"token punctuation\\">.</span>font <span class=\\"token operator\\">=</span> <span class=\\"token string\\">'100pt serif'</span><span class=\\"token punctuation\\">;</span>
  context<span class=\\"token punctuation\\">.</span>fillStyle <span class=\\"token operator\\">=</span> <span class=\\"token string\\">'#6C3082'</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> header <span class=\\"token operator\\">=</span> context<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">measureText</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'RL'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  context<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">fillText</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'RL'</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">(</span>canvas<span class=\\"token punctuation\\">.</span>width <span class=\\"token operator\\">-</span> header<span class=\\"token punctuation\\">.</span>width<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">/</span> <span class=\\"token number\\">2</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">160</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token comment\\">// Create the purple line across the image</span>
  context<span class=\\"token punctuation\\">.</span>strokeStyle <span class=\\"token operator\\">=</span> <span class=\\"token string\\">'#6C3082'</span><span class=\\"token punctuation\\">;</span>
  context<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">beginPath</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  context<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">lineTo</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">180</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  context<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">lineTo</span><span class=\\"token punctuation\\">(</span>canvas<span class=\\"token punctuation\\">.</span>width<span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">180</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  context<span class=\\"token punctuation\\">.</span>lineWidth <span class=\\"token operator\\">=</span> <span class=\\"token number\\">6</span><span class=\\"token punctuation\\">;</span>
  context<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">stroke</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token comment\\">// Insert the title text beneath the purple line</span>
  <span class=\\"token function\\">setFontSizeForWidth</span><span class=\\"token punctuation\\">(</span>canvas<span class=\\"token punctuation\\">.</span>width <span class=\\"token operator\\">*</span> <span class=\\"token number\\">0.75</span><span class=\\"token punctuation\\">)</span>
  context<span class=\\"token punctuation\\">.</span>fillStyle <span class=\\"token operator\\">=</span> <span class=\\"token string\\">'black'</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> text <span class=\\"token operator\\">=</span> context<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">measureText</span><span class=\\"token punctuation\\">(</span>title<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  context<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">fillText</span><span class=\\"token punctuation\\">(</span>title<span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">(</span>canvas<span class=\\"token punctuation\\">.</span>width <span class=\\"token operator\\">-</span> text<span class=\\"token punctuation\\">.</span>width<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">/</span> <span class=\\"token number\\">2</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">250</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  fs<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">writeFileSync</span><span class=\\"token punctuation\\">(</span>path<span class=\\"token punctuation\\">,</span> canvas<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">toBuffer</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'image/png'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>There are a few things to take a closer look at. Several places
<code class=\\"language-text\\">context.measureText</code> is used. It will take use the current font config to
measure how wide the string passed as the first argument will be. This is
useful to center the text since we can use it to calculate the placement of
the text. Furthermore, it can be used to decide the font size if we do not
know the amount of text to render beforehand. In this case, that is done for
the title with the function below, which will test any font size from 100pt
and downwards until the text fits within a certain limit. In the case of the
card title it is set to 75 % of the canvas with.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token keyword\\">function</span> <span class=\\"token function\\">setFontSizeForWidth</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">context<span class=\\"token punctuation\\">,</span> width</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">let</span> fontSize <span class=\\"token operator\\">=</span> <span class=\\"token number\\">100</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">do</span> <span class=\\"token punctuation\\">{</span>
    fontSize<span class=\\"token operator\\">--</span><span class=\\"token punctuation\\">;</span>
    context<span class=\\"token punctuation\\">.</span>font <span class=\\"token operator\\">=</span> fontSize <span class=\\"token operator\\">+</span> <span class=\\"token string\\">'pt serif'</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">while</span> <span class=\\"token punctuation\\">(</span>context<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">measureText</span><span class=\\"token punctuation\\">(</span>title<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span>width <span class=\\"token operator\\">></span> width<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">return</span> fontSize<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>The next thing needed is to call the <code class=\\"language-text\\">createLinkCards</code> in the same place
where <code class=\\"language-text\\">createPage</code> is called in <code class=\\"language-text\\">gatsby-node.js</code>. In this example I have used
<a href=\\"https://www.gatsbyjs.org/packages/gatsby-transformer-remark/\\">gatsby-transformer-remark</a> the code snippet below is looping over the result
of the graphql query similar to the documentation for
<a href=\\"https://www.gatsbyjs.org/packages/gatsby-transformer-remark/\\">gatsby-transformer-remark</a>.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\">posts<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">forEach</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\"><span class=\\"token punctuation\\">{</span> node <span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">{</span> slug<span class=\\"token punctuation\\">,</span> layout<span class=\\"token punctuation\\">,</span> tags<span class=\\"token punctuation\\">,</span> title <span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">=</span> node<span class=\\"token punctuation\\">.</span>frontmatter<span class=\\"token punctuation\\">;</span>
  <span class=\\"token function\\">createPage</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span>
    path<span class=\\"token punctuation\\">:</span> <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">/</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>slug<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">,</span>
    component<span class=\\"token punctuation\\">:</span> path<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">join</span><span class=\\"token punctuation\\">(</span>templatePath<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'blogpost.js'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token function\\">createLinkCards</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span>
    title<span class=\\"token punctuation\\">,</span>
    path<span class=\\"token punctuation\\">:</span> path<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">join</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'public'</span><span class=\\"token punctuation\\">,</span> <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>slug<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token string\\">-link-card.png</span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>After running <code class=\\"language-text\\">gatsby build</code> the public folder will now have a link card file
for each post. Open one and check how it looks. Next step will be to link this
in the blogpost template. These things needs to be linked in meta tags in the
head tag. To change metadata with Gatsby it is recommended to use react-helmet.
There is a [guide on how to change metadata][gatsby-docs-metadata] in the Gatsby
documentation. In the component in the <code class=\\"language-text\\">blogpost.js</code> template add the following
snippet of code.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token operator\\">&lt;</span>Helmet<span class=\\"token operator\\">></span>
  <span class=\\"token operator\\">&lt;</span>meta name<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"twitter:title\\"</span> content<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span>title<span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">/</span><span class=\\"token operator\\">></span>
  <span class=\\"token operator\\">&lt;</span>meta name<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"twitter:card\\"</span> content<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"summary_large_image\\"</span> <span class=\\"token operator\\">/</span><span class=\\"token operator\\">></span>
  <span class=\\"token operator\\">&lt;</span>meta name<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"twitter:author\\"</span> content<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"@&lt;your twitter handle>\\"</span> <span class=\\"token operator\\">/</span><span class=\\"token operator\\">></span>
  <span class=\\"token operator\\">&lt;</span>meta name<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"twitter:image:src\\"</span> content<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>window<span class=\\"token punctuation\\">.</span>location<span class=\\"token punctuation\\">.</span>origin<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token string\\">/</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>slug<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token string\\">-link-card.png</span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">/</span><span class=\\"token operator\\">></span>
<span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>Helmet<span class=\\"token operator\\">></span></code></pre></div>
<p>This is all that is needed to get these nice cards in tweets with links to your blog.
It might be worth looking into more meta tags for getting the same behavior on other
sites that have similar functionality. Remember that <a href=\\"https://cards-dev.twitter.com/validator\\">twitter has a tool to test</a>
your new cards.</p>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/twitter-cards-for-gatsby-posts",
      "image": Object {},
      "link": "https://rolflekang.com/twitter-cards-for-gatsby-posts",
      "origlink": null,
      "pubDate": "2019-02-26T00:00:00.000Z",
      "pubdate": 2019-02-26T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "gatsby",
          "@": Object {},
        },
        Object {
          "#": "canvas",
          "@": Object {},
        },
        Object {
          "#": "javascript",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "Previously this blog had the default article twitter card. I have seen some
other sited like dev.to have these nice title images for the…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/twitter-cards-for-gatsby-posts",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/twitter-cards-for-gatsby-posts",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Tue, 26 Feb 2019 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Twitter cards for Gatsby posts",
        "@": Object {},
      },
      "source": Object {},
      "summary": "Previously this blog had the default article twitter card. I have seen some
other sited like dev.to have these nice title images for the…",
      "title": "Twitter cards for Gatsby posts",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "gatsby",
        "javascript",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>This website is created with <a href=\\"https://www.gatsbyjs.org/\\">Gatsby</a>, Reasonml and a little bit of typescript.
In this post I will explain how I built the \\"Related articles\\" feature that can be
seen on the bottom of some of the articles. I have kept all the examples in this
post in javascript so it will be helpful to more people.</p>
<p>First of we need to define what makes two posts or articles related. On this site
and for this article I am defining it as articles that has the same tags. In the
frontmatter I have a comma separated list of tags. Below is an example:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"yaml\\"><pre class=\\"language-yaml\\"><code class=\\"language-yaml\\"><span class=\\"token key atrule\\">title</span><span class=\\"token punctuation\\">:</span> Related articles with Gatsby
<span class=\\"token key atrule\\">slug</span><span class=\\"token punctuation\\">:</span> related<span class=\\"token punctuation\\">-</span>articles<span class=\\"token punctuation\\">-</span>with<span class=\\"token punctuation\\">-</span>gatsby
<span class=\\"token key atrule\\">tags</span><span class=\\"token punctuation\\">:</span> gatsby<span class=\\"token punctuation\\">,</span>javascript
<span class=\\"token key atrule\\">date</span><span class=\\"token punctuation\\">:</span> <span class=\\"token datetime number\\">2019-02-20</span></code></pre></div>
<p>This blog is based on a setup with <a href=\\"https://www.gatsbyjs.org/packages/gatsby-transformer-remark/\\">gatsby-transformer-remark</a> which has the
following in <code class=\\"language-text\\">gatsby-node.js</code> to generate the pages. The first part fetches all
the articles and the necessary metadata with Graphql. The second part loops over
all the articles and then creates pages for them with the Gatsby <code class=\\"language-text\\">createPage</code>
function.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\">exports<span class=\\"token punctuation\\">.</span><span class=\\"token function-variable function\\">createPages</span> <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">async</span> <span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\"><span class=\\"token punctuation\\">{</span> graphql<span class=\\"token punctuation\\">,</span> actions <span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">{</span> createPage <span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">=</span> actions<span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> templatePath <span class=\\"token operator\\">=</span> path<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">resolve</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'./src/templates/'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token keyword\\">const</span> response <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">await</span> <span class=\\"token function\\">graphql</span><span class=\\"token punctuation\\">(</span>
    <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">
      query {
        allMarkdownRemark {
          edges {
            node {
              frontmatter {
                layout
                slug
                date(formatString: \\"DD.MM.YYYY\\")
              }
            }
          }
        }
      }
    </span><span class=\\"token template-punctuation string\\">\`</span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token keyword\\">const</span> postEdges <span class=\\"token operator\\">=</span> response<span class=\\"token punctuation\\">.</span>data<span class=\\"token punctuation\\">.</span>allMarkdownRemark<span class=\\"token punctuation\\">.</span>edges

  postEdges<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">forEach</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\"><span class=\\"token punctuation\\">{</span> node <span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">{</span> slug<span class=\\"token punctuation\\">,</span> layout<span class=\\"token punctuation\\">,</span> tags <span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">=</span> node<span class=\\"token punctuation\\">.</span>frontmatter<span class=\\"token punctuation\\">;</span>
    <span class=\\"token function\\">createPage</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span>
      path<span class=\\"token punctuation\\">:</span> <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">/</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>slug<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">,</span>
      component<span class=\\"token punctuation\\">:</span> path<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">join</span><span class=\\"token punctuation\\">(</span>templatePath<span class=\\"token punctuation\\">,</span> <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>layout<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token string\\">.tsx</span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
      context<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span> slug <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>In order to populate the data for related articles we will add the data as
context parameters in the createPage call. However, first we need to find
those articles. The code below will build a map of tags and articles with those
tags.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token keyword\\">const</span> articlesByTags <span class=\\"token operator\\">=</span> postEdges<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">reduce</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">lastValue<span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">{</span> node <span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> tags <span class=\\"token operator\\">=</span> node<span class=\\"token punctuation\\">.</span>frontmatter<span class=\\"token punctuation\\">.</span>tags <span class=\\"token operator\\">||</span> <span class=\\"token string\\">\\"\\"</span><span class=\\"token punctuation\\">;</span>
  tags<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">split</span><span class=\\"token punctuation\\">(</span><span class=\\"token regex\\">/, ?/</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">forEach</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">tag</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>lastValue<span class=\\"token punctuation\\">[</span>tag<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
      lastValue<span class=\\"token punctuation\\">[</span>tag<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">push</span><span class=\\"token punctuation\\">(</span>node<span class=\\"token punctuation\\">.</span>frontmatter<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">else</span> <span class=\\"token punctuation\\">{</span>
      lastValue<span class=\\"token punctuation\\">[</span>tag<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">[</span>node<span class=\\"token punctuation\\">.</span>frontmatter<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">return</span> lastValue<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>The result will be something like the following, where <code class=\\"language-text\\">{...}</code> is the
frontmatter of a post. This we can use to look up all the related articles for
one post.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token punctuation\\">{</span>
  gatsby<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">{</span><span class=\\"token operator\\">...</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">{</span><span class=\\"token operator\\">...</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span>
  cli<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">{</span><span class=\\"token operator\\">...</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">{</span><span class=\\"token operator\\">...</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">]</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>The <code class=\\"language-text\\">articlesByTags</code> is useful for looking up all the articles that has a list of tags. Let
us look at a possible implementation for that.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token keyword\\">const</span> _ <span class=\\"token operator\\">=</span> <span class=\\"token function\\">require</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"lodash/fp\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">findRelatedArticles</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">slug<span class=\\"token punctuation\\">,</span> tags</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">return</span> _<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">flow</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">[</span>
    _<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">split</span><span class=\\"token punctuation\\">(</span><span class=\\"token regex\\">/, ?/</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
    _<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">map</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">tag</span> <span class=\\"token operator\\">=></span> articlesByTags<span class=\\"token punctuation\\">[</span>tag<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
    _<span class=\\"token punctuation\\">.</span>flatten<span class=\\"token punctuation\\">,</span>
    _<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">filter</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">node</span> <span class=\\"token operator\\">=></span> node<span class=\\"token punctuation\\">.</span>slug <span class=\\"token operator\\">!==</span> slug<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
    _<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">uniqBy</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">node</span> <span class=\\"token operator\\">=></span> node<span class=\\"token punctuation\\">.</span>slug<span class=\\"token punctuation\\">)</span>
  <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">(</span>tags<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>In this function the <code class=\\"language-text\\">_</code> is the
<a href=\\"https://github.com/lodash/lodash/wiki/FP-Guide\\">functional programming(fp) version of lodash</a>, which has this neat
utility called flow for grouping actions together. Flow returns a function when
called will perform all the operations in the array. Each operation will have
to be a function and the return value of each of them will be passed as the
argument to the next one. The function above will first split the comma
separated string to a list and then perform a map on that list of tags to a
list of lists of articles. Since we now have a list of lists it is necessary to
flatten it, which will result in a list of articles. The next step is to filter
out the current post since we only want other articles than the one that is
currently viewed. In the last step we want to remove any duplicate articles and
can do that by selecting unique elements based on the slug.</p>
<p>To finish the data setup it is necessary to add the related articles to the
context in the <code class=\\"language-text\\">createPage</code> call.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token function\\">createPage</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span>
  path<span class=\\"token punctuation\\">:</span> <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">/</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>slug<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">,</span>
  component<span class=\\"token punctuation\\">:</span> path<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">join</span><span class=\\"token punctuation\\">(</span>templatePath<span class=\\"token punctuation\\">,</span> <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>layout<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token string\\">.tsx</span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
  context<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span>
    slug<span class=\\"token punctuation\\">,</span>
<span class=\\"gatsby-highlight-code-line\\">    relatedArticles<span class=\\"token punctuation\\">:</span> <span class=\\"token function\\">findRelatedArticles</span><span class=\\"token punctuation\\">(</span>slug<span class=\\"token punctuation\\">,</span> tags<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span></span>  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>The <code class=\\"language-text\\">gatsby-node.js</code> file should look something like the following now. In the
code below the changes is highlighted.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\">exports<span class=\\"token punctuation\\">.</span><span class=\\"token function-variable function\\">createPages</span> <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">async</span> <span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\"><span class=\\"token punctuation\\">{</span> graphql<span class=\\"token punctuation\\">,</span> actions <span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">{</span> createPage <span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">=</span> actions<span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> templatePath <span class=\\"token operator\\">=</span> path<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">resolve</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'./src/templates/'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token keyword\\">const</span> response <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">await</span> <span class=\\"token function\\">graphql</span><span class=\\"token punctuation\\">(</span>
    <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">
      query {
        allMarkdownRemark {
          edges {
            node {
              frontmatter {
                layout
                slug
                date(formatString: \\"DD.MM.YYYY\\")
              }
            }
          }
        }
      }
    </span><span class=\\"token template-punctuation string\\">\`</span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token keyword\\">const</span> postEdges <span class=\\"token operator\\">=</span> response<span class=\\"token punctuation\\">.</span>data<span class=\\"token punctuation\\">.</span>allMarkdownRemark<span class=\\"token punctuation\\">.</span>edges<span class=\\"token punctuation\\">;</span>

<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> articlesByTags <span class=\\"token operator\\">=</span> postEdges<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">reduce</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">lastValue<span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">{</span> node <span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token keyword\\">const</span> tags <span class=\\"token operator\\">=</span> node<span class=\\"token punctuation\\">.</span>frontmatter<span class=\\"token punctuation\\">.</span>tags <span class=\\"token operator\\">||</span> <span class=\\"token string\\">''</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">    tags<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">split</span><span class=\\"token punctuation\\">(</span><span class=\\"token regex\\">/, ?/</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">forEach</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">tag</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>lastValue<span class=\\"token punctuation\\">[</span>tag<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">        lastValue<span class=\\"token punctuation\\">[</span>tag<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">push</span><span class=\\"token punctuation\\">(</span>node<span class=\\"token punctuation\\">.</span>frontmatter<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">else</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">        lastValue<span class=\\"token punctuation\\">[</span>tag<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">[</span>node<span class=\\"token punctuation\\">.</span>frontmatter<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token punctuation\\">}</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token keyword\\">return</span> lastValue<span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">findRelatedArticles</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">slug<span class=\\"token punctuation\\">,</span> tags</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token keyword\\">return</span> _<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">flow</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">[</span></span><span class=\\"gatsby-highlight-code-line\\">      _<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">split</span><span class=\\"token punctuation\\">(</span><span class=\\"token regex\\">/, ?/</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span></span><span class=\\"gatsby-highlight-code-line\\">      _<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">map</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">tag</span> <span class=\\"token operator\\">=></span> articlesByTags<span class=\\"token punctuation\\">[</span>tag<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span></span><span class=\\"gatsby-highlight-code-line\\">      _<span class=\\"token punctuation\\">.</span>flatten<span class=\\"token punctuation\\">,</span></span><span class=\\"gatsby-highlight-code-line\\">      _<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">filter</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">node</span> <span class=\\"token operator\\">=></span> node<span class=\\"token punctuation\\">.</span>slug <span class=\\"token operator\\">!==</span> slug<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span></span><span class=\\"gatsby-highlight-code-line\\">      _<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">uniqBy</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">node</span> <span class=\\"token operator\\">=></span> node<span class=\\"token punctuation\\">.</span>slug<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">(</span>tags<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span></span>
  postEdges<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">forEach</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\"><span class=\\"token punctuation\\">{</span> node <span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">{</span> slug<span class=\\"token punctuation\\">,</span> layout<span class=\\"token punctuation\\">,</span> tags <span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">=</span> node<span class=\\"token punctuation\\">.</span>frontmatter<span class=\\"token punctuation\\">;</span>
    <span class=\\"token function\\">createPage</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span>
      path<span class=\\"token punctuation\\">:</span> <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">/</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>slug<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">,</span>
      component<span class=\\"token punctuation\\">:</span> path<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">join</span><span class=\\"token punctuation\\">(</span>templatePath<span class=\\"token punctuation\\">,</span> <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>layout<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token string\\">.tsx</span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
      context<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span>
        slug<span class=\\"token punctuation\\">,</span>
<span class=\\"gatsby-highlight-code-line\\">        relatedArticles<span class=\\"token punctuation\\">:</span> <span class=\\"token function\\">findRelatedArticles</span><span class=\\"token punctuation\\">(</span>slug<span class=\\"token punctuation\\">,</span> tags<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span></span>      <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>At this point all the data needed is in place. However, it still has to
be shown to give some value. Let us look at a component to add this to
the site.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token keyword\\">export</span> <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">RelatedArticles</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">props</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">!</span>props<span class=\\"token punctuation\\">.</span>articles <span class=\\"token operator\\">||</span> props<span class=\\"token punctuation\\">.</span>articles<span class=\\"token punctuation\\">.</span>length <span class=\\"token operator\\">===</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token operator\\">&lt;</span>div <span class=\\"token operator\\">/</span><span class=\\"token operator\\">></span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token operator\\">&lt;</span>section id<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"related-articles\\"</span><span class=\\"token operator\\">></span>
      <span class=\\"token operator\\">&lt;</span>header<span class=\\"token operator\\">></span>Related articles<span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>header<span class=\\"token operator\\">></span>
      <span class=\\"token operator\\">&lt;</span>ul<span class=\\"token operator\\">></span>
        <span class=\\"token punctuation\\">{</span>props<span class=\\"token punctuation\\">.</span>articles<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">map</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">article</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">(</span>
          <span class=\\"token operator\\">&lt;</span>li key<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span>article<span class=\\"token punctuation\\">.</span>slug<span class=\\"token punctuation\\">}</span><span class=\\"token operator\\">></span>
            <span class=\\"token operator\\">&lt;</span>Link to<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">/</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>article<span class=\\"token punctuation\\">.</span>slug<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">}</span><span class=\\"token operator\\">></span><span class=\\"token punctuation\\">{</span>article<span class=\\"token punctuation\\">.</span>title<span class=\\"token punctuation\\">}</span><span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>Link<span class=\\"token operator\\">></span>
            <span class=\\"token punctuation\\">{</span><span class=\\"token string\\">' '</span><span class=\\"token punctuation\\">}</span>
            <span class=\\"token operator\\">&lt;</span>em<span class=\\"token operator\\">></span><span class=\\"token punctuation\\">{</span>article<span class=\\"token punctuation\\">.</span>date<span class=\\"token punctuation\\">}</span><span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>em<span class=\\"token operator\\">></span>
          <span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>li<span class=\\"token operator\\">></span>
        <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">}</span>
      <span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>ul<span class=\\"token operator\\">></span>
    <span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>section<span class=\\"token operator\\">></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>This component will render an empty div if there are no related articles.
In the case of related articles it will render a list with links to the
articles. Remember that the data available here is defined by the graphql
query in <code class=\\"language-text\\">gatbsy-node.js</code>. In order to glue these parts together and make
it work the component needs to be added in the template used for the
articles.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token operator\\">&lt;</span>RelatedArticles articles<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span>props<span class=\\"token punctuation\\">.</span>pageContext<span class=\\"token punctuation\\">.</span>relatedArticles<span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">/</span><span class=\\"token operator\\">></span></code></pre></div>
<p>The page component will get the <code class=\\"language-text\\">context</code> attribute from <code class=\\"language-text\\">createPage</code> as
<code class=\\"language-text\\">pageContext</code>. Thus, the <code class=\\"language-text\\">relatedArticles</code> attribute we created earlier will
be accessible on that object.</p>
<p>This is all that is needed to have related articles with a Gatsby site with
the transformer-remark plugin. To see have it looks have a look at the bottom
of the <a href=\\"/testing-simple-graphql-services#related-articles\\">Testing simple GraphQL services</a>
article.</p>",
        "@": Object {},
      },
      "date": 2019-02-20T00:00:00.000Z,
      "description": "<p>This website is created with <a href=\\"https://www.gatsbyjs.org/\\">Gatsby</a>, Reasonml and a little bit of typescript.
In this post I will explain how I built the \\"Related articles\\" feature that can be
seen on the bottom of some of the articles. I have kept all the examples in this
post in javascript so it will be helpful to more people.</p>
<p>First of we need to define what makes two posts or articles related. On this site
and for this article I am defining it as articles that has the same tags. In the
frontmatter I have a comma separated list of tags. Below is an example:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"yaml\\"><pre class=\\"language-yaml\\"><code class=\\"language-yaml\\"><span class=\\"token key atrule\\">title</span><span class=\\"token punctuation\\">:</span> Related articles with Gatsby
<span class=\\"token key atrule\\">slug</span><span class=\\"token punctuation\\">:</span> related<span class=\\"token punctuation\\">-</span>articles<span class=\\"token punctuation\\">-</span>with<span class=\\"token punctuation\\">-</span>gatsby
<span class=\\"token key atrule\\">tags</span><span class=\\"token punctuation\\">:</span> gatsby<span class=\\"token punctuation\\">,</span>javascript
<span class=\\"token key atrule\\">date</span><span class=\\"token punctuation\\">:</span> <span class=\\"token datetime number\\">2019-02-20</span></code></pre></div>
<p>This blog is based on a setup with <a href=\\"https://www.gatsbyjs.org/packages/gatsby-transformer-remark/\\">gatsby-transformer-remark</a> which has the
following in <code class=\\"language-text\\">gatsby-node.js</code> to generate the pages. The first part fetches all
the articles and the necessary metadata with Graphql. The second part loops over
all the articles and then creates pages for them with the Gatsby <code class=\\"language-text\\">createPage</code>
function.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\">exports<span class=\\"token punctuation\\">.</span><span class=\\"token function-variable function\\">createPages</span> <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">async</span> <span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\"><span class=\\"token punctuation\\">{</span> graphql<span class=\\"token punctuation\\">,</span> actions <span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">{</span> createPage <span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">=</span> actions<span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> templatePath <span class=\\"token operator\\">=</span> path<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">resolve</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'./src/templates/'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token keyword\\">const</span> response <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">await</span> <span class=\\"token function\\">graphql</span><span class=\\"token punctuation\\">(</span>
    <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">
      query {
        allMarkdownRemark {
          edges {
            node {
              frontmatter {
                layout
                slug
                date(formatString: \\"DD.MM.YYYY\\")
              }
            }
          }
        }
      }
    </span><span class=\\"token template-punctuation string\\">\`</span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token keyword\\">const</span> postEdges <span class=\\"token operator\\">=</span> response<span class=\\"token punctuation\\">.</span>data<span class=\\"token punctuation\\">.</span>allMarkdownRemark<span class=\\"token punctuation\\">.</span>edges

  postEdges<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">forEach</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\"><span class=\\"token punctuation\\">{</span> node <span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">{</span> slug<span class=\\"token punctuation\\">,</span> layout<span class=\\"token punctuation\\">,</span> tags <span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">=</span> node<span class=\\"token punctuation\\">.</span>frontmatter<span class=\\"token punctuation\\">;</span>
    <span class=\\"token function\\">createPage</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span>
      path<span class=\\"token punctuation\\">:</span> <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">/</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>slug<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">,</span>
      component<span class=\\"token punctuation\\">:</span> path<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">join</span><span class=\\"token punctuation\\">(</span>templatePath<span class=\\"token punctuation\\">,</span> <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>layout<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token string\\">.tsx</span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
      context<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span> slug <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>In order to populate the data for related articles we will add the data as
context parameters in the createPage call. However, first we need to find
those articles. The code below will build a map of tags and articles with those
tags.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token keyword\\">const</span> articlesByTags <span class=\\"token operator\\">=</span> postEdges<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">reduce</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">lastValue<span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">{</span> node <span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> tags <span class=\\"token operator\\">=</span> node<span class=\\"token punctuation\\">.</span>frontmatter<span class=\\"token punctuation\\">.</span>tags <span class=\\"token operator\\">||</span> <span class=\\"token string\\">\\"\\"</span><span class=\\"token punctuation\\">;</span>
  tags<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">split</span><span class=\\"token punctuation\\">(</span><span class=\\"token regex\\">/, ?/</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">forEach</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">tag</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>lastValue<span class=\\"token punctuation\\">[</span>tag<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
      lastValue<span class=\\"token punctuation\\">[</span>tag<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">push</span><span class=\\"token punctuation\\">(</span>node<span class=\\"token punctuation\\">.</span>frontmatter<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">else</span> <span class=\\"token punctuation\\">{</span>
      lastValue<span class=\\"token punctuation\\">[</span>tag<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">[</span>node<span class=\\"token punctuation\\">.</span>frontmatter<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">return</span> lastValue<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>The result will be something like the following, where <code class=\\"language-text\\">{...}</code> is the
frontmatter of a post. This we can use to look up all the related articles for
one post.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token punctuation\\">{</span>
  gatsby<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">{</span><span class=\\"token operator\\">...</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">{</span><span class=\\"token operator\\">...</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span>
  cli<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">{</span><span class=\\"token operator\\">...</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">{</span><span class=\\"token operator\\">...</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">]</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>The <code class=\\"language-text\\">articlesByTags</code> is useful for looking up all the articles that has a list of tags. Let
us look at a possible implementation for that.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token keyword\\">const</span> _ <span class=\\"token operator\\">=</span> <span class=\\"token function\\">require</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"lodash/fp\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">findRelatedArticles</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">slug<span class=\\"token punctuation\\">,</span> tags</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">return</span> _<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">flow</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">[</span>
    _<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">split</span><span class=\\"token punctuation\\">(</span><span class=\\"token regex\\">/, ?/</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
    _<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">map</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">tag</span> <span class=\\"token operator\\">=></span> articlesByTags<span class=\\"token punctuation\\">[</span>tag<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
    _<span class=\\"token punctuation\\">.</span>flatten<span class=\\"token punctuation\\">,</span>
    _<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">filter</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">node</span> <span class=\\"token operator\\">=></span> node<span class=\\"token punctuation\\">.</span>slug <span class=\\"token operator\\">!==</span> slug<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
    _<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">uniqBy</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">node</span> <span class=\\"token operator\\">=></span> node<span class=\\"token punctuation\\">.</span>slug<span class=\\"token punctuation\\">)</span>
  <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">(</span>tags<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>In this function the <code class=\\"language-text\\">_</code> is the
<a href=\\"https://github.com/lodash/lodash/wiki/FP-Guide\\">functional programming(fp) version of lodash</a>, which has this neat
utility called flow for grouping actions together. Flow returns a function when
called will perform all the operations in the array. Each operation will have
to be a function and the return value of each of them will be passed as the
argument to the next one. The function above will first split the comma
separated string to a list and then perform a map on that list of tags to a
list of lists of articles. Since we now have a list of lists it is necessary to
flatten it, which will result in a list of articles. The next step is to filter
out the current post since we only want other articles than the one that is
currently viewed. In the last step we want to remove any duplicate articles and
can do that by selecting unique elements based on the slug.</p>
<p>To finish the data setup it is necessary to add the related articles to the
context in the <code class=\\"language-text\\">createPage</code> call.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token function\\">createPage</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span>
  path<span class=\\"token punctuation\\">:</span> <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">/</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>slug<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">,</span>
  component<span class=\\"token punctuation\\">:</span> path<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">join</span><span class=\\"token punctuation\\">(</span>templatePath<span class=\\"token punctuation\\">,</span> <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>layout<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token string\\">.tsx</span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
  context<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span>
    slug<span class=\\"token punctuation\\">,</span>
<span class=\\"gatsby-highlight-code-line\\">    relatedArticles<span class=\\"token punctuation\\">:</span> <span class=\\"token function\\">findRelatedArticles</span><span class=\\"token punctuation\\">(</span>slug<span class=\\"token punctuation\\">,</span> tags<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span></span>  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>The <code class=\\"language-text\\">gatsby-node.js</code> file should look something like the following now. In the
code below the changes is highlighted.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\">exports<span class=\\"token punctuation\\">.</span><span class=\\"token function-variable function\\">createPages</span> <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">async</span> <span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\"><span class=\\"token punctuation\\">{</span> graphql<span class=\\"token punctuation\\">,</span> actions <span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">{</span> createPage <span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">=</span> actions<span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">const</span> templatePath <span class=\\"token operator\\">=</span> path<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">resolve</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'./src/templates/'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token keyword\\">const</span> response <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">await</span> <span class=\\"token function\\">graphql</span><span class=\\"token punctuation\\">(</span>
    <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">
      query {
        allMarkdownRemark {
          edges {
            node {
              frontmatter {
                layout
                slug
                date(formatString: \\"DD.MM.YYYY\\")
              }
            }
          }
        }
      }
    </span><span class=\\"token template-punctuation string\\">\`</span></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

  <span class=\\"token keyword\\">const</span> postEdges <span class=\\"token operator\\">=</span> response<span class=\\"token punctuation\\">.</span>data<span class=\\"token punctuation\\">.</span>allMarkdownRemark<span class=\\"token punctuation\\">.</span>edges<span class=\\"token punctuation\\">;</span>

<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">const</span> articlesByTags <span class=\\"token operator\\">=</span> postEdges<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">reduce</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">lastValue<span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">{</span> node <span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token keyword\\">const</span> tags <span class=\\"token operator\\">=</span> node<span class=\\"token punctuation\\">.</span>frontmatter<span class=\\"token punctuation\\">.</span>tags <span class=\\"token operator\\">||</span> <span class=\\"token string\\">''</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">    tags<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">split</span><span class=\\"token punctuation\\">(</span><span class=\\"token regex\\">/, ?/</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">forEach</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">tag</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>lastValue<span class=\\"token punctuation\\">[</span>tag<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">        lastValue<span class=\\"token punctuation\\">[</span>tag<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">push</span><span class=\\"token punctuation\\">(</span>node<span class=\\"token punctuation\\">.</span>frontmatter<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">else</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">        lastValue<span class=\\"token punctuation\\">[</span>tag<span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">[</span>node<span class=\\"token punctuation\\">.</span>frontmatter<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">      <span class=\\"token punctuation\\">}</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token keyword\\">return</span> lastValue<span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span>
<span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">findRelatedArticles</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">slug<span class=\\"token punctuation\\">,</span> tags</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token keyword\\">return</span> _<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">flow</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">[</span></span><span class=\\"gatsby-highlight-code-line\\">      _<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">split</span><span class=\\"token punctuation\\">(</span><span class=\\"token regex\\">/, ?/</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span></span><span class=\\"gatsby-highlight-code-line\\">      _<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">map</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">tag</span> <span class=\\"token operator\\">=></span> articlesByTags<span class=\\"token punctuation\\">[</span>tag<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span></span><span class=\\"gatsby-highlight-code-line\\">      _<span class=\\"token punctuation\\">.</span>flatten<span class=\\"token punctuation\\">,</span></span><span class=\\"gatsby-highlight-code-line\\">      _<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">filter</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">node</span> <span class=\\"token operator\\">=></span> node<span class=\\"token punctuation\\">.</span>slug <span class=\\"token operator\\">!==</span> slug<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span></span><span class=\\"gatsby-highlight-code-line\\">      _<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">uniqBy</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">node</span> <span class=\\"token operator\\">=></span> node<span class=\\"token punctuation\\">.</span>slug<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span></span><span class=\\"gatsby-highlight-code-line\\">    <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">(</span>tags<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></span><span class=\\"gatsby-highlight-code-line\\">  <span class=\\"token punctuation\\">}</span></span>
  postEdges<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">forEach</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\"><span class=\\"token punctuation\\">{</span> node <span class=\\"token punctuation\\">}</span></span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">const</span> <span class=\\"token punctuation\\">{</span> slug<span class=\\"token punctuation\\">,</span> layout<span class=\\"token punctuation\\">,</span> tags <span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">=</span> node<span class=\\"token punctuation\\">.</span>frontmatter<span class=\\"token punctuation\\">;</span>
    <span class=\\"token function\\">createPage</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span>
      path<span class=\\"token punctuation\\">:</span> <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">/</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>slug<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">,</span>
      component<span class=\\"token punctuation\\">:</span> path<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">join</span><span class=\\"token punctuation\\">(</span>templatePath<span class=\\"token punctuation\\">,</span> <span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>layout<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token string\\">.tsx</span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
      context<span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">{</span>
        slug<span class=\\"token punctuation\\">,</span>
<span class=\\"gatsby-highlight-code-line\\">        relatedArticles<span class=\\"token punctuation\\">:</span> <span class=\\"token function\\">findRelatedArticles</span><span class=\\"token punctuation\\">(</span>slug<span class=\\"token punctuation\\">,</span> tags<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span></span>      <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>At this point all the data needed is in place. However, it still has to
be shown to give some value. Let us look at a component to add this to
the site.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token keyword\\">export</span> <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">RelatedArticles</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">props</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">!</span>props<span class=\\"token punctuation\\">.</span>articles <span class=\\"token operator\\">||</span> props<span class=\\"token punctuation\\">.</span>articles<span class=\\"token punctuation\\">.</span>length <span class=\\"token operator\\">===</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">return</span> <span class=\\"token operator\\">&lt;</span>div <span class=\\"token operator\\">/</span><span class=\\"token operator\\">></span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">}</span>
  <span class=\\"token keyword\\">return</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token operator\\">&lt;</span>section id<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"related-articles\\"</span><span class=\\"token operator\\">></span>
      <span class=\\"token operator\\">&lt;</span>header<span class=\\"token operator\\">></span>Related articles<span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>header<span class=\\"token operator\\">></span>
      <span class=\\"token operator\\">&lt;</span>ul<span class=\\"token operator\\">></span>
        <span class=\\"token punctuation\\">{</span>props<span class=\\"token punctuation\\">.</span>articles<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">map</span><span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">article</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">(</span>
          <span class=\\"token operator\\">&lt;</span>li key<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span>article<span class=\\"token punctuation\\">.</span>slug<span class=\\"token punctuation\\">}</span><span class=\\"token operator\\">></span>
            <span class=\\"token operator\\">&lt;</span>Link to<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span><span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">/</span><span class=\\"token interpolation\\"><span class=\\"token interpolation-punctuation punctuation\\">\${</span>article<span class=\\"token punctuation\\">.</span>slug<span class=\\"token interpolation-punctuation punctuation\\">}</span></span><span class=\\"token template-punctuation string\\">\`</span></span><span class=\\"token punctuation\\">}</span><span class=\\"token operator\\">></span><span class=\\"token punctuation\\">{</span>article<span class=\\"token punctuation\\">.</span>title<span class=\\"token punctuation\\">}</span><span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>Link<span class=\\"token operator\\">></span>
            <span class=\\"token punctuation\\">{</span><span class=\\"token string\\">' '</span><span class=\\"token punctuation\\">}</span>
            <span class=\\"token operator\\">&lt;</span>em<span class=\\"token operator\\">></span><span class=\\"token punctuation\\">{</span>article<span class=\\"token punctuation\\">.</span>date<span class=\\"token punctuation\\">}</span><span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>em<span class=\\"token operator\\">></span>
          <span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>li<span class=\\"token operator\\">></span>
        <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">}</span>
      <span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>ul<span class=\\"token operator\\">></span>
    <span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span>section<span class=\\"token operator\\">></span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>This component will render an empty div if there are no related articles.
In the case of related articles it will render a list with links to the
articles. Remember that the data available here is defined by the graphql
query in <code class=\\"language-text\\">gatbsy-node.js</code>. In order to glue these parts together and make
it work the component needs to be added in the template used for the
articles.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token operator\\">&lt;</span>RelatedArticles articles<span class=\\"token operator\\">=</span><span class=\\"token punctuation\\">{</span>props<span class=\\"token punctuation\\">.</span>pageContext<span class=\\"token punctuation\\">.</span>relatedArticles<span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">/</span><span class=\\"token operator\\">></span></code></pre></div>
<p>The page component will get the <code class=\\"language-text\\">context</code> attribute from <code class=\\"language-text\\">createPage</code> as
<code class=\\"language-text\\">pageContext</code>. Thus, the <code class=\\"language-text\\">relatedArticles</code> attribute we created earlier will
be accessible on that object.</p>
<p>This is all that is needed to have related articles with a Gatsby site with
the transformer-remark plugin. To see have it looks have a look at the bottom
of the <a href=\\"/testing-simple-graphql-services#related-articles\\">Testing simple GraphQL services</a>
article.</p>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/related-articles-with-gatsby",
      "image": Object {},
      "link": "https://rolflekang.com/related-articles-with-gatsby",
      "origlink": null,
      "pubDate": "2019-02-20T00:00:00.000Z",
      "pubdate": 2019-02-20T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "gatsby",
          "@": Object {},
        },
        Object {
          "#": "javascript",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "This website is created with Gatsby, Reasonml and a little bit of typescript.
In this post I will explain how I built the \\"Related articles…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/related-articles-with-gatsby",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/related-articles-with-gatsby",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Wed, 20 Feb 2019 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Related articles with Gatsby",
        "@": Object {},
      },
      "source": Object {},
      "summary": "This website is created with Gatsby, Reasonml and a little bit of typescript.
In this post I will explain how I built the \\"Related articles…",
      "title": "Related articles with Gatsby",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "reasonml",
        "native",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>Recently I have started to look into the native compilation of Reason. There
are many use cases for compiling to native, e.g. fast CLIs, react based ui
development without a browser runtime like electron or using  Reason for the
backend of a project. I am writing this to gather some getting started info
as I go and will try to keep things up to date as I learn more.</p>
<p>The goal of this blogpost is to create a simple CLI for basic calculation.
Not the most useful CLI tool, but a small thing to get started. The post
might make more sense if you have a little bit prior knowledge about Reason.
However, don't be afraid to try setting this up, but the post does not explain
Reason syntax. The <a href=\\"https://reasonml.github.io/\\">reason documentation</a> and the
<a href=\\"https://egghead.io/courses/get-started-with-reason\\">egghead.io course getting started with reason</a> are good
resources.</p>
<p>We are going to use a few different tools.</p>
<ul>
<li><a href=\\"https://esy.sh/\\"><strong>Esy</strong></a> helps us manage dependencies and package our code based on
package.json.</li>
<li><a href=\\"https://github.com/jordwalke/pesy\\"><strong>Pesy</strong></a> is a tool that has two useful features that we will leverage:
creating esy projects and configuring dune.</li>
<li><a href=\\"https://dune.build/\\"><strong>Dune</strong></a> is a build system for ocaml and reason. It will take care
of compiling and running our code in development.</li>
<li><a href=\\"https://reason-native.com\\"><strong>reason native</strong></a> is a collection of libraries for creating natively compiled applications.</li>
</ul>
<h2>Setting up the project</h2>
<p>Firstly, we need to setup the project with some basic build tools.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"shell\\"><pre class=\\"language-shell\\"><code class=\\"language-shell\\"><span class=\\"token function\\">npm</span> <span class=\\"token function\\">install</span> -g esy pesy
<span class=\\"token function\\">mkdir</span> calc <span class=\\"token operator\\">&amp;&amp;</span> <span class=\\"token builtin class-name\\">cd</span> calc
pesy</code></pre></div>
<p>This will create a file structure like the list below. There will be more
files, however, these are the most relevant ones. The folders <code class=\\"language-text\\">executable</code>,
<code class=\\"language-text\\">library</code> and <code class=\\"language-text\\">test</code> are different source directories. <code class=\\"language-text\\">dune-project</code> and
<code class=\\"language-text\\">dune</code> are config files for dune. Those are automatically maintained by pesy
so we do not need to edit those manually. The <code class=\\"language-text\\">calc.opam</code> is the config
file for the ocaml package manager, kind of like package.json is for npm. At
last this project also have a package.json, which is used to specify
dependencies for esy and the build configuration for pesy.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\">executable/
library/
test/
calc.opam
dune
dune-project
package.json</code></pre></div>
<p>If we look into the package.json it has some configuration for both esy
and pesy:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"json\\"><pre class=\\"language-json\\"><code class=\\"language-json\\"><span class=\\"token punctuation\\">{</span>
  <span class=\\"token property\\">\\"esy\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">\\"build\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"pesy\\"</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token property\\">\\"release\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token property\\">\\"releasedBinaries\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"CalcApp.exe\\"</span><span class=\\"token punctuation\\">]</span>
    <span class=\\"token punctuation\\">}</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token property\\">\\"buildDirs\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">\\"test\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token property\\">\\"require\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"Calc.lib\\"</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span>
      <span class=\\"token property\\">\\"main\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"TestCalc\\"</span><span class=\\"token punctuation\\">,</span>
      <span class=\\"token property\\">\\"name\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"TestCalc.exe\\"</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token property\\">\\"library\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token property\\">\\"name\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"Calc.lib\\"</span><span class=\\"token punctuation\\">,</span>
      <span class=\\"token property\\">\\"namespace\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"Calc\\"</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token property\\">\\"executable\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token property\\">\\"require\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"Calc.lib\\"</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span>
      <span class=\\"token property\\">\\"main\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"CalcApp\\"</span><span class=\\"token punctuation\\">,</span>
      <span class=\\"token property\\">\\"name\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"CalcApp.exe\\"</span>
    <span class=\\"token punctuation\\">}</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>The easy configuration needs to know how we build things and what we want to
export out of our package since it is handling packaging. Pesy is using the
<code class=\\"language-text\\">buildDirs</code> setting for its config. Each directory that we are using in for
code in the project needs to have a set of settings. Mainly name and
dependencies,
<a href=\\"https://github.com/jordwalke/pesy#supported-config\\">full list of supported config can be found in the pesy readme</a>.
The <code class=\\"language-text\\">buildDirs</code> config in packages.json is the baseline for the config written
into dune files. Thus, every time we update the <code class=\\"language-text\\">buildDirs</code> config we need to run
<code class=\\"language-text\\">esy pesy</code> to update the dune config files. Dune is the tool building the project and
running the ocaml compiler. We run that with <code class=\\"language-text\\">esy build</code> and after building the project
we can run the executable with <code class=\\"language-text\\">esy x CalcApp.exe</code>.</p>
<p>In order to build a release binary of the CLI we can run <code class=\\"language-text\\">esy npm-release</code>, which will
create a folder <code class=\\"language-text\\">_release</code>. It will contain a bin folder with binary and a package.json
for npm publishing and a postinstall script provided by pesy. In order to publish to npm
run <code class=\\"language-text\\">esy npm-release</code> and then <code class=\\"language-text\\">npm publish</code> from the _release folder.</p>
<h2>Implementing the CLI</h2>
<p>Now that the project build tools are set up and configured we are ready to
start the implmentation. Firstly, we need to add some dependencies by running.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\">esy add @reason-native/pastel @opam/cmdliner</code></pre></div>
<p>This will install <a href=\\"https://reason-native.com/docs/pastel/\\">reason native pastel</a> from npm and <a href=\\"https://erratique.ch/software/cmdliner/doc/Cmdliner#basics\\">cmdliner</a> from opam, the
ocaml package manager. Pastel is helpful changing the font-style and colors on the
terminal output. Cmdliner is a tool to parse command line arguments and generate
documentation for command line tools. Furthermore, we need to add these to the libs
sections of the executable package in the <code class=\\"language-text\\">buildDirs</code> config. The result should be:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"json\\"><pre class=\\"language-json\\"><code class=\\"language-json\\"><span class=\\"token property\\">\\"executable\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token property\\">\\"require\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">[</span> <span class=\\"token string\\">\\"cmdliner\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"pastel.lib\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"calc.lib\\"</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token property\\">\\"main\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"CalcApp\\"</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token property\\">\\"name\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"CalcApp.exe\\"</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>The first thing we will add is a default command and run eval with cmdliner. This
code should be in <code class=\\"language-text\\">./executable/CalcApp.re</code>. The
following code will make the default command list the help screen generated by
cmdliner.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"reason\\"><pre class=\\"language-reason\\"><code class=\\"language-reason\\"><span class=\\"token keyword\\">open</span> <span class=\\"token constructor variable\\">Cmdliner</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">let</span> version <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"1.0.0\\"</span>

<span class=\\"token keyword\\">let</span> default <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span>
  <span class=\\"token class-name\\">Term</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">(</span>ret<span class=\\"token punctuation\\">(</span>const<span class=\\"token punctuation\\">(</span>_ <span class=\\"token operator\\">=></span> <span class=\\"token operator\\">\`</span><span class=\\"token constructor variable\\">Help</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">\`</span><span class=\\"token constructor variable\\">Pager</span><span class=\\"token punctuation\\">,</span> <span class=\\"token constructor variable\\">None</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span> $ const<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token class-name\\">Term</span><span class=\\"token punctuation\\">.</span>info<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"calc\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>version<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token keyword\\">let</span> _ <span class=\\"token operator\\">=</span> <span class=\\"token class-name\\">Term</span><span class=\\"token punctuation\\">.</span>eval_choice<span class=\\"token punctuation\\">(</span>default<span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">|></span> <span class=\\"token class-name\\">Term</span><span class=\\"token punctuation\\">.</span>exit<span class=\\"token punctuation\\">;</span></code></pre></div>
<p>The empty list in <code class=\\"language-text\\">eval_choice</code> is where the sub commands should be added.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"reason\\"><pre class=\\"language-reason\\"><code class=\\"language-reason\\"><span class=\\"token keyword\\">let</span> add <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">let</span> x <span class=\\"token operator\\">=</span> <span class=\\"token class-name\\">Arg</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">(</span>value &amp; pos<span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">,</span> int<span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span> &amp; info<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>docv<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"number\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>doc<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"First number\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">let</span> y <span class=\\"token operator\\">=</span> <span class=\\"token class-name\\">Arg</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">(</span>value &amp; pos<span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">,</span> int<span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span> &amp; info<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>docv<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"number\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>doc<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"Second number\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">(</span>
    <span class=\\"token class-name\\">Term</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">(</span>const<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span>x<span class=\\"token punctuation\\">,</span> y<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> print_result<span class=\\"token punctuation\\">(</span>x <span class=\\"token operator\\">+</span> y<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span> $ x $ y<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token class-name\\">Term</span><span class=\\"token punctuation\\">.</span>info<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"add\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>version<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>In this part we define a new command <code class=\\"language-text\\">add</code> which takes two positional
arguments. Two numbers that we will add together. Let us break down the
different parts of the argument definition. In
<code class=\\"language-text\\">Arg.(value &amp; pos(0, int, 0) &amp; info([], ~docv=&quot;number&quot;, ~doc=&quot;First number&quot;))</code>
there is three main parts. <code class=\\"language-text\\">value</code> tells that we want to extract the value, not
just whether it is there(<code class=\\"language-text\\">flag</code>). <code class=\\"language-text\\">pos(0, int, 0)</code> is to instruct that this is
the positional argument at position 0 parsed as an integer with 0 as the default
value. <code class=\\"language-text\\">info([], ~docv=&quot;number&quot;, ~doc=&quot;First number&quot;))</code> is to generate the
documentation about the option. The empty list would contain the name if this was
an option, <code class=\\"language-text\\">docv</code> is for the usage string while <code class=\\"language-text\\">doc</code> is for the man page.</p>
<p>Furthermore, in the creation of the command we have the statement.
<code class=\\"language-text\\">Term.(const((x, y) =&gt; print_result(x + y)) $ x $ y)</code> which
defines that the command should run the function
<code class=\\"language-text\\">(x, y) =&gt; print_result(x + y)</code> when called. It knows about
the arguments from the <code class=\\"language-text\\">$ x $ y</code> which applies the argument definition to
the command. If you try to remove <code class=\\"language-text\\">$ y</code> you will get a compile error
complaining that at some place <code class=\\"language-text\\">unit</code> was expected but <code class=\\"language-text\\">int =&gt; unit</code> was
received. That is because the function in the command takes in both <code class=\\"language-text\\">x</code>
and <code class=\\"language-text\\">y</code>, but only the argument definition for <code class=\\"language-text\\">x</code> is applied.</p>
<p>In the command above we have used a function <code class=\\"language-text\\">print_result</code> that does
not exist. This is a nice use case for <a href=\\"https://reason-native.com/docs/pastel/\\">pastel</a>, which
is a library to handle styling of printed text in the terminal. Below is
an implementation of the <code class=\\"language-text\\">print_result</code> function.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"reason\\"><pre class=\\"language-reason\\"><code class=\\"language-reason\\"><span class=\\"token keyword\\">let</span> print_result <span class=\\"token operator\\">=</span> result <span class=\\"token operator\\">=></span>
  <span class=\\"token class-name\\">Pastel</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">(</span>
    <span class=\\"token operator\\">&lt;</span><span class=\\"token constructor variable\\">Pastel</span><span class=\\"token operator\\">></span>
      <span class=\\"token operator\\">&lt;</span><span class=\\"token constructor variable\\">Pastel</span> color<span class=\\"token operator\\">=</span><span class=\\"token constructor variable\\">BlackBright</span><span class=\\"token operator\\">></span> <span class=\\"token string\\">\\"Result: \\"</span> <span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span><span class=\\"token constructor variable\\">Pastel</span><span class=\\"token operator\\">></span>
      <span class=\\"token operator\\">&lt;</span><span class=\\"token constructor variable\\">Pastel</span> bold<span class=\\"token operator\\">=</span><span class=\\"token boolean\\">true</span><span class=\\"token operator\\">></span> <span class=\\"token punctuation\\">{</span>string_of_int<span class=\\"token punctuation\\">(</span>result<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span><span class=\\"token constructor variable\\">Pastel</span><span class=\\"token operator\\">></span>
    <span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span><span class=\\"token constructor variable\\">Pastel</span><span class=\\"token operator\\">></span>
  <span class=\\"token punctuation\\">)</span>
  <span class=\\"token operator\\">|></span> print_endline<span class=\\"token punctuation\\">;</span></code></pre></div>
<p>It will first create a string with the correct formatting, in other words the
<code class=\\"language-text\\">&lt;Pastel&gt;&lt;/Pastel&gt;</code> evaluates to a string. The string is then passed along to
<code class=\\"language-text\\">print_endline</code> from ocaml.</p>
<p>In order to use the add command, it has to be added to the command list so
change the <code class=\\"language-text\\">eval_choice</code> line to:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"reason\\"><pre class=\\"language-reason\\"><code class=\\"language-reason\\"><span class=\\"token keyword\\">let</span> _ <span class=\\"token operator\\">=</span> <span class=\\"token class-name\\">Term</span><span class=\\"token punctuation\\">.</span>eval_choice<span class=\\"token punctuation\\">(</span>default<span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">[</span>add<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">|></span> <span class=\\"token class-name\\">Term</span><span class=\\"token punctuation\\">.</span>exit<span class=\\"token punctuation\\">;</span></code></pre></div>
<p>In the code above the addition implementation is within the task, for a simple
CLI one might argue that it is fine. However, if it was more than a one line it
probably should be moved out. A nice side effect of moving it is that it becomes
easier to test. In the <code class=\\"language-text\\">buildDirs</code> config in package.json there is this library
folder, which is a dependency of the executable part. Create a <code class=\\"language-text\\">Calculator.re</code>
in that folder.</p>
<p>In <code class=\\"language-text\\">Calculator.re</code> will contain the calculation logic. In this example this will
be a small module only to demonstrate the relation between library and executable
folder in the default pesy layout. Add the following function to the \`Calculator.re<code class=\\"language-text\\"></code>
file:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"reason\\"><pre class=\\"language-reason\\"><code class=\\"language-reason\\"><span class=\\"token keyword\\">let</span> add <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span>x<span class=\\"token punctuation\\">,</span> y<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> x <span class=\\"token operator\\">+</span> y</code></pre></div>
<p>It is possible to use library modules inside the executable folder by referring
to the namespace in the package.json config for the library, that was named
<code class=\\"language-text\\">Calc</code>. If we want to use the add function we added we can use <code class=\\"language-text\\">Calc.Calculator.add</code>
or do <code class=\\"language-text\\">open Calc</code> and then <code class=\\"language-text\\">Calculator.add</code>. This means that the task definition can
be changed to the following:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"reason\\"><pre class=\\"language-reason\\"><code class=\\"language-reason\\"><span class=\\"token keyword\\">open</span> <span class=\\"token constructor variable\\">Calc</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">let</span> add <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">let</span> x <span class=\\"token operator\\">=</span> <span class=\\"token class-name\\">Arg</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">(</span>value &amp; pos<span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">,</span> int<span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span> &amp; info<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>docv<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"number\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>doc<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"First number\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">let</span> y <span class=\\"token operator\\">=</span> <span class=\\"token class-name\\">Arg</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">(</span>value &amp; pos<span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">,</span> int<span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span> &amp; info<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>docv<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"number\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>doc<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"Second number\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">(</span>
    <span class=\\"token class-name\\">Term</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">(</span>const<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span>x<span class=\\"token punctuation\\">,</span> y<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> print_result<span class=\\"token punctuation\\">(</span><span class=\\"token class-name\\">Calculator</span><span class=\\"token punctuation\\">.</span>add<span class=\\"token punctuation\\">(</span>x<span class=\\"token punctuation\\">,</span> y<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span> $ x $ y<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token class-name\\">Term</span><span class=\\"token punctuation\\">.</span>info<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"add\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>version<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>Try to run <code class=\\"language-text\\">esy x CalcApp.exe add 2 3</code> it should print the result and it should
be something like the output below. 🎉</p>
<div class=\\"gatsby-highlight\\" data-language=\\"shell\\"><pre class=\\"language-shell\\"><code class=\\"language-shell\\">Result: <span class=\\"token number\\">5</span></code></pre></div>
<p>Congratulations on making a CLI with Reason. Next steps might be to look at <a href=\\"https://reason-native.com/docs/rely/\\">rely</a>
to create some tests for the library code. I have made a companion repository
for this post on <a href=\\"https://github.com/relekang/reason-calculator\\">github.com/relekang/reason-calculator</a> if you get stuck on
something you can have a look there or if you just want to have a look at the code.</p>",
        "@": Object {},
      },
      "date": 2019-02-12T00:00:00.000Z,
      "description": "<p>Recently I have started to look into the native compilation of Reason. There
are many use cases for compiling to native, e.g. fast CLIs, react based ui
development without a browser runtime like electron or using  Reason for the
backend of a project. I am writing this to gather some getting started info
as I go and will try to keep things up to date as I learn more.</p>
<p>The goal of this blogpost is to create a simple CLI for basic calculation.
Not the most useful CLI tool, but a small thing to get started. The post
might make more sense if you have a little bit prior knowledge about Reason.
However, don't be afraid to try setting this up, but the post does not explain
Reason syntax. The <a href=\\"https://reasonml.github.io/\\">reason documentation</a> and the
<a href=\\"https://egghead.io/courses/get-started-with-reason\\">egghead.io course getting started with reason</a> are good
resources.</p>
<p>We are going to use a few different tools.</p>
<ul>
<li><a href=\\"https://esy.sh/\\"><strong>Esy</strong></a> helps us manage dependencies and package our code based on
package.json.</li>
<li><a href=\\"https://github.com/jordwalke/pesy\\"><strong>Pesy</strong></a> is a tool that has two useful features that we will leverage:
creating esy projects and configuring dune.</li>
<li><a href=\\"https://dune.build/\\"><strong>Dune</strong></a> is a build system for ocaml and reason. It will take care
of compiling and running our code in development.</li>
<li><a href=\\"https://reason-native.com\\"><strong>reason native</strong></a> is a collection of libraries for creating natively compiled applications.</li>
</ul>
<h2>Setting up the project</h2>
<p>Firstly, we need to setup the project with some basic build tools.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"shell\\"><pre class=\\"language-shell\\"><code class=\\"language-shell\\"><span class=\\"token function\\">npm</span> <span class=\\"token function\\">install</span> -g esy pesy
<span class=\\"token function\\">mkdir</span> calc <span class=\\"token operator\\">&amp;&amp;</span> <span class=\\"token builtin class-name\\">cd</span> calc
pesy</code></pre></div>
<p>This will create a file structure like the list below. There will be more
files, however, these are the most relevant ones. The folders <code class=\\"language-text\\">executable</code>,
<code class=\\"language-text\\">library</code> and <code class=\\"language-text\\">test</code> are different source directories. <code class=\\"language-text\\">dune-project</code> and
<code class=\\"language-text\\">dune</code> are config files for dune. Those are automatically maintained by pesy
so we do not need to edit those manually. The <code class=\\"language-text\\">calc.opam</code> is the config
file for the ocaml package manager, kind of like package.json is for npm. At
last this project also have a package.json, which is used to specify
dependencies for esy and the build configuration for pesy.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\">executable/
library/
test/
calc.opam
dune
dune-project
package.json</code></pre></div>
<p>If we look into the package.json it has some configuration for both esy
and pesy:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"json\\"><pre class=\\"language-json\\"><code class=\\"language-json\\"><span class=\\"token punctuation\\">{</span>
  <span class=\\"token property\\">\\"esy\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">\\"build\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"pesy\\"</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token property\\">\\"release\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token property\\">\\"releasedBinaries\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"CalcApp.exe\\"</span><span class=\\"token punctuation\\">]</span>
    <span class=\\"token punctuation\\">}</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token property\\">\\"buildDirs\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">\\"test\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token property\\">\\"require\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"Calc.lib\\"</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span>
      <span class=\\"token property\\">\\"main\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"TestCalc\\"</span><span class=\\"token punctuation\\">,</span>
      <span class=\\"token property\\">\\"name\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"TestCalc.exe\\"</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token property\\">\\"library\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token property\\">\\"name\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"Calc.lib\\"</span><span class=\\"token punctuation\\">,</span>
      <span class=\\"token property\\">\\"namespace\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"Calc\\"</span>
    <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token property\\">\\"executable\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token property\\">\\"require\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">[</span><span class=\\"token string\\">\\"Calc.lib\\"</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span>
      <span class=\\"token property\\">\\"main\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"CalcApp\\"</span><span class=\\"token punctuation\\">,</span>
      <span class=\\"token property\\">\\"name\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"CalcApp.exe\\"</span>
    <span class=\\"token punctuation\\">}</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>The easy configuration needs to know how we build things and what we want to
export out of our package since it is handling packaging. Pesy is using the
<code class=\\"language-text\\">buildDirs</code> setting for its config. Each directory that we are using in for
code in the project needs to have a set of settings. Mainly name and
dependencies,
<a href=\\"https://github.com/jordwalke/pesy#supported-config\\">full list of supported config can be found in the pesy readme</a>.
The <code class=\\"language-text\\">buildDirs</code> config in packages.json is the baseline for the config written
into dune files. Thus, every time we update the <code class=\\"language-text\\">buildDirs</code> config we need to run
<code class=\\"language-text\\">esy pesy</code> to update the dune config files. Dune is the tool building the project and
running the ocaml compiler. We run that with <code class=\\"language-text\\">esy build</code> and after building the project
we can run the executable with <code class=\\"language-text\\">esy x CalcApp.exe</code>.</p>
<p>In order to build a release binary of the CLI we can run <code class=\\"language-text\\">esy npm-release</code>, which will
create a folder <code class=\\"language-text\\">_release</code>. It will contain a bin folder with binary and a package.json
for npm publishing and a postinstall script provided by pesy. In order to publish to npm
run <code class=\\"language-text\\">esy npm-release</code> and then <code class=\\"language-text\\">npm publish</code> from the _release folder.</p>
<h2>Implementing the CLI</h2>
<p>Now that the project build tools are set up and configured we are ready to
start the implmentation. Firstly, we need to add some dependencies by running.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\">esy add @reason-native/pastel @opam/cmdliner</code></pre></div>
<p>This will install <a href=\\"https://reason-native.com/docs/pastel/\\">reason native pastel</a> from npm and <a href=\\"https://erratique.ch/software/cmdliner/doc/Cmdliner#basics\\">cmdliner</a> from opam, the
ocaml package manager. Pastel is helpful changing the font-style and colors on the
terminal output. Cmdliner is a tool to parse command line arguments and generate
documentation for command line tools. Furthermore, we need to add these to the libs
sections of the executable package in the <code class=\\"language-text\\">buildDirs</code> config. The result should be:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"json\\"><pre class=\\"language-json\\"><code class=\\"language-json\\"><span class=\\"token property\\">\\"executable\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token property\\">\\"require\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token punctuation\\">[</span> <span class=\\"token string\\">\\"cmdliner\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"pastel.lib\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"calc.lib\\"</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token property\\">\\"main\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"CalcApp\\"</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token property\\">\\"name\\"</span><span class=\\"token operator\\">:</span> <span class=\\"token string\\">\\"CalcApp.exe\\"</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>The first thing we will add is a default command and run eval with cmdliner. This
code should be in <code class=\\"language-text\\">./executable/CalcApp.re</code>. The
following code will make the default command list the help screen generated by
cmdliner.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"reason\\"><pre class=\\"language-reason\\"><code class=\\"language-reason\\"><span class=\\"token keyword\\">open</span> <span class=\\"token constructor variable\\">Cmdliner</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">let</span> version <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"1.0.0\\"</span>

<span class=\\"token keyword\\">let</span> default <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span>
  <span class=\\"token class-name\\">Term</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">(</span>ret<span class=\\"token punctuation\\">(</span>const<span class=\\"token punctuation\\">(</span>_ <span class=\\"token operator\\">=></span> <span class=\\"token operator\\">\`</span><span class=\\"token constructor variable\\">Help</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">\`</span><span class=\\"token constructor variable\\">Pager</span><span class=\\"token punctuation\\">,</span> <span class=\\"token constructor variable\\">None</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span> $ const<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token class-name\\">Term</span><span class=\\"token punctuation\\">.</span>info<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"calc\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>version<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token keyword\\">let</span> _ <span class=\\"token operator\\">=</span> <span class=\\"token class-name\\">Term</span><span class=\\"token punctuation\\">.</span>eval_choice<span class=\\"token punctuation\\">(</span>default<span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">|></span> <span class=\\"token class-name\\">Term</span><span class=\\"token punctuation\\">.</span>exit<span class=\\"token punctuation\\">;</span></code></pre></div>
<p>The empty list in <code class=\\"language-text\\">eval_choice</code> is where the sub commands should be added.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"reason\\"><pre class=\\"language-reason\\"><code class=\\"language-reason\\"><span class=\\"token keyword\\">let</span> add <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">let</span> x <span class=\\"token operator\\">=</span> <span class=\\"token class-name\\">Arg</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">(</span>value &amp; pos<span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">,</span> int<span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span> &amp; info<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>docv<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"number\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>doc<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"First number\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">let</span> y <span class=\\"token operator\\">=</span> <span class=\\"token class-name\\">Arg</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">(</span>value &amp; pos<span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">,</span> int<span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span> &amp; info<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>docv<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"number\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>doc<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"Second number\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">(</span>
    <span class=\\"token class-name\\">Term</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">(</span>const<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span>x<span class=\\"token punctuation\\">,</span> y<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> print_result<span class=\\"token punctuation\\">(</span>x <span class=\\"token operator\\">+</span> y<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span> $ x $ y<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token class-name\\">Term</span><span class=\\"token punctuation\\">.</span>info<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"add\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>version<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>In this part we define a new command <code class=\\"language-text\\">add</code> which takes two positional
arguments. Two numbers that we will add together. Let us break down the
different parts of the argument definition. In
<code class=\\"language-text\\">Arg.(value &amp; pos(0, int, 0) &amp; info([], ~docv=&quot;number&quot;, ~doc=&quot;First number&quot;))</code>
there is three main parts. <code class=\\"language-text\\">value</code> tells that we want to extract the value, not
just whether it is there(<code class=\\"language-text\\">flag</code>). <code class=\\"language-text\\">pos(0, int, 0)</code> is to instruct that this is
the positional argument at position 0 parsed as an integer with 0 as the default
value. <code class=\\"language-text\\">info([], ~docv=&quot;number&quot;, ~doc=&quot;First number&quot;))</code> is to generate the
documentation about the option. The empty list would contain the name if this was
an option, <code class=\\"language-text\\">docv</code> is for the usage string while <code class=\\"language-text\\">doc</code> is for the man page.</p>
<p>Furthermore, in the creation of the command we have the statement.
<code class=\\"language-text\\">Term.(const((x, y) =&gt; print_result(x + y)) $ x $ y)</code> which
defines that the command should run the function
<code class=\\"language-text\\">(x, y) =&gt; print_result(x + y)</code> when called. It knows about
the arguments from the <code class=\\"language-text\\">$ x $ y</code> which applies the argument definition to
the command. If you try to remove <code class=\\"language-text\\">$ y</code> you will get a compile error
complaining that at some place <code class=\\"language-text\\">unit</code> was expected but <code class=\\"language-text\\">int =&gt; unit</code> was
received. That is because the function in the command takes in both <code class=\\"language-text\\">x</code>
and <code class=\\"language-text\\">y</code>, but only the argument definition for <code class=\\"language-text\\">x</code> is applied.</p>
<p>In the command above we have used a function <code class=\\"language-text\\">print_result</code> that does
not exist. This is a nice use case for <a href=\\"https://reason-native.com/docs/pastel/\\">pastel</a>, which
is a library to handle styling of printed text in the terminal. Below is
an implementation of the <code class=\\"language-text\\">print_result</code> function.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"reason\\"><pre class=\\"language-reason\\"><code class=\\"language-reason\\"><span class=\\"token keyword\\">let</span> print_result <span class=\\"token operator\\">=</span> result <span class=\\"token operator\\">=></span>
  <span class=\\"token class-name\\">Pastel</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">(</span>
    <span class=\\"token operator\\">&lt;</span><span class=\\"token constructor variable\\">Pastel</span><span class=\\"token operator\\">></span>
      <span class=\\"token operator\\">&lt;</span><span class=\\"token constructor variable\\">Pastel</span> color<span class=\\"token operator\\">=</span><span class=\\"token constructor variable\\">BlackBright</span><span class=\\"token operator\\">></span> <span class=\\"token string\\">\\"Result: \\"</span> <span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span><span class=\\"token constructor variable\\">Pastel</span><span class=\\"token operator\\">></span>
      <span class=\\"token operator\\">&lt;</span><span class=\\"token constructor variable\\">Pastel</span> bold<span class=\\"token operator\\">=</span><span class=\\"token boolean\\">true</span><span class=\\"token operator\\">></span> <span class=\\"token punctuation\\">{</span>string_of_int<span class=\\"token punctuation\\">(</span>result<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span><span class=\\"token constructor variable\\">Pastel</span><span class=\\"token operator\\">></span>
    <span class=\\"token operator\\">&lt;</span><span class=\\"token operator\\">/</span><span class=\\"token constructor variable\\">Pastel</span><span class=\\"token operator\\">></span>
  <span class=\\"token punctuation\\">)</span>
  <span class=\\"token operator\\">|></span> print_endline<span class=\\"token punctuation\\">;</span></code></pre></div>
<p>It will first create a string with the correct formatting, in other words the
<code class=\\"language-text\\">&lt;Pastel&gt;&lt;/Pastel&gt;</code> evaluates to a string. The string is then passed along to
<code class=\\"language-text\\">print_endline</code> from ocaml.</p>
<p>In order to use the add command, it has to be added to the command list so
change the <code class=\\"language-text\\">eval_choice</code> line to:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"reason\\"><pre class=\\"language-reason\\"><code class=\\"language-reason\\"><span class=\\"token keyword\\">let</span> _ <span class=\\"token operator\\">=</span> <span class=\\"token class-name\\">Term</span><span class=\\"token punctuation\\">.</span>eval_choice<span class=\\"token punctuation\\">(</span>default<span class=\\"token punctuation\\">,</span> <span class=\\"token punctuation\\">[</span>add<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">|></span> <span class=\\"token class-name\\">Term</span><span class=\\"token punctuation\\">.</span>exit<span class=\\"token punctuation\\">;</span></code></pre></div>
<p>In the code above the addition implementation is within the task, for a simple
CLI one might argue that it is fine. However, if it was more than a one line it
probably should be moved out. A nice side effect of moving it is that it becomes
easier to test. In the <code class=\\"language-text\\">buildDirs</code> config in package.json there is this library
folder, which is a dependency of the executable part. Create a <code class=\\"language-text\\">Calculator.re</code>
in that folder.</p>
<p>In <code class=\\"language-text\\">Calculator.re</code> will contain the calculation logic. In this example this will
be a small module only to demonstrate the relation between library and executable
folder in the default pesy layout. Add the following function to the \`Calculator.re<code class=\\"language-text\\"></code>
file:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"reason\\"><pre class=\\"language-reason\\"><code class=\\"language-reason\\"><span class=\\"token keyword\\">let</span> add <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span>x<span class=\\"token punctuation\\">,</span> y<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> x <span class=\\"token operator\\">+</span> y</code></pre></div>
<p>It is possible to use library modules inside the executable folder by referring
to the namespace in the package.json config for the library, that was named
<code class=\\"language-text\\">Calc</code>. If we want to use the add function we added we can use <code class=\\"language-text\\">Calc.Calculator.add</code>
or do <code class=\\"language-text\\">open Calc</code> and then <code class=\\"language-text\\">Calculator.add</code>. This means that the task definition can
be changed to the following:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"reason\\"><pre class=\\"language-reason\\"><code class=\\"language-reason\\"><span class=\\"token keyword\\">open</span> <span class=\\"token constructor variable\\">Calc</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">let</span> add <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">let</span> x <span class=\\"token operator\\">=</span> <span class=\\"token class-name\\">Arg</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">(</span>value &amp; pos<span class=\\"token punctuation\\">(</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">,</span> int<span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span> &amp; info<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>docv<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"number\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>doc<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"First number\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token keyword\\">let</span> y <span class=\\"token operator\\">=</span> <span class=\\"token class-name\\">Arg</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">(</span>value &amp; pos<span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">,</span> int<span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span> &amp; info<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>docv<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"number\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>doc<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"Second number\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
  <span class=\\"token punctuation\\">(</span>
    <span class=\\"token class-name\\">Term</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">(</span>const<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span>x<span class=\\"token punctuation\\">,</span> y<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> print_result<span class=\\"token punctuation\\">(</span><span class=\\"token class-name\\">Calculator</span><span class=\\"token punctuation\\">.</span>add<span class=\\"token punctuation\\">(</span>x<span class=\\"token punctuation\\">,</span> y<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span> $ x $ y<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token class-name\\">Term</span><span class=\\"token punctuation\\">.</span>info<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"add\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">~</span>version<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span></code></pre></div>
<p>Try to run <code class=\\"language-text\\">esy x CalcApp.exe add 2 3</code> it should print the result and it should
be something like the output below. 🎉</p>
<div class=\\"gatsby-highlight\\" data-language=\\"shell\\"><pre class=\\"language-shell\\"><code class=\\"language-shell\\">Result: <span class=\\"token number\\">5</span></code></pre></div>
<p>Congratulations on making a CLI with Reason. Next steps might be to look at <a href=\\"https://reason-native.com/docs/rely/\\">rely</a>
to create some tests for the library code. I have made a companion repository
for this post on <a href=\\"https://github.com/relekang/reason-calculator\\">github.com/relekang/reason-calculator</a> if you get stuck on
something you can have a look there or if you just want to have a look at the code.</p>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/creating-a-cli-with-reason-native",
      "image": Object {},
      "link": "https://rolflekang.com/creating-a-cli-with-reason-native",
      "origlink": null,
      "pubDate": "2019-02-12T00:00:00.000Z",
      "pubdate": 2019-02-12T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "reasonml",
          "@": Object {},
        },
        Object {
          "#": "native",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "Recently I have started to look into the native compilation of Reason. There
are many use cases for compiling to native, e.g. fast CLIs…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/creating-a-cli-with-reason-native",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/creating-a-cli-with-reason-native",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Tue, 12 Feb 2019 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Creating a CLI with  Reason native",
        "@": Object {},
      },
      "source": Object {},
      "summary": "Recently I have started to look into the native compilation of Reason. There
are many use cases for compiling to native, e.g. fast CLIs…",
      "title": "Creating a CLI with  Reason native",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "graphql",
        "testing",
        "javascript",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>I recently created a <a href=\\"https://github.com/relekang/graphql-rss-parser\\">GraphQL based microservice</a> for parsing RSS-feeds. I wanted
to write something down about the approach I took to test the API. The service is read only, as
there is little we can push out into others RSS feeds.</p>
<p>GraphQL returns 200 status for almost everything. Whenever error occurs it only pushes the error
to a list of errors that is passed to the payload. This is because it is designed to be resillient
and give as much information as it can even when something fails. This also means that we can
abstract away the most part of successful and unsuccessful requests in our tests and still get
valid tests. Thus, when testing the API layer of this service the only thing that matters is the
query and the response.</p>
<p>Services like graphql-rss-parser has another characteristic that makes them easy to test. No
authentication or authorization, which means that we do not need to check different types of errors
based on different states of authorization. Thus, it is only the GraphQL query and the response
that matters.</p>
<p>I created a helper that allowed me to write tests in an easy way with focus on the queries. The
tests look like this:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\">testGraphQlService<span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">{
  feed(url=\\"https://rolflekang.com/feed.xml\\") {
    entries {
      title
    }
  }
}
 </span><span class=\\"token template-punctuation string\\">\`</span></span></code></pre></div>
<p>Under the hood that helper creates a <a href=\\"https://facebook.github.io/jest/\\">jest</a> test that asserts to a snapshot with jests handy
<a href=\\"http://facebook.github.io/jest/docs/expect.html#tomatchsnapshotoptionalstring\\">toMatchSnapshot()</a>. This generates a snapshot file for every test file with a map of responses
with the query as key. Thus, reviewing these tests and test changes is a bliss. Below is the
implementation of the test helper as it was in graphql-rss-parser at the time when this was written.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token keyword\\">const</span> request <span class=\\"token operator\\">=</span> <span class=\\"token function\\">require</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'superagent'</span><span class=\\"token punctuation\\">)</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">createTestServer</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">/*
   * Set up a test instance and return url.
   * For graphql-rss-parser I used this https://github.com/zeit/micro#testing
   */</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">testGraphqlApi</span> <span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">strings<span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">...</span>args</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> query <span class=\\"token operator\\">=</span> String<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">raw</span><span class=\\"token punctuation\\">(</span>strings<span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">...</span>args<span class=\\"token punctuation\\">)</span>
  <span class=\\"token function\\">test</span><span class=\\"token punctuation\\">(</span>query<span class=\\"token punctuation\\">,</span> <span class=\\"token keyword\\">async</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">let</span> response
    <span class=\\"token keyword\\">const</span> url <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">await</span> <span class=\\"token function\\">createTestServer</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>

    <span class=\\"token keyword\\">try</span> <span class=\\"token punctuation\\">{</span>
      response <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">await</span> request
        <span class=\\"token punctuation\\">.</span><span class=\\"token function\\">post</span><span class=\\"token punctuation\\">(</span>url<span class=\\"token punctuation\\">)</span>
        <span class=\\"token punctuation\\">.</span><span class=\\"token function\\">set</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'User-Agent'</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'graphql-test'</span><span class=\\"token punctuation\\">)</span>
        <span class=\\"token punctuation\\">.</span><span class=\\"token function\\">set</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Content-Type'</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'application/json'</span><span class=\\"token punctuation\\">)</span>
        <span class=\\"token punctuation\\">.</span><span class=\\"token function\\">send</span><span class=\\"token punctuation\\">(</span><span class=\\"token constant\\">JSON</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">stringify</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> query <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>
      <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span>body
    <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">catch</span> <span class=\\"token punctuation\\">(</span>error<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">!</span>error<span class=\\"token punctuation\\">.</span>response<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
        <span class=\\"token keyword\\">throw</span> error
      <span class=\\"token punctuation\\">}</span>

      response <span class=\\"token operator\\">=</span> error<span class=\\"token punctuation\\">.</span>response<span class=\\"token punctuation\\">.</span>body
    <span class=\\"token punctuation\\">}</span>

    <span class=\\"token function\\">expect</span><span class=\\"token punctuation\\">(</span>response<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">toMatchSnapshot</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>It has made it easy to write good and readable API tests of the little microservice. However,
keep in mind that this is a sufficient solution due to the assumptions discussed earlier so it
might not be a fit approach for you project, nevertheless, feel free to take the helper. Let me
know how it works out for you ✌️</p>",
        "@": Object {},
      },
      "date": 2017-05-28T00:00:00.000Z,
      "description": "<p>I recently created a <a href=\\"https://github.com/relekang/graphql-rss-parser\\">GraphQL based microservice</a> for parsing RSS-feeds. I wanted
to write something down about the approach I took to test the API. The service is read only, as
there is little we can push out into others RSS feeds.</p>
<p>GraphQL returns 200 status for almost everything. Whenever error occurs it only pushes the error
to a list of errors that is passed to the payload. This is because it is designed to be resillient
and give as much information as it can even when something fails. This also means that we can
abstract away the most part of successful and unsuccessful requests in our tests and still get
valid tests. Thus, when testing the API layer of this service the only thing that matters is the
query and the response.</p>
<p>Services like graphql-rss-parser has another characteristic that makes them easy to test. No
authentication or authorization, which means that we do not need to check different types of errors
based on different states of authorization. Thus, it is only the GraphQL query and the response
that matters.</p>
<p>I created a helper that allowed me to write tests in an easy way with focus on the queries. The
tests look like this:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\">testGraphQlService<span class=\\"token template-string\\"><span class=\\"token template-punctuation string\\">\`</span><span class=\\"token string\\">{
  feed(url=\\"https://rolflekang.com/feed.xml\\") {
    entries {
      title
    }
  }
}
 </span><span class=\\"token template-punctuation string\\">\`</span></span></code></pre></div>
<p>Under the hood that helper creates a <a href=\\"https://facebook.github.io/jest/\\">jest</a> test that asserts to a snapshot with jests handy
<a href=\\"http://facebook.github.io/jest/docs/expect.html#tomatchsnapshotoptionalstring\\">toMatchSnapshot()</a>. This generates a snapshot file for every test file with a map of responses
with the query as key. Thus, reviewing these tests and test changes is a bliss. Below is the
implementation of the test helper as it was in graphql-rss-parser at the time when this was written.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"js\\"><pre class=\\"language-js\\"><code class=\\"language-js\\"><span class=\\"token keyword\\">const</span> request <span class=\\"token operator\\">=</span> <span class=\\"token function\\">require</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'superagent'</span><span class=\\"token punctuation\\">)</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">createTestServer</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token comment\\">/*
   * Set up a test instance and return url.
   * For graphql-rss-parser I used this https://github.com/zeit/micro#testing
   */</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">function</span> <span class=\\"token function\\">testGraphqlApi</span> <span class=\\"token punctuation\\">(</span><span class=\\"token parameter\\">strings<span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">...</span>args</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
  <span class=\\"token keyword\\">const</span> query <span class=\\"token operator\\">=</span> String<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">raw</span><span class=\\"token punctuation\\">(</span>strings<span class=\\"token punctuation\\">,</span> <span class=\\"token operator\\">...</span>args<span class=\\"token punctuation\\">)</span>
  <span class=\\"token function\\">test</span><span class=\\"token punctuation\\">(</span>query<span class=\\"token punctuation\\">,</span> <span class=\\"token keyword\\">async</span> <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">let</span> response
    <span class=\\"token keyword\\">const</span> url <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">await</span> <span class=\\"token function\\">createTestServer</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>

    <span class=\\"token keyword\\">try</span> <span class=\\"token punctuation\\">{</span>
      response <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">await</span> request
        <span class=\\"token punctuation\\">.</span><span class=\\"token function\\">post</span><span class=\\"token punctuation\\">(</span>url<span class=\\"token punctuation\\">)</span>
        <span class=\\"token punctuation\\">.</span><span class=\\"token function\\">set</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'User-Agent'</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'graphql-test'</span><span class=\\"token punctuation\\">)</span>
        <span class=\\"token punctuation\\">.</span><span class=\\"token function\\">set</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Content-Type'</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'application/json'</span><span class=\\"token punctuation\\">)</span>
        <span class=\\"token punctuation\\">.</span><span class=\\"token function\\">send</span><span class=\\"token punctuation\\">(</span><span class=\\"token constant\\">JSON</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">stringify</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">{</span> query <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>
      <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span>body
    <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">catch</span> <span class=\\"token punctuation\\">(</span>error<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
      <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">!</span>error<span class=\\"token punctuation\\">.</span>response<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
        <span class=\\"token keyword\\">throw</span> error
      <span class=\\"token punctuation\\">}</span>

      response <span class=\\"token operator\\">=</span> error<span class=\\"token punctuation\\">.</span>response<span class=\\"token punctuation\\">.</span>body
    <span class=\\"token punctuation\\">}</span>

    <span class=\\"token function\\">expect</span><span class=\\"token punctuation\\">(</span>response<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">toMatchSnapshot</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>
  <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>It has made it easy to write good and readable API tests of the little microservice. However,
keep in mind that this is a sufficient solution due to the assumptions discussed earlier so it
might not be a fit approach for you project, nevertheless, feel free to take the helper. Let me
know how it works out for you ✌️</p>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/testing-simple-graphql-services",
      "image": Object {},
      "link": "https://rolflekang.com/testing-simple-graphql-services",
      "origlink": null,
      "pubDate": "2017-05-28T00:00:00.000Z",
      "pubdate": 2017-05-28T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "graphql",
          "@": Object {},
        },
        Object {
          "#": "testing",
          "@": Object {},
        },
        Object {
          "#": "javascript",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "I recently created a GraphQL based microservice for parsing RSS-feeds. I wanted
to write something down about the approach I took to test…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/testing-simple-graphql-services",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/testing-simple-graphql-services",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Sun, 28 May 2017 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Testing simple GraphQL services",
        "@": Object {},
      },
      "source": Object {},
      "summary": "I recently created a GraphQL based microservice for parsing RSS-feeds. I wanted
to write something down about the approach I took to test…",
      "title": "Testing simple GraphQL services",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "running",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>This will be the first year that I enter a running race, ever.
I am pretty excited. I am at the moment aiming at three races
for this year.</p>
<ul>
<li>Birkebeinerløpet (21km)</li>
<li>Oslo Half-marathon</li>
<li>Nordmarka Ultra-Challenge (26 or 54km)</li>
</ul>
<p>The last one is still a maybe depending on how the two others
go. It is not a question of whether I am going to race, but whether
I am going for 54km or the shorter distance.</p>
<p>See you on the trails 🏃</p>",
        "@": Object {},
      },
      "date": 2017-01-02T00:00:00.000Z,
      "description": "<p>This will be the first year that I enter a running race, ever.
I am pretty excited. I am at the moment aiming at three races
for this year.</p>
<ul>
<li>Birkebeinerløpet (21km)</li>
<li>Oslo Half-marathon</li>
<li>Nordmarka Ultra-Challenge (26 or 54km)</li>
</ul>
<p>The last one is still a maybe depending on how the two others
go. It is not a question of whether I am going to race, but whether
I am going for 54km or the shorter distance.</p>
<p>See you on the trails 🏃</p>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/lets-run-some-races",
      "image": Object {},
      "link": "https://rolflekang.com/lets-run-some-races",
      "origlink": null,
      "pubDate": "2017-01-02T00:00:00.000Z",
      "pubdate": 2017-01-02T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Object {
        "#": "running",
        "@": Object {},
      },
      "rss:description": Object {
        "#": "This will be the first year that I enter a running race, ever.
I am pretty excited. I am at the moment aiming at three races
for this year…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/lets-run-some-races",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/lets-run-some-races",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Mon, 02 Jan 2017 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Let's run some races this year",
        "@": Object {},
      },
      "source": Object {},
      "summary": "This will be the first year that I enter a running race, ever.
I am pretty excited. I am at the moment aiming at three races
for this year…",
      "title": "Let's run some races this year",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "ipad",
        "development-environment",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>I recently bought an iPad Pro as a replacement for my computer at home. The old one was a
Macbook Pro that is taking its last spins these days. I wanted a device that was more of
a creative tool and also one that I could use to read things from <a href=\\"https://getpocket.com\\">pocket</a> and such.
Thus I landed on an iPad. It gets also used a bit for reading with the Kindle app.</p>
<p>The tools I use when I do development on the iPad is mostly <a href=\\"https://blink.sh\\">Blink</a> and <a href=\\"http://ergowebtools.com\\">Ergo WebTools</a>.
Blink is simply the best ssh client for a tablet/mobile operative system that I have used. I
am pretty sure I have tested most of the other ones the last few years. Ergo WebTools is neat
since Safari requires a Mac to be able to view the developer tools.</p>
<p>You might have guessed that I do development through a server, since Blink is a ssh and mosh
client. I use mosh to connect which smoothes out flakey connections and lost packages.
On the server I write code, and blogposts like this one with <a href=\\"https://vim.org\\">vim</a>. I use for this since
it is my editor of choice for most things these days. There are many great options for
editors. Web based IDE might be a nice option. Furthermore, I have found <a href=\\"https://tmux.github.io\\">tmux</a> to be
very helpful while running development servers and tests besides the <a href=\\"https://vim.org\\">vim</a> editor.</p>
<p>The server is a Ubuntu 16.10 which makes it able to run all I want to run on it
without much hassle. Since a good part of what I use it for is web development
I have created a nginx proxy that proxies <code class=\\"language-text\\">&lt;port&gt;.dev.a.domain</code> to <code class=\\"language-text\\">127.0.0.1:&lt;port&gt;</code>.
It works well, and adding a basic auth password on the redirect makes it a bit
more safe to expose all ports through ngnix. The code below is pretty much what
runs that proxy. Webpack with hot reloading requires websockets, but that is
straight forward to set up if one follows the documentation.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"nginx\\"><pre class=\\"language-nginx\\"><code class=\\"language-nginx\\"><span class=\\"token keyword\\">server</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">listen</span> <span class=\\"token number\\">80</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">server_name</span> <span class=\\"token operator\\">~</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">?</span><span class=\\"token operator\\">&lt;</span>sub<span class=\\"token operator\\">></span><span class=\\"token punctuation\\">[</span><span class=\\"token operator\\">^</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">]</span><span class=\\"token operator\\">+</span><span class=\\"token punctuation\\">)</span>\\\\<span class=\\"token punctuation\\">.</span>dev\\\\<span class=\\"token punctuation\\">.</span>example\\\\<span class=\\"token punctuation\\">.</span>com<span class=\\"token punctuation\\">;</span>

    <span class=\\"token keyword\\">access_log</span> <span class=\\"token operator\\">/</span>var<span class=\\"token operator\\">/</span>log<span class=\\"token operator\\">/</span>nginx<span class=\\"token operator\\">/</span>dev<span class=\\"token punctuation\\">.</span>access<span class=\\"token punctuation\\">.</span>log<span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">error_log</span> <span class=\\"token operator\\">/</span>var<span class=\\"token operator\\">/</span>log<span class=\\"token operator\\">/</span>nginx<span class=\\"token operator\\">/</span>dev<span class=\\"token punctuation\\">.</span>error<span class=\\"token punctuation\\">.</span>log<span class=\\"token punctuation\\">;</span>

    <span class=\\"token keyword\\">location</span> <span class=\\"token operator\\">/</span> <span class=\\"token punctuation\\">{</span>
        <span class=\\"token keyword\\">proxy_pass</span> <span class=\\"token keyword\\">http</span><span class=\\"token punctuation\\">:</span><span class=\\"token operator\\">/</span><span class=\\"token operator\\">/</span><span class=\\"token number\\">127.0</span><span class=\\"token number\\">.0</span><span class=\\"token number\\">.1</span><span class=\\"token punctuation\\">:</span><span class=\\"token variable\\">$sub</span><span class=\\"token punctuation\\">;</span>
        <span class=\\"token keyword\\">proxy_set_header</span> Host <span class=\\"token variable\\">$host</span><span class=\\"token punctuation\\">;</span>
        <span class=\\"token keyword\\">proxy_set_header</span> X<span class=\\"token operator\\">-</span>Real<span class=\\"token operator\\">-</span>IP <span class=\\"token variable\\">$remote_addr</span><span class=\\"token punctuation\\">;</span>
        <span class=\\"token keyword\\">proxy_set_header</span> X<span class=\\"token operator\\">-</span>Forwarded<span class=\\"token operator\\">-</span>For <span class=\\"token variable\\">$proxy_add_x_forwarded_for</span><span class=\\"token punctuation\\">;</span>
        <span class=\\"token keyword\\">client_max_body_size</span> <span class=\\"token number\\">10</span>m<span class=\\"token punctuation\\">;</span>

        <span class=\\"token keyword\\">auth_basic</span>           <span class=\\"token string\\">\\"closed site\\"</span><span class=\\"token punctuation\\">;</span>
        <span class=\\"token keyword\\">auth_basic_user_file</span> <span class=\\"token operator\\">/</span>etc<span class=\\"token operator\\">/</span>nginx<span class=\\"token operator\\">/</span>htpasswd<span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>Developing server side applications or libraries does not require much tools
in addition to the ones that are available from the command line. Web
applications and frontend things on the other hand. Web developer tools are
necessary or at least a real time saver. Safari requires a laptop to use the
developer tools which is not very helpful when trying to create a ipad only
setup. <a href=\\"http://ergowebtools.com\\">Ergo WebTools</a> is an app that implements developer tools around a
Safari web view. I have not used it that much yet. However, it seems to be
okay and useful even though it is far from what we are used to from modern
browsers these days.</p>
<p>All in all it works well and is a nice change of scenery from time to time.
It is definitively a nicer option to bring to cafes and such.</p>",
        "@": Object {},
      },
      "date": 2017-01-01T00:00:00.000Z,
      "description": "<p>I recently bought an iPad Pro as a replacement for my computer at home. The old one was a
Macbook Pro that is taking its last spins these days. I wanted a device that was more of
a creative tool and also one that I could use to read things from <a href=\\"https://getpocket.com\\">pocket</a> and such.
Thus I landed on an iPad. It gets also used a bit for reading with the Kindle app.</p>
<p>The tools I use when I do development on the iPad is mostly <a href=\\"https://blink.sh\\">Blink</a> and <a href=\\"http://ergowebtools.com\\">Ergo WebTools</a>.
Blink is simply the best ssh client for a tablet/mobile operative system that I have used. I
am pretty sure I have tested most of the other ones the last few years. Ergo WebTools is neat
since Safari requires a Mac to be able to view the developer tools.</p>
<p>You might have guessed that I do development through a server, since Blink is a ssh and mosh
client. I use mosh to connect which smoothes out flakey connections and lost packages.
On the server I write code, and blogposts like this one with <a href=\\"https://vim.org\\">vim</a>. I use for this since
it is my editor of choice for most things these days. There are many great options for
editors. Web based IDE might be a nice option. Furthermore, I have found <a href=\\"https://tmux.github.io\\">tmux</a> to be
very helpful while running development servers and tests besides the <a href=\\"https://vim.org\\">vim</a> editor.</p>
<p>The server is a Ubuntu 16.10 which makes it able to run all I want to run on it
without much hassle. Since a good part of what I use it for is web development
I have created a nginx proxy that proxies <code class=\\"language-text\\">&lt;port&gt;.dev.a.domain</code> to <code class=\\"language-text\\">127.0.0.1:&lt;port&gt;</code>.
It works well, and adding a basic auth password on the redirect makes it a bit
more safe to expose all ports through ngnix. The code below is pretty much what
runs that proxy. Webpack with hot reloading requires websockets, but that is
straight forward to set up if one follows the documentation.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"nginx\\"><pre class=\\"language-nginx\\"><code class=\\"language-nginx\\"><span class=\\"token keyword\\">server</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">listen</span> <span class=\\"token number\\">80</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">server_name</span> <span class=\\"token operator\\">~</span><span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">?</span><span class=\\"token operator\\">&lt;</span>sub<span class=\\"token operator\\">></span><span class=\\"token punctuation\\">[</span><span class=\\"token operator\\">^</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">]</span><span class=\\"token operator\\">+</span><span class=\\"token punctuation\\">)</span>\\\\<span class=\\"token punctuation\\">.</span>dev\\\\<span class=\\"token punctuation\\">.</span>example\\\\<span class=\\"token punctuation\\">.</span>com<span class=\\"token punctuation\\">;</span>

    <span class=\\"token keyword\\">access_log</span> <span class=\\"token operator\\">/</span>var<span class=\\"token operator\\">/</span>log<span class=\\"token operator\\">/</span>nginx<span class=\\"token operator\\">/</span>dev<span class=\\"token punctuation\\">.</span>access<span class=\\"token punctuation\\">.</span>log<span class=\\"token punctuation\\">;</span>
    <span class=\\"token keyword\\">error_log</span> <span class=\\"token operator\\">/</span>var<span class=\\"token operator\\">/</span>log<span class=\\"token operator\\">/</span>nginx<span class=\\"token operator\\">/</span>dev<span class=\\"token punctuation\\">.</span>error<span class=\\"token punctuation\\">.</span>log<span class=\\"token punctuation\\">;</span>

    <span class=\\"token keyword\\">location</span> <span class=\\"token operator\\">/</span> <span class=\\"token punctuation\\">{</span>
        <span class=\\"token keyword\\">proxy_pass</span> <span class=\\"token keyword\\">http</span><span class=\\"token punctuation\\">:</span><span class=\\"token operator\\">/</span><span class=\\"token operator\\">/</span><span class=\\"token number\\">127.0</span><span class=\\"token number\\">.0</span><span class=\\"token number\\">.1</span><span class=\\"token punctuation\\">:</span><span class=\\"token variable\\">$sub</span><span class=\\"token punctuation\\">;</span>
        <span class=\\"token keyword\\">proxy_set_header</span> Host <span class=\\"token variable\\">$host</span><span class=\\"token punctuation\\">;</span>
        <span class=\\"token keyword\\">proxy_set_header</span> X<span class=\\"token operator\\">-</span>Real<span class=\\"token operator\\">-</span>IP <span class=\\"token variable\\">$remote_addr</span><span class=\\"token punctuation\\">;</span>
        <span class=\\"token keyword\\">proxy_set_header</span> X<span class=\\"token operator\\">-</span>Forwarded<span class=\\"token operator\\">-</span>For <span class=\\"token variable\\">$proxy_add_x_forwarded_for</span><span class=\\"token punctuation\\">;</span>
        <span class=\\"token keyword\\">client_max_body_size</span> <span class=\\"token number\\">10</span>m<span class=\\"token punctuation\\">;</span>

        <span class=\\"token keyword\\">auth_basic</span>           <span class=\\"token string\\">\\"closed site\\"</span><span class=\\"token punctuation\\">;</span>
        <span class=\\"token keyword\\">auth_basic_user_file</span> <span class=\\"token operator\\">/</span>etc<span class=\\"token operator\\">/</span>nginx<span class=\\"token operator\\">/</span>htpasswd<span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>Developing server side applications or libraries does not require much tools
in addition to the ones that are available from the command line. Web
applications and frontend things on the other hand. Web developer tools are
necessary or at least a real time saver. Safari requires a laptop to use the
developer tools which is not very helpful when trying to create a ipad only
setup. <a href=\\"http://ergowebtools.com\\">Ergo WebTools</a> is an app that implements developer tools around a
Safari web view. I have not used it that much yet. However, it seems to be
okay and useful even though it is far from what we are used to from modern
browsers these days.</p>
<p>All in all it works well and is a nice change of scenery from time to time.
It is definitively a nicer option to bring to cafes and such.</p>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/software-development-on-an-ipad",
      "image": Object {},
      "link": "https://rolflekang.com/software-development-on-an-ipad",
      "origlink": null,
      "pubDate": "2017-01-01T00:00:00.000Z",
      "pubdate": 2017-01-01T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "ipad",
          "@": Object {},
        },
        Object {
          "#": "development-environment",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "I recently bought an iPad Pro as a replacement for my computer at home. The old one was a
Macbook Pro that is taking its last spins these…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/software-development-on-an-ipad",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/software-development-on-an-ipad",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Sun, 01 Jan 2017 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Software development on an iPad",
        "@": Object {},
      },
      "source": Object {},
      "summary": "I recently bought an iPad Pro as a replacement for my computer at home. The old one was a
Macbook Pro that is taking its last spins these…",
      "title": "Software development on an iPad",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "linter",
        "linting",
        "development",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>We all learn new stuff every day, that goes for how we write code as well.
Over time our perception of best practices change, the codestyle we prefer
change and what we would like to enforce with linters change.</p>
<p>Changing a linter configuration can be hard. The changes necessary
to use the new configuration could be huge. You learned a new thing
or a new lint rule finally got accepted and you want to start using the
rule. When you add it to your project you are met with a result like the
one below. This means that a significant amount of time must be
allocated to refactoring the code to follow the rule upfront.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\"> ✖ 980 problems (976 errors, 4 warnings)</code></pre></div>
<p>In a few of the projects I participate in we have started to use information
from git to filter out the lint errors that does not apply to the current
changeset. Resulting in the linter output above changing into the one
listed below.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\">0 of 976 errors and 0 of 4 warnings</code></pre></div>
<p>This has allowed us to change the our code guidelines without having to fix it
right away. The impact has been great, as we have had the chance to alter our
guidelines and make sure we do not write more code that does not follow the guidelines.</p>
<p>We made a tool, lint-filter, that will filter a checkstyle based lint report with the
information in the git diff between the current state and the master branch. The way
it works is that it will check that the lines referenced from the errors and warnings
are in the git diff. Below is an example of how to use it with eslint.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\">npm install -g lint-filter
eslint . -f checkstyle | lint-filter</code></pre></div>
<p>This will work for most errors. However, there is a few errors that would be triggered
outside the changeset. One example is unused variables. In most cases it will not be
cached by if you remove the last usage of a variable. To avoid these kinds of false
negatives I recommend running another lint config as well. One were the extra rules
are disabled. lint-filter will help you generate the configuration by running the
following command.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\">lint-filter generate-config --linter eslint</code></pre></div>
<p>Hope this helps you. Happy linting ☕</p>",
        "@": Object {},
      },
      "date": 2016-06-10T00:00:00.000Z,
      "description": "<p>We all learn new stuff every day, that goes for how we write code as well.
Over time our perception of best practices change, the codestyle we prefer
change and what we would like to enforce with linters change.</p>
<p>Changing a linter configuration can be hard. The changes necessary
to use the new configuration could be huge. You learned a new thing
or a new lint rule finally got accepted and you want to start using the
rule. When you add it to your project you are met with a result like the
one below. This means that a significant amount of time must be
allocated to refactoring the code to follow the rule upfront.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\"> ✖ 980 problems (976 errors, 4 warnings)</code></pre></div>
<p>In a few of the projects I participate in we have started to use information
from git to filter out the lint errors that does not apply to the current
changeset. Resulting in the linter output above changing into the one
listed below.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\">0 of 976 errors and 0 of 4 warnings</code></pre></div>
<p>This has allowed us to change the our code guidelines without having to fix it
right away. The impact has been great, as we have had the chance to alter our
guidelines and make sure we do not write more code that does not follow the guidelines.</p>
<p>We made a tool, lint-filter, that will filter a checkstyle based lint report with the
information in the git diff between the current state and the master branch. The way
it works is that it will check that the lines referenced from the errors and warnings
are in the git diff. Below is an example of how to use it with eslint.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\">npm install -g lint-filter
eslint . -f checkstyle | lint-filter</code></pre></div>
<p>This will work for most errors. However, there is a few errors that would be triggered
outside the changeset. One example is unused variables. In most cases it will not be
cached by if you remove the last usage of a variable. To avoid these kinds of false
negatives I recommend running another lint config as well. One were the extra rules
are disabled. lint-filter will help you generate the configuration by running the
following command.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\">lint-filter generate-config --linter eslint</code></pre></div>
<p>Hope this helps you. Happy linting ☕</p>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/filtering-lint-errors",
      "image": Object {},
      "link": "https://rolflekang.com/filtering-lint-errors",
      "origlink": null,
      "pubDate": "2016-06-10T00:00:00.000Z",
      "pubdate": 2016-06-10T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "linter",
          "@": Object {},
        },
        Object {
          "#": "linting",
          "@": Object {},
        },
        Object {
          "#": "development",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "We all learn new stuff every day, that goes for how we write code as well.
Over time our perception of best practices change, the codestyle…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/filtering-lint-errors",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/filtering-lint-errors",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Fri, 10 Jun 2016 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Filtering lint errors",
        "@": Object {},
      },
      "source": Object {},
      "summary": "We all learn new stuff every day, that goes for how we write code as well.
Over time our perception of best practices change, the codestyle…",
      "title": "Filtering lint errors",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "travel",
        "interrail",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>After I finished my master thesis in June I left for a interrail with my girlfriend this summer. Traveling by train has its ups an downs, but overall it was a great experience that I hope to do it again soon. Although we were interrailing we did not by a interrail pass as our research indicated that it would be cheaper without it. In the end we ended up paying half the price we would have payed with interrail tickets.</p>
<p>If you are wondering if you should travel Europe by train then <em>do it</em>.</p>
<h2>The trains</h2>
<p>We started out in Berlin arriving from Norway by airplane. Further on, we took the train to Prague. The train ride was hot as the air condition was broken and a blazing sun with 35 degrees roamed outside. Onwards from Prague we left for Vienna, which was a pleasant ride with the new Railjet trains. The next ride was a short 1 hour ride to Bratislava, not much more to say about that. From there we left for Budapest on a nice and short train ride. The next trip was the longest from Budapest to Zagreb. It got even longer when the train stopped after an hour or so and the someone from the Hungarian Railway said \\"End station. Get off!\\". We got off to see a line of buses, which took us to the next station where a new train was waiting. There was no problem, rather an interesting experience as we traveled small local roads between a couple of train stations without any information about what was happening. After two nights in Zagreb we took a train to Ljubljana. The train ride was incredibly scenic. If you have the chance to take it you should do it. At last but not at least, we went to Rijeka with another train without air condition. However, this was not nearly as hot as the first one.</p>
<p>In my opinion, the train rides ranging from 2,5 to 4 hours were the best. Enough time to read and watch the countryside while listening to a podcast or an audio book. However, not to long to get tired an longing for the destination. All in all, the trips with trains was great and a nice way to visit and see so many different places and cultures. One of the good parts is that you break up the exploring days with some days with a lot of reading and podcast listening.</p>
<h2>A few highlights</h2>
<h4>The burger from <em>The pub</em> in Berlin</h4>
<p>Not much more to say than it's delicious.</p>
<h4>The architecture of Vienna</h4>
<p><span
      class=\\"gatsby-resp-image-wrapper\\"
      style=\\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;\\"
    >
      <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"/static/a6efd0729609dda243a7e9e68d1a04f5/3acf0/vienna.jpg\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >
    <span
    class=\\"gatsby-resp-image-background-image\\"
    style=\\"padding-bottom: 37.23404255319149%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAID/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAZgl0Cf/xAAYEAADAQEAAAAAAAAAAAAAAAAAAQIRE//aAAgBAQABBQLZHSO2H//EABYRAAMAAAAAAAAAAAAAAAAAAAABEf/aAAgBAwEBPwGIiP/EABYRAAMAAAAAAAAAAAAAAAAAAAABEf/aAAgBAgEBPwGsrP/EABcQAAMBAAAAAAAAAAAAAAAAAAABITL/2gAIAQEABj8CqIjJ/8QAGRABAAMBAQAAAAAAAAAAAAAAAQAhkUFh/9oACAEBAAE/ITq7AVd7BUDs/9oADAMBAAIAAwAAABAIL//EABYRAAMAAAAAAAAAAAAAAAAAAAEQUf/aAAgBAwEBPxAyV//EABcRAQADAAAAAAAAAAAAAAAAAAABUWH/2gAIAQIBAT8Qi9s//8QAGxABAAICAwAAAAAAAAAAAAAAAQARITFBYdH/2gAIAQEAAT8QcaVbIWwg56QyxOLfk//Z'); background-size: cover; display: block;\\"
  ></span>
  <img
        class=\\"gatsby-resp-image-image\\"
        alt=\\"... in Vienna\\"
        title=\\"... in Vienna\\"
        src=\\"/static/a6efd0729609dda243a7e9e68d1a04f5/acb04/vienna.jpg\\"
        srcset=\\"/static/a6efd0729609dda243a7e9e68d1a04f5/bc01b/vienna.jpg 188w,
/static/a6efd0729609dda243a7e9e68d1a04f5/bf173/vienna.jpg 375w,
/static/a6efd0729609dda243a7e9e68d1a04f5/acb04/vienna.jpg 750w,
/static/a6efd0729609dda243a7e9e68d1a04f5/ec605/vienna.jpg 1125w,
/static/a6efd0729609dda243a7e9e68d1a04f5/c58a3/vienna.jpg 1500w,
/static/a6efd0729609dda243a7e9e68d1a04f5/3acf0/vienna.jpg 2000w\\"
        sizes=\\"(max-width: 750px) 100vw, 750px\\"
        style=\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\"
        loading=\\"lazy\\"
      />
  </a>
    </span></p>
<h4>Old town in Bratislava</h4>
<p>It was nice to walk around and drinking coffee at a local coffee shop.</p>
<h4>Boat Hotel in Budapest</h4>
<p><span
      class=\\"gatsby-resp-image-wrapper\\"
      style=\\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;\\"
    >
      <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"/static/e57fb4c3485878d0956979540e7fabcc/b17f8/boat-hotel.jpg\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >
    <span
    class=\\"gatsby-resp-image-background-image\\"
    style=\\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECA//EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/aAAwDAQACEAMQAAABzc2gwLf/xAAZEAACAwEAAAAAAAAAAAAAAAAAAQIREhP/2gAIAQEAAQUCpMwYIpyHCjmf/8QAFREBAQAAAAAAAAAAAAAAAAAAABL/2gAIAQMBAT8BhD//xAAVEQEBAAAAAAAAAAAAAAAAAAAAE//aAAgBAgEBPwGir//EABcQAAMBAAAAAAAAAAAAAAAAAAAQIQH/2gAIAQEABj8CcLq//8QAGxAAAgIDAQAAAAAAAAAAAAAAAAERUSFBkXH/2gAIAQEAAT8hS0p9RC0RtdMXp4Y800mJ40j/2gAMAwEAAgADAAAAENwv/8QAFhEBAQEAAAAAAAAAAAAAAAAAACFx/9oACAEDAQE/EKaf/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAERMVH/2gAIAQIBAT8QbqyWH//EABwQAQACAgMBAAAAAAAAAAAAAAEAESFhUYGhwf/aAAgBAQABPxDBjpBg5ZUbhR80Uy9MO0uYpS41m0qVlB8Lfs//2Q=='); background-size: cover; display: block;\\"
  ></span>
  <img
        class=\\"gatsby-resp-image-image\\"
        alt=\\"The boat we stayed on in Budapest\\"
        title=\\"The boat we stayed on in Budapest\\"
        src=\\"/static/e57fb4c3485878d0956979540e7fabcc/acb04/boat-hotel.jpg\\"
        srcset=\\"/static/e57fb4c3485878d0956979540e7fabcc/bc01b/boat-hotel.jpg 188w,
/static/e57fb4c3485878d0956979540e7fabcc/bf173/boat-hotel.jpg 375w,
/static/e57fb4c3485878d0956979540e7fabcc/acb04/boat-hotel.jpg 750w,
/static/e57fb4c3485878d0956979540e7fabcc/ec605/boat-hotel.jpg 1125w,
/static/e57fb4c3485878d0956979540e7fabcc/c58a3/boat-hotel.jpg 1500w,
/static/e57fb4c3485878d0956979540e7fabcc/b17f8/boat-hotel.jpg 1600w\\"
        sizes=\\"(max-width: 750px) 100vw, 750px\\"
        style=\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\"
        loading=\\"lazy\\"
      />
  </a>
    </span></p>
<h4>Coffee at <em>Johann Franck</em> in Zagreb</h4>
<p>The atmosphere and view of the main square was nice company to some good coffee and delicious fresh orange juice.</p>
<h4>The trainride from Zagreb to Ljubljana</h4>
<p>This trainride had an epic scenery that none of the other train rides.</p>
<p><span
      class=\\"gatsby-resp-image-wrapper\\"
      style=\\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;\\"
    >
      <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"/static/a9833eff2148367b26515e378a113aaf/b17f8/train-view.jpg\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >
    <span
    class=\\"gatsby-resp-image-background-image\\"
    style=\\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAID/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAFGk41skn//xAAcEAABAwUAAAAAAAAAAAAAAAAAAQITAwQREjH/2gAIAQEAAQUC6bVWiXLsRkSEaH//xAAWEQEBAQAAAAAAAAAAAAAAAAAAERL/2gAIAQMBAT8BjL//xAAWEQEBAQAAAAAAAAAAAAAAAAAAERP/2gAIAQIBAT8BrR//xAAbEAACAQUAAAAAAAAAAAAAAAAAASECESAisf/aAAgBAQAGPwLXpF0TSnh//8QAGhABAQEAAwEAAAAAAAAAAAAAAQARQVFxkf/aAAgBAQABPyHeDYRRxudjbR1LNFb0+3//2gAMAwEAAgADAAAAEHAP/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARMf/aAAgBAwEBPxBTwtX/xAAXEQADAQAAAAAAAAAAAAAAAAAAARFB/9oACAECAQE/EFOlH//EABwQAQADAAIDAAAAAAAAAAAAAAEAESExcVFhof/aAAgBAQABPxC6xw8m2X+RboRIRelj55hTkojqxQB6gxdPqs//2Q=='); background-size: cover; display: block;\\"
  ></span>
  <img
        class=\\"gatsby-resp-image-image\\"
        alt=\\"View through the window of the train\\"
        title=\\"View through the window of the train\\"
        src=\\"/static/a9833eff2148367b26515e378a113aaf/acb04/train-view.jpg\\"
        srcset=\\"/static/a9833eff2148367b26515e378a113aaf/bc01b/train-view.jpg 188w,
/static/a9833eff2148367b26515e378a113aaf/bf173/train-view.jpg 375w,
/static/a9833eff2148367b26515e378a113aaf/acb04/train-view.jpg 750w,
/static/a9833eff2148367b26515e378a113aaf/ec605/train-view.jpg 1125w,
/static/a9833eff2148367b26515e378a113aaf/c58a3/train-view.jpg 1500w,
/static/a9833eff2148367b26515e378a113aaf/b17f8/train-view.jpg 1600w\\"
        sizes=\\"(max-width: 750px) 100vw, 750px\\"
        style=\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\"
        loading=\\"lazy\\"
      />
  </a>
    </span></p>
<h4>Ljubljana</h4>
<p>Ljubljana was an amazing place. It is beautiful and has a great atmosphere. We enjoyed walking aside the river both in the evening and the morning. The riverside bars was great for relaxing with a couple of beers. We should probably have stayed longer in Ljubljana.</p>
<p><span
      class=\\"gatsby-resp-image-wrapper\\"
      style=\\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;\\"
    >
      <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"/static/ff846e27c6e43a251edd61292b9026a5/b17f8/ljubljana.jpg\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >
    <span
    class=\\"gatsby-resp-image-background-image\\"
    style=\\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIEAwX/xAAWAQEBAQAAAAAAAAAAAAAAAAABAAL/2gAMAwEAAhADEAAAAWaLBzec4n//xAAbEAACAgMBAAAAAAAAAAAAAAABAgADBBETEv/aAAgBAQABBQIbnRRU+WA3VYxDV+p//8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAEDAQE/AULL/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAECEf/aAAgBAgEBPwFVRrP/xAAcEAADAAEFAAAAAAAAAAAAAAAAARECEiEiMaH/2gAIAQEABj8CdRr8Jik0bIs5HSP/xAAbEAEAAwEAAwAAAAAAAAAAAAABABEhMUFRcf/aAAgBAQABPyHYI09JgK+mUJDyzsa+2IENXcMS/9oADAMBAAIAAwAAABAs7//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/EAh//8QAFxEBAAMAAAAAAAAAAAAAAAAAAAExYf/aAAgBAgEBPxCRbR//xAAdEAEBAAIDAAMAAAAAAAAAAAABEQAhMUFRYYGR/9oACAEBAAE/EAGqwDpOvvAGRUAQ2x18Yo4RW3+ZADt9U1hgGiDq8YCLT0Jc/9k='); background-size: cover; display: block;\\"
  ></span>
  <img
        class=\\"gatsby-resp-image-image\\"
        alt=\\"The river running through Ljubljana\\"
        title=\\"The river running through Ljubljana\\"
        src=\\"/static/ff846e27c6e43a251edd61292b9026a5/acb04/ljubljana.jpg\\"
        srcset=\\"/static/ff846e27c6e43a251edd61292b9026a5/bc01b/ljubljana.jpg 188w,
/static/ff846e27c6e43a251edd61292b9026a5/bf173/ljubljana.jpg 375w,
/static/ff846e27c6e43a251edd61292b9026a5/acb04/ljubljana.jpg 750w,
/static/ff846e27c6e43a251edd61292b9026a5/ec605/ljubljana.jpg 1125w,
/static/ff846e27c6e43a251edd61292b9026a5/c58a3/ljubljana.jpg 1500w,
/static/ff846e27c6e43a251edd61292b9026a5/b17f8/ljubljana.jpg 1600w\\"
        sizes=\\"(max-width: 750px) 100vw, 750px\\"
        style=\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\"
        loading=\\"lazy\\"
      />
  </a>
    </span></p>
<h4>Beach life in Rijeka</h4>
<p>In Rijeka, we stayed in an apartment rented through AirBnb. The apartment was just a few hundred meters from the beach. We chilled at the beach and read books for the last days of our trip. I guess we were to busy chilling to remember to take photos.</p>
<p><strong>Want to see more photos? Check out my <a href=\\"https://instagram.com/relekang\\">Instagram account</a></strong></p>
<h2>Lessons learned</h2>
<ul>
<li>Air-condition is worth a few bucks extra in July.</li>
<li>Last minute deals from hotel booking apps can be really good.</li>
<li><a href=\\"http://seat61.com\\">The Man in Seat Sixty-One</a> is a great resource for train travel information.</li>
<li>Research the day options of night trains, in several cases they are better. We almost ended up on a night train with only sitting seats.</li>
<li>When booking trains a long time in advance the flexible ticket is most probably worth the cost of a special offer.</li>
<li>Relax and enjoy the trip. There is no reason to see everything in every place.</li>
</ul>",
        "@": Object {},
      },
      "date": 2015-07-26T00:00:00.000Z,
      "description": "<p>After I finished my master thesis in June I left for a interrail with my girlfriend this summer. Traveling by train has its ups an downs, but overall it was a great experience that I hope to do it again soon. Although we were interrailing we did not by a interrail pass as our research indicated that it would be cheaper without it. In the end we ended up paying half the price we would have payed with interrail tickets.</p>
<p>If you are wondering if you should travel Europe by train then <em>do it</em>.</p>
<h2>The trains</h2>
<p>We started out in Berlin arriving from Norway by airplane. Further on, we took the train to Prague. The train ride was hot as the air condition was broken and a blazing sun with 35 degrees roamed outside. Onwards from Prague we left for Vienna, which was a pleasant ride with the new Railjet trains. The next ride was a short 1 hour ride to Bratislava, not much more to say about that. From there we left for Budapest on a nice and short train ride. The next trip was the longest from Budapest to Zagreb. It got even longer when the train stopped after an hour or so and the someone from the Hungarian Railway said \\"End station. Get off!\\". We got off to see a line of buses, which took us to the next station where a new train was waiting. There was no problem, rather an interesting experience as we traveled small local roads between a couple of train stations without any information about what was happening. After two nights in Zagreb we took a train to Ljubljana. The train ride was incredibly scenic. If you have the chance to take it you should do it. At last but not at least, we went to Rijeka with another train without air condition. However, this was not nearly as hot as the first one.</p>
<p>In my opinion, the train rides ranging from 2,5 to 4 hours were the best. Enough time to read and watch the countryside while listening to a podcast or an audio book. However, not to long to get tired an longing for the destination. All in all, the trips with trains was great and a nice way to visit and see so many different places and cultures. One of the good parts is that you break up the exploring days with some days with a lot of reading and podcast listening.</p>
<h2>A few highlights</h2>
<h4>The burger from <em>The pub</em> in Berlin</h4>
<p>Not much more to say than it's delicious.</p>
<h4>The architecture of Vienna</h4>
<p><span
      class=\\"gatsby-resp-image-wrapper\\"
      style=\\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;\\"
    >
      <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"/static/a6efd0729609dda243a7e9e68d1a04f5/3acf0/vienna.jpg\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >
    <span
    class=\\"gatsby-resp-image-background-image\\"
    style=\\"padding-bottom: 37.23404255319149%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAID/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAZgl0Cf/xAAYEAADAQEAAAAAAAAAAAAAAAAAAQIRE//aAAgBAQABBQLZHSO2H//EABYRAAMAAAAAAAAAAAAAAAAAAAABEf/aAAgBAwEBPwGIiP/EABYRAAMAAAAAAAAAAAAAAAAAAAABEf/aAAgBAgEBPwGsrP/EABcQAAMBAAAAAAAAAAAAAAAAAAABITL/2gAIAQEABj8CqIjJ/8QAGRABAAMBAQAAAAAAAAAAAAAAAQAhkUFh/9oACAEBAAE/ITq7AVd7BUDs/9oADAMBAAIAAwAAABAIL//EABYRAAMAAAAAAAAAAAAAAAAAAAEQUf/aAAgBAwEBPxAyV//EABcRAQADAAAAAAAAAAAAAAAAAAABUWH/2gAIAQIBAT8Qi9s//8QAGxABAAICAwAAAAAAAAAAAAAAAQARITFBYdH/2gAIAQEAAT8QcaVbIWwg56QyxOLfk//Z'); background-size: cover; display: block;\\"
  ></span>
  <img
        class=\\"gatsby-resp-image-image\\"
        alt=\\"... in Vienna\\"
        title=\\"... in Vienna\\"
        src=\\"/static/a6efd0729609dda243a7e9e68d1a04f5/acb04/vienna.jpg\\"
        srcset=\\"/static/a6efd0729609dda243a7e9e68d1a04f5/bc01b/vienna.jpg 188w,
/static/a6efd0729609dda243a7e9e68d1a04f5/bf173/vienna.jpg 375w,
/static/a6efd0729609dda243a7e9e68d1a04f5/acb04/vienna.jpg 750w,
/static/a6efd0729609dda243a7e9e68d1a04f5/ec605/vienna.jpg 1125w,
/static/a6efd0729609dda243a7e9e68d1a04f5/c58a3/vienna.jpg 1500w,
/static/a6efd0729609dda243a7e9e68d1a04f5/3acf0/vienna.jpg 2000w\\"
        sizes=\\"(max-width: 750px) 100vw, 750px\\"
        style=\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\"
        loading=\\"lazy\\"
      />
  </a>
    </span></p>
<h4>Old town in Bratislava</h4>
<p>It was nice to walk around and drinking coffee at a local coffee shop.</p>
<h4>Boat Hotel in Budapest</h4>
<p><span
      class=\\"gatsby-resp-image-wrapper\\"
      style=\\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;\\"
    >
      <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"/static/e57fb4c3485878d0956979540e7fabcc/b17f8/boat-hotel.jpg\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >
    <span
    class=\\"gatsby-resp-image-background-image\\"
    style=\\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECA//EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/aAAwDAQACEAMQAAABzc2gwLf/xAAZEAACAwEAAAAAAAAAAAAAAAAAAQIREhP/2gAIAQEAAQUCpMwYIpyHCjmf/8QAFREBAQAAAAAAAAAAAAAAAAAAABL/2gAIAQMBAT8BhD//xAAVEQEBAAAAAAAAAAAAAAAAAAAAE//aAAgBAgEBPwGir//EABcQAAMBAAAAAAAAAAAAAAAAAAAQIQH/2gAIAQEABj8CcLq//8QAGxAAAgIDAQAAAAAAAAAAAAAAAAERUSFBkXH/2gAIAQEAAT8hS0p9RC0RtdMXp4Y800mJ40j/2gAMAwEAAgADAAAAENwv/8QAFhEBAQEAAAAAAAAAAAAAAAAAACFx/9oACAEDAQE/EKaf/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAERMVH/2gAIAQIBAT8QbqyWH//EABwQAQACAgMBAAAAAAAAAAAAAAEAESFhUYGhwf/aAAgBAQABPxDBjpBg5ZUbhR80Uy9MO0uYpS41m0qVlB8Lfs//2Q=='); background-size: cover; display: block;\\"
  ></span>
  <img
        class=\\"gatsby-resp-image-image\\"
        alt=\\"The boat we stayed on in Budapest\\"
        title=\\"The boat we stayed on in Budapest\\"
        src=\\"/static/e57fb4c3485878d0956979540e7fabcc/acb04/boat-hotel.jpg\\"
        srcset=\\"/static/e57fb4c3485878d0956979540e7fabcc/bc01b/boat-hotel.jpg 188w,
/static/e57fb4c3485878d0956979540e7fabcc/bf173/boat-hotel.jpg 375w,
/static/e57fb4c3485878d0956979540e7fabcc/acb04/boat-hotel.jpg 750w,
/static/e57fb4c3485878d0956979540e7fabcc/ec605/boat-hotel.jpg 1125w,
/static/e57fb4c3485878d0956979540e7fabcc/c58a3/boat-hotel.jpg 1500w,
/static/e57fb4c3485878d0956979540e7fabcc/b17f8/boat-hotel.jpg 1600w\\"
        sizes=\\"(max-width: 750px) 100vw, 750px\\"
        style=\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\"
        loading=\\"lazy\\"
      />
  </a>
    </span></p>
<h4>Coffee at <em>Johann Franck</em> in Zagreb</h4>
<p>The atmosphere and view of the main square was nice company to some good coffee and delicious fresh orange juice.</p>
<h4>The trainride from Zagreb to Ljubljana</h4>
<p>This trainride had an epic scenery that none of the other train rides.</p>
<p><span
      class=\\"gatsby-resp-image-wrapper\\"
      style=\\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;\\"
    >
      <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"/static/a9833eff2148367b26515e378a113aaf/b17f8/train-view.jpg\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >
    <span
    class=\\"gatsby-resp-image-background-image\\"
    style=\\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAID/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAFGk41skn//xAAcEAABAwUAAAAAAAAAAAAAAAAAAQITAwQREjH/2gAIAQEAAQUC6bVWiXLsRkSEaH//xAAWEQEBAQAAAAAAAAAAAAAAAAAAERL/2gAIAQMBAT8BjL//xAAWEQEBAQAAAAAAAAAAAAAAAAAAERP/2gAIAQIBAT8BrR//xAAbEAACAQUAAAAAAAAAAAAAAAAAASECESAisf/aAAgBAQAGPwLXpF0TSnh//8QAGhABAQEAAwEAAAAAAAAAAAAAAQARQVFxkf/aAAgBAQABPyHeDYRRxudjbR1LNFb0+3//2gAMAwEAAgADAAAAEHAP/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARMf/aAAgBAwEBPxBTwtX/xAAXEQADAQAAAAAAAAAAAAAAAAAAARFB/9oACAECAQE/EFOlH//EABwQAQADAAIDAAAAAAAAAAAAAAEAESExcVFhof/aAAgBAQABPxC6xw8m2X+RboRIRelj55hTkojqxQB6gxdPqs//2Q=='); background-size: cover; display: block;\\"
  ></span>
  <img
        class=\\"gatsby-resp-image-image\\"
        alt=\\"View through the window of the train\\"
        title=\\"View through the window of the train\\"
        src=\\"/static/a9833eff2148367b26515e378a113aaf/acb04/train-view.jpg\\"
        srcset=\\"/static/a9833eff2148367b26515e378a113aaf/bc01b/train-view.jpg 188w,
/static/a9833eff2148367b26515e378a113aaf/bf173/train-view.jpg 375w,
/static/a9833eff2148367b26515e378a113aaf/acb04/train-view.jpg 750w,
/static/a9833eff2148367b26515e378a113aaf/ec605/train-view.jpg 1125w,
/static/a9833eff2148367b26515e378a113aaf/c58a3/train-view.jpg 1500w,
/static/a9833eff2148367b26515e378a113aaf/b17f8/train-view.jpg 1600w\\"
        sizes=\\"(max-width: 750px) 100vw, 750px\\"
        style=\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\"
        loading=\\"lazy\\"
      />
  </a>
    </span></p>
<h4>Ljubljana</h4>
<p>Ljubljana was an amazing place. It is beautiful and has a great atmosphere. We enjoyed walking aside the river both in the evening and the morning. The riverside bars was great for relaxing with a couple of beers. We should probably have stayed longer in Ljubljana.</p>
<p><span
      class=\\"gatsby-resp-image-wrapper\\"
      style=\\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;\\"
    >
      <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"/static/ff846e27c6e43a251edd61292b9026a5/b17f8/ljubljana.jpg\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >
    <span
    class=\\"gatsby-resp-image-background-image\\"
    style=\\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIEAwX/xAAWAQEBAQAAAAAAAAAAAAAAAAABAAL/2gAMAwEAAhADEAAAAWaLBzec4n//xAAbEAACAgMBAAAAAAAAAAAAAAABAgADBBETEv/aAAgBAQABBQIbnRRU+WA3VYxDV+p//8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAEDAQE/AULL/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAECEf/aAAgBAgEBPwFVRrP/xAAcEAADAAEFAAAAAAAAAAAAAAAAARECEiEiMaH/2gAIAQEABj8CdRr8Jik0bIs5HSP/xAAbEAEAAwEAAwAAAAAAAAAAAAABABEhMUFRcf/aAAgBAQABPyHYI09JgK+mUJDyzsa+2IENXcMS/9oADAMBAAIAAwAAABAs7//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/EAh//8QAFxEBAAMAAAAAAAAAAAAAAAAAAAExYf/aAAgBAgEBPxCRbR//xAAdEAEBAAIDAAMAAAAAAAAAAAABEQAhMUFRYYGR/9oACAEBAAE/EAGqwDpOvvAGRUAQ2x18Yo4RW3+ZADt9U1hgGiDq8YCLT0Jc/9k='); background-size: cover; display: block;\\"
  ></span>
  <img
        class=\\"gatsby-resp-image-image\\"
        alt=\\"The river running through Ljubljana\\"
        title=\\"The river running through Ljubljana\\"
        src=\\"/static/ff846e27c6e43a251edd61292b9026a5/acb04/ljubljana.jpg\\"
        srcset=\\"/static/ff846e27c6e43a251edd61292b9026a5/bc01b/ljubljana.jpg 188w,
/static/ff846e27c6e43a251edd61292b9026a5/bf173/ljubljana.jpg 375w,
/static/ff846e27c6e43a251edd61292b9026a5/acb04/ljubljana.jpg 750w,
/static/ff846e27c6e43a251edd61292b9026a5/ec605/ljubljana.jpg 1125w,
/static/ff846e27c6e43a251edd61292b9026a5/c58a3/ljubljana.jpg 1500w,
/static/ff846e27c6e43a251edd61292b9026a5/b17f8/ljubljana.jpg 1600w\\"
        sizes=\\"(max-width: 750px) 100vw, 750px\\"
        style=\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\"
        loading=\\"lazy\\"
      />
  </a>
    </span></p>
<h4>Beach life in Rijeka</h4>
<p>In Rijeka, we stayed in an apartment rented through AirBnb. The apartment was just a few hundred meters from the beach. We chilled at the beach and read books for the last days of our trip. I guess we were to busy chilling to remember to take photos.</p>
<p><strong>Want to see more photos? Check out my <a href=\\"https://instagram.com/relekang\\">Instagram account</a></strong></p>
<h2>Lessons learned</h2>
<ul>
<li>Air-condition is worth a few bucks extra in July.</li>
<li>Last minute deals from hotel booking apps can be really good.</li>
<li><a href=\\"http://seat61.com\\">The Man in Seat Sixty-One</a> is a great resource for train travel information.</li>
<li>Research the day options of night trains, in several cases they are better. We almost ended up on a night train with only sitting seats.</li>
<li>When booking trains a long time in advance the flexible ticket is most probably worth the cost of a special offer.</li>
<li>Relax and enjoy the trip. There is no reason to see everything in every place.</li>
</ul>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/interrail-summer",
      "image": Object {},
      "link": "https://rolflekang.com/interrail-summer",
      "origlink": null,
      "pubDate": "2015-07-26T00:00:00.000Z",
      "pubdate": 2015-07-26T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "travel",
          "@": Object {},
        },
        Object {
          "#": "interrail",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "After I finished my master thesis in June I left for a interrail with my girlfriend this summer. Traveling by train has its ups an downs…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/interrail-summer",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/interrail-summer",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Sun, 26 Jul 2015 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Interrail summer",
        "@": Object {},
      },
      "source": Object {},
      "summary": "After I finished my master thesis in June I left for a interrail with my girlfriend this summer. Traveling by train has its ups an downs…",
      "title": "Interrail summer",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "atom",
        "writing",
        "procrastination",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>These days I am writing my master thesis, which I will deliver in June.
It is not easy to produce content all days, so when you have one of those
days where the words are hiding it is easy to do something else. Well,
yesterday I customized Atom to get a better writing environment for writing
latex. Besides, a few of the tweaks is appropriate for general writing in Atom.</p>
<p>First thing first, there are some great packages that should be installed.
<code class=\\"language-text\\">language-latex</code> gives syntax highlighting. <code class=\\"language-text\\">make-runner</code> is great if
you use make to build the document. <code class=\\"language-text\\">linter-chktex</code> checks the syntax of
your latex document.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\">apm install language-latex make-runner linter-chktex</code></pre></div>
<p>Secondly, lets make the writing environment more clean with some less styling.
I put the snippet below in my <code class=\\"language-text\\">~/.atom/styles.less</code> in order to hide the
line-number gutter and to center the text in the editor.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"scss\\"><pre class=\\"language-scss\\"><code class=\\"language-scss\\"><span class=\\"token selector\\">atom-text-editor </span><span class=\\"token punctuation\\">{</span>
  <span class=\\"token selector\\"><span class=\\"token parent important\\">&amp;</span>[data-grammar~=latex]::shadow </span><span class=\\"token punctuation\\">{</span>
    <span class=\\"token selector\\">.gutter-container </span><span class=\\"token punctuation\\">{</span>
      <span class=\\"token property\\">display</span><span class=\\"token punctuation\\">:</span> none <span class=\\"token important\\">!important</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>

    <span class=\\"token selector\\">.lines </span><span class=\\"token punctuation\\">{</span>
      <span class=\\"token property\\">min-width</span><span class=\\"token punctuation\\">:</span> 700px<span class=\\"token punctuation\\">;</span>
      <span class=\\"token property\\">max-width</span><span class=\\"token punctuation\\">:</span> 700px<span class=\\"token punctuation\\">;</span>
      <span class=\\"token property\\">margin-left</span><span class=\\"token punctuation\\">:</span> auto<span class=\\"token punctuation\\">;</span>
      <span class=\\"token property\\">margin-right</span><span class=\\"token punctuation\\">:</span> auto<span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>Furthermore, I did not want the file treeview to show while editing latex files.
The coffescript below makes sure that the treeview is detached whenever I open
a <code class=\\"language-text\\">.tex</code>-file. It should go in <code class=\\"language-text\\">~/.atom/init.coffee</code>.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"coffeescript\\"><pre class=\\"language-coffeescript\\"><code class=\\"language-coffeescript\\">path <span class=\\"token operator\\">=</span> require <span class=\\"token string\\">'path'</span>

atom<span class=\\"token punctuation\\">.</span>workspaceView<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">eachEditorView</span> <span class=\\"token punctuation\\">(</span>editorView<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">-</span><span class=\\"token operator\\">></span>
  editor <span class=\\"token operator\\">=</span> editorView<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getEditor</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>
  <span class=\\"token keyword\\">if</span> path<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">extname</span><span class=\\"token punctuation\\">(</span>editor<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getPath</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">is</span> <span class=\\"token string\\">'.tex'</span>
    <span class=\\"token keyword\\">try</span>
      <span class=\\"token keyword\\">if</span> atom<span class=\\"token punctuation\\">.</span>workspace<span class=\\"token punctuation\\">.</span>panelContainers<span class=\\"token punctuation\\">.</span>left<span class=\\"token punctuation\\">.</span>panels<span class=\\"token punctuation\\">.</span>length
        atom<span class=\\"token punctuation\\">.</span>workspace<span class=\\"token punctuation\\">.</span>panelContainers<span class=\\"token punctuation\\">.</span>left<span class=\\"token punctuation\\">.</span>panels<span class=\\"token punctuation\\">[</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">.</span>item<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">detach</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>
    <span class=\\"token keyword\\">catch</span> e
      console<span class=\\"token punctuation\\">.</span>log e</code></pre></div>
<p>Then, it would be great to utilize the Atom's own spell-check. To enable it on
latex files just add <code class=\\"language-text\\">text.tex.latex</code> to the grammars field in the settings of
the spell-check packages.</p>
<p>At last, I have some editor settings for latex files. The snippet below should
be in <code class=\\"language-text\\">~/.atom/config.cson</code>.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"coffeescript\\"><pre class=\\"language-coffeescript\\"><code class=\\"language-coffeescript\\"><span class=\\"token string\\">\\".latex\\"</span><span class=\\"token punctuation\\">:</span>
  <span class=\\"token property\\">editor</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token property\\">softWrap</span><span class=\\"token punctuation\\">:</span> <span class=\\"token keyword\\">true</span>
    <span class=\\"token property\\">softWrapAtPreferredLineLength</span><span class=\\"token punctuation\\">:</span> <span class=\\"token keyword\\">true</span>
    <span class=\\"token property\\">preferredLineLength</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">80</span>
    <span class=\\"token property\\">fontSize</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">28</span></code></pre></div>",
        "@": Object {},
      },
      "date": 2015-05-23T00:00:00.000Z,
      "description": "<p>These days I am writing my master thesis, which I will deliver in June.
It is not easy to produce content all days, so when you have one of those
days where the words are hiding it is easy to do something else. Well,
yesterday I customized Atom to get a better writing environment for writing
latex. Besides, a few of the tweaks is appropriate for general writing in Atom.</p>
<p>First thing first, there are some great packages that should be installed.
<code class=\\"language-text\\">language-latex</code> gives syntax highlighting. <code class=\\"language-text\\">make-runner</code> is great if
you use make to build the document. <code class=\\"language-text\\">linter-chktex</code> checks the syntax of
your latex document.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\">apm install language-latex make-runner linter-chktex</code></pre></div>
<p>Secondly, lets make the writing environment more clean with some less styling.
I put the snippet below in my <code class=\\"language-text\\">~/.atom/styles.less</code> in order to hide the
line-number gutter and to center the text in the editor.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"scss\\"><pre class=\\"language-scss\\"><code class=\\"language-scss\\"><span class=\\"token selector\\">atom-text-editor </span><span class=\\"token punctuation\\">{</span>
  <span class=\\"token selector\\"><span class=\\"token parent important\\">&amp;</span>[data-grammar~=latex]::shadow </span><span class=\\"token punctuation\\">{</span>
    <span class=\\"token selector\\">.gutter-container </span><span class=\\"token punctuation\\">{</span>
      <span class=\\"token property\\">display</span><span class=\\"token punctuation\\">:</span> none <span class=\\"token important\\">!important</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>

    <span class=\\"token selector\\">.lines </span><span class=\\"token punctuation\\">{</span>
      <span class=\\"token property\\">min-width</span><span class=\\"token punctuation\\">:</span> 700px<span class=\\"token punctuation\\">;</span>
      <span class=\\"token property\\">max-width</span><span class=\\"token punctuation\\">:</span> 700px<span class=\\"token punctuation\\">;</span>
      <span class=\\"token property\\">margin-left</span><span class=\\"token punctuation\\">:</span> auto<span class=\\"token punctuation\\">;</span>
      <span class=\\"token property\\">margin-right</span><span class=\\"token punctuation\\">:</span> auto<span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>
  <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>Furthermore, I did not want the file treeview to show while editing latex files.
The coffescript below makes sure that the treeview is detached whenever I open
a <code class=\\"language-text\\">.tex</code>-file. It should go in <code class=\\"language-text\\">~/.atom/init.coffee</code>.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"coffeescript\\"><pre class=\\"language-coffeescript\\"><code class=\\"language-coffeescript\\">path <span class=\\"token operator\\">=</span> require <span class=\\"token string\\">'path'</span>

atom<span class=\\"token punctuation\\">.</span>workspaceView<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">eachEditorView</span> <span class=\\"token punctuation\\">(</span>editorView<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">-</span><span class=\\"token operator\\">></span>
  editor <span class=\\"token operator\\">=</span> editorView<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getEditor</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>
  <span class=\\"token keyword\\">if</span> path<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">extname</span><span class=\\"token punctuation\\">(</span>editor<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">getPath</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">is</span> <span class=\\"token string\\">'.tex'</span>
    <span class=\\"token keyword\\">try</span>
      <span class=\\"token keyword\\">if</span> atom<span class=\\"token punctuation\\">.</span>workspace<span class=\\"token punctuation\\">.</span>panelContainers<span class=\\"token punctuation\\">.</span>left<span class=\\"token punctuation\\">.</span>panels<span class=\\"token punctuation\\">.</span>length
        atom<span class=\\"token punctuation\\">.</span>workspace<span class=\\"token punctuation\\">.</span>panelContainers<span class=\\"token punctuation\\">.</span>left<span class=\\"token punctuation\\">.</span>panels<span class=\\"token punctuation\\">[</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">.</span>item<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">detach</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>
    <span class=\\"token keyword\\">catch</span> e
      console<span class=\\"token punctuation\\">.</span>log e</code></pre></div>
<p>Then, it would be great to utilize the Atom's own spell-check. To enable it on
latex files just add <code class=\\"language-text\\">text.tex.latex</code> to the grammars field in the settings of
the spell-check packages.</p>
<p>At last, I have some editor settings for latex files. The snippet below should
be in <code class=\\"language-text\\">~/.atom/config.cson</code>.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"coffeescript\\"><pre class=\\"language-coffeescript\\"><code class=\\"language-coffeescript\\"><span class=\\"token string\\">\\".latex\\"</span><span class=\\"token punctuation\\">:</span>
  <span class=\\"token property\\">editor</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token property\\">softWrap</span><span class=\\"token punctuation\\">:</span> <span class=\\"token keyword\\">true</span>
    <span class=\\"token property\\">softWrapAtPreferredLineLength</span><span class=\\"token punctuation\\">:</span> <span class=\\"token keyword\\">true</span>
    <span class=\\"token property\\">preferredLineLength</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">80</span>
    <span class=\\"token property\\">fontSize</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">28</span></code></pre></div>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/writing-latex-in-atom",
      "image": Object {},
      "link": "https://rolflekang.com/writing-latex-in-atom",
      "origlink": null,
      "pubDate": "2015-05-23T00:00:00.000Z",
      "pubdate": 2015-05-23T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "atom",
          "@": Object {},
        },
        Object {
          "#": "writing",
          "@": Object {},
        },
        Object {
          "#": "procrastination",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "These days I am writing my master thesis, which I will deliver in June.
It is not easy to produce content all days, so when you have one of…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/writing-latex-in-atom",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/writing-latex-in-atom",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Sat, 23 May 2015 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Writing (latex) in Atom",
        "@": Object {},
      },
      "source": Object {},
      "summary": "These days I am writing my master thesis, which I will deliver in June.
It is not easy to produce content all days, so when you have one of…",
      "title": "Writing (latex) in Atom",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "python",
        "testing",
        "mocking",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>While working on <a href=\\"https://feedhuddler.com\\">feedhuddler.com</a> there are tests that test the feedparsing functionality. It uses the actual feeds from their origins, which I think is ok for this situation. If the feeds are not longer parseable by feedhuddler the continous integration will fail and I can look into it. It could be managed by some downloaded feeds and mocking of the requests. However, I wouldn't feel comfortable by putting other peoples content in the feedhuddler repo. Furthermore, it should be easy to add a feed that is reported to break the parser without much work. The tests can take a while on the continous integration server without it beeing a big deal, but locally the time consuming tests makes it cumbersome to work test driven or to work with the tests at all.</p>
<p><a href=\\"https://github.com/relekang/rmoq\\"><strong>rmoq</strong></a> was created to work around that problem. It listen on all requests made by the <a href=\\"http://docs.python-requests.org/en/latest/\\">requests</a> framework and intercepts them. If a request is already been cached in the cache folder it creates a response based on a local file. On the other hand, if no file exists for that url it will perform the request and save the content into a file and then return the response. Thus, if the files are already there the tests will run faster and no manual work is needed to create the local files.</p>
<p>A nice side-effect of using files as storage is that they can be added to the version control repo. In the case of the feedhuddler tests it is not wanted behaviour, but in other cases it might be just what you want to add these files to code repository.</p>
<p>The code can be found on <a href=\\"https://github.com/relekang/rmoq\\">github.com/relekang/rmoq</a> and it can be installed with pip:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"bash\\"><pre class=\\"language-bash\\"><code class=\\"language-bash\\">pip <span class=\\"token function\\">install</span> rmoq</code></pre></div>
<p>The basic way to use it is just to add a decorator to your test:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"python\\"><pre class=\\"language-python\\"><code class=\\"language-python\\"><span class=\\"token decorator annotation punctuation\\">@rmoq<span class=\\"token punctuation\\">.</span>activate</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'test_fixtures'</span><span class=\\"token punctuation\\">)</span>
<span class=\\"token keyword\\">def</span> <span class=\\"token function\\">test_remote_call</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>
    response <span class=\\"token operator\\">=</span> requests<span class=\\"token punctuation\\">.</span>get<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'http://example.com'</span><span class=\\"token punctuation\\">)</span>
    <span class=\\"token keyword\\">assert</span> response<span class=\\"token punctuation\\">.</span>body <span class=\\"token operator\\">==</span> <span class=\\"token string\\">'Example'</span></code></pre></div>
<p>The path parameter sent in above is optional, and if left out the path will then be set to <code class=\\"language-text\\">fixtures/</code>. The test function is then wrapped in a with statement that intercepts all requests and either load them from file or fetches the content from the url and saves it to a file before returning the response.</p>
<p>The feedhuddler tests went from <code class=\\"language-text\\">Ran 21 tests in 41.394s</code> to <code class=\\"language-text\\">Ran 21 tests in 1.942s</code> which is quite a speedup and the tests suite is much more pleasant to work on.</p>",
        "@": Object {},
      },
      "date": 2014-12-30T00:00:00.000Z,
      "description": "<p>While working on <a href=\\"https://feedhuddler.com\\">feedhuddler.com</a> there are tests that test the feedparsing functionality. It uses the actual feeds from their origins, which I think is ok for this situation. If the feeds are not longer parseable by feedhuddler the continous integration will fail and I can look into it. It could be managed by some downloaded feeds and mocking of the requests. However, I wouldn't feel comfortable by putting other peoples content in the feedhuddler repo. Furthermore, it should be easy to add a feed that is reported to break the parser without much work. The tests can take a while on the continous integration server without it beeing a big deal, but locally the time consuming tests makes it cumbersome to work test driven or to work with the tests at all.</p>
<p><a href=\\"https://github.com/relekang/rmoq\\"><strong>rmoq</strong></a> was created to work around that problem. It listen on all requests made by the <a href=\\"http://docs.python-requests.org/en/latest/\\">requests</a> framework and intercepts them. If a request is already been cached in the cache folder it creates a response based on a local file. On the other hand, if no file exists for that url it will perform the request and save the content into a file and then return the response. Thus, if the files are already there the tests will run faster and no manual work is needed to create the local files.</p>
<p>A nice side-effect of using files as storage is that they can be added to the version control repo. In the case of the feedhuddler tests it is not wanted behaviour, but in other cases it might be just what you want to add these files to code repository.</p>
<p>The code can be found on <a href=\\"https://github.com/relekang/rmoq\\">github.com/relekang/rmoq</a> and it can be installed with pip:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"bash\\"><pre class=\\"language-bash\\"><code class=\\"language-bash\\">pip <span class=\\"token function\\">install</span> rmoq</code></pre></div>
<p>The basic way to use it is just to add a decorator to your test:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"python\\"><pre class=\\"language-python\\"><code class=\\"language-python\\"><span class=\\"token decorator annotation punctuation\\">@rmoq<span class=\\"token punctuation\\">.</span>activate</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'test_fixtures'</span><span class=\\"token punctuation\\">)</span>
<span class=\\"token keyword\\">def</span> <span class=\\"token function\\">test_remote_call</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>
    response <span class=\\"token operator\\">=</span> requests<span class=\\"token punctuation\\">.</span>get<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'http://example.com'</span><span class=\\"token punctuation\\">)</span>
    <span class=\\"token keyword\\">assert</span> response<span class=\\"token punctuation\\">.</span>body <span class=\\"token operator\\">==</span> <span class=\\"token string\\">'Example'</span></code></pre></div>
<p>The path parameter sent in above is optional, and if left out the path will then be set to <code class=\\"language-text\\">fixtures/</code>. The test function is then wrapped in a with statement that intercepts all requests and either load them from file or fetches the content from the url and saves it to a file before returning the response.</p>
<p>The feedhuddler tests went from <code class=\\"language-text\\">Ran 21 tests in 41.394s</code> to <code class=\\"language-text\\">Ran 21 tests in 1.942s</code> which is quite a speedup and the tests suite is much more pleasant to work on.</p>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/rmoq",
      "image": Object {},
      "link": "https://rolflekang.com/rmoq",
      "origlink": null,
      "pubDate": "2014-12-30T00:00:00.000Z",
      "pubdate": 2014-12-30T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "python",
          "@": Object {},
        },
        Object {
          "#": "testing",
          "@": Object {},
        },
        Object {
          "#": "mocking",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "While working on feedhuddler.com there are tests that test the feedparsing functionality. It uses the actual feeds from their origins, which…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/rmoq",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/rmoq",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Tue, 30 Dec 2014 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "rmoq - a request mock cache",
        "@": Object {},
      },
      "source": Object {},
      "summary": "While working on feedhuddler.com there are tests that test the feedparsing functionality. It uses the actual feeds from their origins, which…",
      "title": "rmoq - a request mock cache",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "django",
        "nopassword",
        "django-nopassword",
        "authentication",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>I started the this project as way to understand django authentication backends
about two years ago. I read a blog post by Ben Brown about <a href=\\"http://notes.xoxco.com/post/27999787765/is-it-time-for-password-less-login\\">password-less
login</a>
and thought that it would a great case to learn custom django authentication
backends.</p>
<p>A lot has changed since then and the project has moved from being an experiment to
something useful. I myself use it in production on several sites. I have heard from
others who also use it. I hope you all like some of the new features in this release.</p>
<hr>
<h3>The new features since last release</h3>
<p><strong>Rename the app to nopassword:</strong> This means that from this version installed apps
in django should list <code class=\\"language-text\\">nopassword</code> not <code class=\\"language-text\\">django_nopassword</code>. In addition all imports
need to point to <code class=\\"language-text\\">nopassword</code> not <code class=\\"language-text\\">django_nopassword</code>.</p>
<p><strong>The possibility to customize code delivery:</strong>
Most of the code in the <code class=\\"language-text\\">EmailBackend</code> has been moved to a new backend called
<code class=\\"language-text\\">NoPasswordBackend</code>. The latter is not meant to be used on its own, but it will
make it easier to create other backends similar to <code class=\\"language-text\\">EmailBackend</code>. With other
words, it has become easier to send the login codes with other technologies like
sms.</p>
<p><strong>Verification of the user:</strong>
django-nopassword uses <code class=\\"language-text\\">user.is_active()</code> to determine whether a user is still
active or not. In this release we moved this into its own method,
<code class=\\"language-text\\">NoPasswordBackend.verify_user</code>, which makes it easier to create your own logic
to verify your users.</p>
<p><strong>Django 1.7 support:</strong> Now it is tested and known to work with the released version
of Django 1.7. Earlier it had just support for the beta 3.</p>
<p><strong>Migrations:</strong> Support for both Django 1.7 migrations and South migrations. To use
South it is necessary to use version the lastest version(1.0), since it is the only
version that looks for migrations in <code class=\\"language-text\\">south_migrations</code>.</p>
<hr>
<p>The test setup has also been changed to use <a href=\\"https://tox.readthedocs.org/en/latest/\\">tox</a>.
It makes it a lot easier to test specific django and python versions locally. I have
to mention the new multi-dimensional configuration of environments. It makes it easier
generate test environments for several python and django versions with all combinations.</p>
<p>If you use django-nopassword on any on your projects please let me know. I would love
to hear about it.</p>",
        "@": Object {},
      },
      "date": 2014-10-03T00:00:00.000Z,
      "description": "<p>I started the this project as way to understand django authentication backends
about two years ago. I read a blog post by Ben Brown about <a href=\\"http://notes.xoxco.com/post/27999787765/is-it-time-for-password-less-login\\">password-less
login</a>
and thought that it would a great case to learn custom django authentication
backends.</p>
<p>A lot has changed since then and the project has moved from being an experiment to
something useful. I myself use it in production on several sites. I have heard from
others who also use it. I hope you all like some of the new features in this release.</p>
<hr>
<h3>The new features since last release</h3>
<p><strong>Rename the app to nopassword:</strong> This means that from this version installed apps
in django should list <code class=\\"language-text\\">nopassword</code> not <code class=\\"language-text\\">django_nopassword</code>. In addition all imports
need to point to <code class=\\"language-text\\">nopassword</code> not <code class=\\"language-text\\">django_nopassword</code>.</p>
<p><strong>The possibility to customize code delivery:</strong>
Most of the code in the <code class=\\"language-text\\">EmailBackend</code> has been moved to a new backend called
<code class=\\"language-text\\">NoPasswordBackend</code>. The latter is not meant to be used on its own, but it will
make it easier to create other backends similar to <code class=\\"language-text\\">EmailBackend</code>. With other
words, it has become easier to send the login codes with other technologies like
sms.</p>
<p><strong>Verification of the user:</strong>
django-nopassword uses <code class=\\"language-text\\">user.is_active()</code> to determine whether a user is still
active or not. In this release we moved this into its own method,
<code class=\\"language-text\\">NoPasswordBackend.verify_user</code>, which makes it easier to create your own logic
to verify your users.</p>
<p><strong>Django 1.7 support:</strong> Now it is tested and known to work with the released version
of Django 1.7. Earlier it had just support for the beta 3.</p>
<p><strong>Migrations:</strong> Support for both Django 1.7 migrations and South migrations. To use
South it is necessary to use version the lastest version(1.0), since it is the only
version that looks for migrations in <code class=\\"language-text\\">south_migrations</code>.</p>
<hr>
<p>The test setup has also been changed to use <a href=\\"https://tox.readthedocs.org/en/latest/\\">tox</a>.
It makes it a lot easier to test specific django and python versions locally. I have
to mention the new multi-dimensional configuration of environments. It makes it easier
generate test environments for several python and django versions with all combinations.</p>
<p>If you use django-nopassword on any on your projects please let me know. I would love
to hear about it.</p>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/django-nopassword-one-point-o",
      "image": Object {},
      "link": "https://rolflekang.com/django-nopassword-one-point-o",
      "origlink": null,
      "pubDate": "2014-10-03T00:00:00.000Z",
      "pubdate": 2014-10-03T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "django",
          "@": Object {},
        },
        Object {
          "#": "nopassword",
          "@": Object {},
        },
        Object {
          "#": "django-nopassword",
          "@": Object {},
        },
        Object {
          "#": "authentication",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "I started the this project as way to understand django authentication backends
about two years ago. I read a blog post by Ben Brown about…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/django-nopassword-one-point-o",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/django-nopassword-one-point-o",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Fri, 03 Oct 2014 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "django-nopassword reached 1.0",
        "@": Object {},
      },
      "source": Object {},
      "summary": "I started the this project as way to understand django authentication backends
about two years ago. I read a blog post by Ben Brown about…",
      "title": "django-nopassword reached 1.0",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "this",
        "static-site",
        "pelican",
        "jekyll",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>A couple of days ago I swapped the static site generator used at this blog
from Jekyll to Pelican. It was not to much work, mostly changing the metadata of the posts.
The reason I changed engine is mostly to try out something different. I wanted to know the differences about the two of the top static site generators. It should not be surprising that I turned towards something written in python.</p>
<p>I configured Pelican to some level to make it behave as I wanted to. I wrote some custom path settings to remove the <code class=\\"language-text\\">.html</code> at the end of the url to each post by generating folders with index.html. The paths from jekyll where on the form <code class=\\"language-text\\">/year/month/day/slug/</code>. I still wanted to support incoming links to those parts. The urls on the new setup is in the same pattern to solve that. In time I would like to use the pattern <code class=\\"language-text\\">/year/slug/</code> or even just the slug. To do that I need to find a way to redirect the old urls. Any ideas on how to solve the redirect issue are more than welcome. The theme will probably be available at my Github profile or something similar soon.</p>
<p>I created a new Pelican theme for the blog. It is a work in progress. However, I think it is a great improvement over the old blog. Especially the fact that it does not load a huge css library to display something as simple as the design of this blog.</p>
<h3>So what about hosting?</h3>
<p>I still host the site at github pages, using a <a href=\\"https://github.com/relekang/rolflekang.com/blob/gh-pages/CNAME\\">CNAME</a> file to serve it on my domain <a href=\\"http://rolflekang.com\\">rolflekang.com</a>. I use a python package called <a href=\\"https://github.com/davisp/ghp-import\\">ghp-import</a> to push the generated site to Github Pages. The source of the blog is not stored in the same repository, because I do not want people to see my unfinished posts, but still track them in the repo. Therefor I have added the public repository as a remote called <code class=\\"language-text\\">gh-pages</code>. I use the Make task below to publish to github pages. The <code class=\\"language-text\\">publish</code> task that it depends on is just the standard task from the Makefile generated by <code class=\\"language-text\\">pelican-quickstart</code>.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"make\\"><pre class=\\"language-make\\"><code class=\\"language-make\\">github: publish
  cp CNAME $(OUTPUTDIR)
  ghp-import $(OUTPUTDIR)
  git push gh gh-pages -f</code></pre></div>",
        "@": Object {},
      },
      "date": 2014-05-07T00:00:00.000Z,
      "description": "<p>A couple of days ago I swapped the static site generator used at this blog
from Jekyll to Pelican. It was not to much work, mostly changing the metadata of the posts.
The reason I changed engine is mostly to try out something different. I wanted to know the differences about the two of the top static site generators. It should not be surprising that I turned towards something written in python.</p>
<p>I configured Pelican to some level to make it behave as I wanted to. I wrote some custom path settings to remove the <code class=\\"language-text\\">.html</code> at the end of the url to each post by generating folders with index.html. The paths from jekyll where on the form <code class=\\"language-text\\">/year/month/day/slug/</code>. I still wanted to support incoming links to those parts. The urls on the new setup is in the same pattern to solve that. In time I would like to use the pattern <code class=\\"language-text\\">/year/slug/</code> or even just the slug. To do that I need to find a way to redirect the old urls. Any ideas on how to solve the redirect issue are more than welcome. The theme will probably be available at my Github profile or something similar soon.</p>
<p>I created a new Pelican theme for the blog. It is a work in progress. However, I think it is a great improvement over the old blog. Especially the fact that it does not load a huge css library to display something as simple as the design of this blog.</p>
<h3>So what about hosting?</h3>
<p>I still host the site at github pages, using a <a href=\\"https://github.com/relekang/rolflekang.com/blob/gh-pages/CNAME\\">CNAME</a> file to serve it on my domain <a href=\\"http://rolflekang.com\\">rolflekang.com</a>. I use a python package called <a href=\\"https://github.com/davisp/ghp-import\\">ghp-import</a> to push the generated site to Github Pages. The source of the blog is not stored in the same repository, because I do not want people to see my unfinished posts, but still track them in the repo. Therefor I have added the public repository as a remote called <code class=\\"language-text\\">gh-pages</code>. I use the Make task below to publish to github pages. The <code class=\\"language-text\\">publish</code> task that it depends on is just the standard task from the Makefile generated by <code class=\\"language-text\\">pelican-quickstart</code>.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"make\\"><pre class=\\"language-make\\"><code class=\\"language-make\\">github: publish
  cp CNAME $(OUTPUTDIR)
  ghp-import $(OUTPUTDIR)
  git push gh gh-pages -f</code></pre></div>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/moving-to-pelican",
      "image": Object {},
      "link": "https://rolflekang.com/moving-to-pelican",
      "origlink": null,
      "pubDate": "2014-05-07T00:00:00.000Z",
      "pubdate": 2014-05-07T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "this",
          "@": Object {},
        },
        Object {
          "#": "static-site",
          "@": Object {},
        },
        Object {
          "#": "pelican",
          "@": Object {},
        },
        Object {
          "#": "jekyll",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "A couple of days ago I swapped the static site generator used at this blog
from Jekyll to Pelican. It was not to much work, mostly changing…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/moving-to-pelican",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/moving-to-pelican",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Wed, 07 May 2014 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Moving the blog to pelican",
        "@": Object {},
      },
      "source": Object {},
      "summary": "A couple of days ago I swapped the static site generator used at this blog
from Jekyll to Pelican. It was not to much work, mostly changing…",
      "title": "Moving the blog to pelican",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "gruntjs",
        "cookiecutter",
        "tumblr",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<h2>Building custom themes for Tumblr</h2>
<p>To create themes for Tumblr one has to create a single HTML file and paste the contents into a editor on Tumblr(or create it in that editor). If you like me want to separate the files into at least different files for LESS or CSS, Javascript and HTML you need a tool to generate the concated file. Doing that without a tool grows tiresome really fast.</p>
<h3>Grunt to the rescue.</h3>
<p><a href=\\"http://gruntjs.com/\\">GruntJS</a> is a task-runner written in Javascript. It is intended to automate tiresome tasks in web projects. There are a lot of great plugins written for Grunt. A few of them has been really helpful when trying to automate the Tumblr theme process.</p>
<p>The Gruntfile I created does the following: compile less files, add a list of css files as inline style, copy the built file to clipboard and remove the generated files. Running <code class=\\"language-text\\">grunt</code> will place the theme in your clipboard so you can head over to Tumblr and paste it into the editor. Even better it is possible to run <code class=\\"language-text\\">grunt watch</code> to do this whenever a file is saved.</p>
<h2>The cookiecutter template</h2>
<p>I have created a cookiecutter template with a Gruntfile that generates the theme and places it in the clipboard like I described above. To use the cookiecutter project template run the command below. If you haven't heard of cookiecutter take a look at the <a href=\\"http://cookiecutter.readthedocs.org/en/latest/readme.html\\">documentation</a>. </p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\">cookiecutter https://github.com/relekang/cookiecutter-tumblr-theme.git</code></pre></div>
<h3>In the future</h3>
<p>It would be awesome if all it took to update the theme was <code class=\\"language-text\\">grunt deploy</code>. We will have to stick with pasting it for now. That said any feedback, requests or pull-requests are highly appreciated.</p>",
        "@": Object {},
      },
      "date": 2014-02-02T00:00:00.000Z,
      "description": "<h2>Building custom themes for Tumblr</h2>
<p>To create themes for Tumblr one has to create a single HTML file and paste the contents into a editor on Tumblr(or create it in that editor). If you like me want to separate the files into at least different files for LESS or CSS, Javascript and HTML you need a tool to generate the concated file. Doing that without a tool grows tiresome really fast.</p>
<h3>Grunt to the rescue.</h3>
<p><a href=\\"http://gruntjs.com/\\">GruntJS</a> is a task-runner written in Javascript. It is intended to automate tiresome tasks in web projects. There are a lot of great plugins written for Grunt. A few of them has been really helpful when trying to automate the Tumblr theme process.</p>
<p>The Gruntfile I created does the following: compile less files, add a list of css files as inline style, copy the built file to clipboard and remove the generated files. Running <code class=\\"language-text\\">grunt</code> will place the theme in your clipboard so you can head over to Tumblr and paste it into the editor. Even better it is possible to run <code class=\\"language-text\\">grunt watch</code> to do this whenever a file is saved.</p>
<h2>The cookiecutter template</h2>
<p>I have created a cookiecutter template with a Gruntfile that generates the theme and places it in the clipboard like I described above. To use the cookiecutter project template run the command below. If you haven't heard of cookiecutter take a look at the <a href=\\"http://cookiecutter.readthedocs.org/en/latest/readme.html\\">documentation</a>. </p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\">cookiecutter https://github.com/relekang/cookiecutter-tumblr-theme.git</code></pre></div>
<h3>In the future</h3>
<p>It would be awesome if all it took to update the theme was <code class=\\"language-text\\">grunt deploy</code>. We will have to stick with pasting it for now. That said any feedback, requests or pull-requests are highly appreciated.</p>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/building-tumblr-theme-with-grunt",
      "image": Object {},
      "link": "https://rolflekang.com/building-tumblr-theme-with-grunt",
      "origlink": null,
      "pubDate": "2014-02-02T00:00:00.000Z",
      "pubdate": 2014-02-02T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "gruntjs",
          "@": Object {},
        },
        Object {
          "#": "cookiecutter",
          "@": Object {},
        },
        Object {
          "#": "tumblr",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "Building custom themes for Tumblr To create themes for Tumblr one has to create a single HTML file and paste the contents into a editor on…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/building-tumblr-theme-with-grunt",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/building-tumblr-theme-with-grunt",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Sun, 02 Feb 2014 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Building a Tumblr theme with GruntJS",
        "@": Object {},
      },
      "source": Object {},
      "summary": "Building custom themes for Tumblr To create themes for Tumblr one has to create a single HTML file and paste the contents into a editor on…",
      "title": "Building a Tumblr theme with GruntJS",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "db",
        "backup",
        "redis",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>After I created the <a href=\\"https://github.com/relekang/memoris\\">memoris API</a> and started to use it I had to set up a backup routine for the Redis database running behind it. I only run one Redis server not a cluster.</p>
<h3>Lets dump some data</h3>
<p>Redis has a command to save .rdb file called <a href=\\"http://redis.io/commands/bgsave\\">BGSAVE</a>. The command will asynchronously save a <code class=\\"language-text\\">dump.rdb</code> file in the same folder as your redis server. This means that one probably would want to move the file and rename it. To create the dump file run the command below.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"bash\\"><pre class=\\"language-bash\\"><code class=\\"language-bash\\">$ redis-cli bgsave</code></pre></div>
<p>It is possible to use the <a href=\\"http://redis.io/commands/save\\">SAVE</a> command as well, but I'd like to do it asynchronously because ...</p>
<h3>Structuring backup files</h3>
<p>I would like to take a dump of the database every other hour. This backup is just incase of data coruption or me doing something stupid like overwriting something I should not overwrite. That said, those backups will be the base for my remote backup as well. The remote backup will be created by another machine fetching the latest backup from the server of Secure copy(scp).</p>
<p>I created to cron jobs that look like this:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"bash\\"><pre class=\\"language-bash\\"><code class=\\"language-bash\\"><span class=\\"token number\\">3</span>  */2 * * * redis-cli bgsave
<span class=\\"token number\\">23</span> */2 * * * <span class=\\"token function\\">mv</span> /var/lib/redis/dump.rdb /backups/redis/<span class=\\"token variable\\"><span class=\\"token variable\\">\`</span><span class=\\"token function\\">date</span> +%Y-%m-%d<span class=\\"token variable\\">\`</span></span>.rdb</code></pre></div>
<p>The last will copy the dump file to a backup directory. Since only year, month and day is specified it will only be one dump each day, but it will be overwritten every other hour of that day. There is 20 min between the two backups so I do not have to fear the second cron job running before the dump is finished. That number could be adjusted to be closer to the average time of a dump of the database size if one would want to.</p>
<h3>Puppet manifest</h3>
<p>I created a puppet manifest to create the cron jobs and to ensure that the backup directories are in place. I created a <a href=\\"https://gist.github.com/relekang/7136687\\">gist of the puppet manifest</a> if you want to clone.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"puppet\\"><pre class=\\"language-puppet\\"><code class=\\"language-puppet\\">file<span class=\\"token punctuation\\">{</span> <span class=\\"token punctuation\\">[</span> <span class=\\"token string\\">'/backups'</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'/backups/redis'</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">:</span>
  <span class=\\"token attr-name\\">ensure</span>  <span class=\\"token operator\\">=></span> <span class=\\"token string\\">'directory'</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token attr-name\\">owner</span>   <span class=\\"token operator\\">=></span> <span class=\\"token string\\">'root'</span>
<span class=\\"token punctuation\\">}</span>
cron<span class=\\"token punctuation\\">{</span> <span class=\\"token string\\">'redis-bgsave'</span><span class=\\"token punctuation\\">:</span>
  <span class=\\"token attr-name\\">command</span> <span class=\\"token operator\\">=></span> <span class=\\"token string\\">'redis-cli bgsave'</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token attr-name\\">user</span>    <span class=\\"token operator\\">=></span> <span class=\\"token string\\">'root'</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token attr-name\\">hour</span>    <span class=\\"token operator\\">=></span> <span class=\\"token string\\">'0-23/2'</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token attr-name\\">minute</span>  <span class=\\"token operator\\">=></span> <span class=\\"token number\\">3</span><span class=\\"token punctuation\\">,</span>
<span class=\\"token punctuation\\">}</span>

cron<span class=\\"token punctuation\\">{</span> <span class=\\"token string\\">'redis-move-backup'</span><span class=\\"token punctuation\\">:</span>
  <span class=\\"token attr-name\\">command</span> <span class=\\"token operator\\">=></span> <span class=\\"token string\\">'mv /var/lib/redis/dump.rdb /backups/redis/\`date +%Y-%m-%d\`.rdb'</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token attr-name\\">user</span>    <span class=\\"token operator\\">=></span> <span class=\\"token string\\">'root'</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token attr-name\\">hour</span>    <span class=\\"token operator\\">=></span> <span class=\\"token string\\">'0-23/2'</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token attr-name\\">minute</span>  <span class=\\"token operator\\">=></span> <span class=\\"token number\\">23</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token attr-name\\">require</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">[</span> File<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'/backups/redis'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span> Cron<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'redis-bgsave'</span><span class=\\"token punctuation\\">]</span> <span class=\\"token punctuation\\">]</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>",
        "@": Object {},
      },
      "date": 2013-10-24T00:00:00.000Z,
      "description": "<p>After I created the <a href=\\"https://github.com/relekang/memoris\\">memoris API</a> and started to use it I had to set up a backup routine for the Redis database running behind it. I only run one Redis server not a cluster.</p>
<h3>Lets dump some data</h3>
<p>Redis has a command to save .rdb file called <a href=\\"http://redis.io/commands/bgsave\\">BGSAVE</a>. The command will asynchronously save a <code class=\\"language-text\\">dump.rdb</code> file in the same folder as your redis server. This means that one probably would want to move the file and rename it. To create the dump file run the command below.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"bash\\"><pre class=\\"language-bash\\"><code class=\\"language-bash\\">$ redis-cli bgsave</code></pre></div>
<p>It is possible to use the <a href=\\"http://redis.io/commands/save\\">SAVE</a> command as well, but I'd like to do it asynchronously because ...</p>
<h3>Structuring backup files</h3>
<p>I would like to take a dump of the database every other hour. This backup is just incase of data coruption or me doing something stupid like overwriting something I should not overwrite. That said, those backups will be the base for my remote backup as well. The remote backup will be created by another machine fetching the latest backup from the server of Secure copy(scp).</p>
<p>I created to cron jobs that look like this:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"bash\\"><pre class=\\"language-bash\\"><code class=\\"language-bash\\"><span class=\\"token number\\">3</span>  */2 * * * redis-cli bgsave
<span class=\\"token number\\">23</span> */2 * * * <span class=\\"token function\\">mv</span> /var/lib/redis/dump.rdb /backups/redis/<span class=\\"token variable\\"><span class=\\"token variable\\">\`</span><span class=\\"token function\\">date</span> +%Y-%m-%d<span class=\\"token variable\\">\`</span></span>.rdb</code></pre></div>
<p>The last will copy the dump file to a backup directory. Since only year, month and day is specified it will only be one dump each day, but it will be overwritten every other hour of that day. There is 20 min between the two backups so I do not have to fear the second cron job running before the dump is finished. That number could be adjusted to be closer to the average time of a dump of the database size if one would want to.</p>
<h3>Puppet manifest</h3>
<p>I created a puppet manifest to create the cron jobs and to ensure that the backup directories are in place. I created a <a href=\\"https://gist.github.com/relekang/7136687\\">gist of the puppet manifest</a> if you want to clone.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"puppet\\"><pre class=\\"language-puppet\\"><code class=\\"language-puppet\\">file<span class=\\"token punctuation\\">{</span> <span class=\\"token punctuation\\">[</span> <span class=\\"token string\\">'/backups'</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'/backups/redis'</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">:</span>
  <span class=\\"token attr-name\\">ensure</span>  <span class=\\"token operator\\">=></span> <span class=\\"token string\\">'directory'</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token attr-name\\">owner</span>   <span class=\\"token operator\\">=></span> <span class=\\"token string\\">'root'</span>
<span class=\\"token punctuation\\">}</span>
cron<span class=\\"token punctuation\\">{</span> <span class=\\"token string\\">'redis-bgsave'</span><span class=\\"token punctuation\\">:</span>
  <span class=\\"token attr-name\\">command</span> <span class=\\"token operator\\">=></span> <span class=\\"token string\\">'redis-cli bgsave'</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token attr-name\\">user</span>    <span class=\\"token operator\\">=></span> <span class=\\"token string\\">'root'</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token attr-name\\">hour</span>    <span class=\\"token operator\\">=></span> <span class=\\"token string\\">'0-23/2'</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token attr-name\\">minute</span>  <span class=\\"token operator\\">=></span> <span class=\\"token number\\">3</span><span class=\\"token punctuation\\">,</span>
<span class=\\"token punctuation\\">}</span>

cron<span class=\\"token punctuation\\">{</span> <span class=\\"token string\\">'redis-move-backup'</span><span class=\\"token punctuation\\">:</span>
  <span class=\\"token attr-name\\">command</span> <span class=\\"token operator\\">=></span> <span class=\\"token string\\">'mv /var/lib/redis/dump.rdb /backups/redis/\`date +%Y-%m-%d\`.rdb'</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token attr-name\\">user</span>    <span class=\\"token operator\\">=></span> <span class=\\"token string\\">'root'</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token attr-name\\">hour</span>    <span class=\\"token operator\\">=></span> <span class=\\"token string\\">'0-23/2'</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token attr-name\\">minute</span>  <span class=\\"token operator\\">=></span> <span class=\\"token number\\">23</span><span class=\\"token punctuation\\">,</span>
  <span class=\\"token attr-name\\">require</span> <span class=\\"token operator\\">=></span> <span class=\\"token punctuation\\">[</span> File<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'/backups/redis'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span> Cron<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'redis-bgsave'</span><span class=\\"token punctuation\\">]</span> <span class=\\"token punctuation\\">]</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/backup-routines-for-redisdb",
      "image": Object {},
      "link": "https://rolflekang.com/backup-routines-for-redisdb",
      "origlink": null,
      "pubDate": "2013-10-24T00:00:00.000Z",
      "pubdate": 2013-10-24T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "db",
          "@": Object {},
        },
        Object {
          "#": "backup",
          "@": Object {},
        },
        Object {
          "#": "redis",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "After I created the memoris API and started to use it I had to set up a backup routine for the Redis database running behind it. I only run…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/backup-routines-for-redisdb",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/backup-routines-for-redisdb",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Thu, 24 Oct 2013 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Backup routine for Redis",
        "@": Object {},
      },
      "source": Object {},
      "summary": "After I created the memoris API and started to use it I had to set up a backup routine for the Redis database running behind it. I only run…",
      "title": "Backup routine for Redis",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "django",
        "custom user",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>In Django 1.5 custom users was introduced. This means that the user model can be swapped for a
custom model. How does this affect third-party apps? Foreignkeys and other relations will crash
if they point to <code class=\\"language-text\\">auth.User</code>. It will raise a exception of the type:
<code class=\\"language-text\\">AttributeError: Manager isn&#39;t available; User has been swapped for &#39;myapp.CustomUser&#39;</code></p>
<h3>A possible solution</h3>
<p>In <a href=\\"http://github.com/relekang/django-nopassword/\\">django-nopassword</a> I tried a some different approaches. I found a solution that worked well in that app. I added a file, called it <em>utils.py</em>, did not find a more suitable name. The code is listed below:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"python\\"><pre class=\\"language-python\\"><code class=\\"language-python\\"><span class=\\"token comment\\"># -*- coding: utf-8 -*-</span>
<span class=\\"token keyword\\">import</span> django

<span class=\\"token keyword\\">if</span> django<span class=\\"token punctuation\\">.</span>VERSION <span class=\\"token operator\\">>=</span> <span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">5</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token keyword\\">from</span> django<span class=\\"token punctuation\\">.</span>contrib<span class=\\"token punctuation\\">.</span>auth <span class=\\"token keyword\\">import</span> get_user_model
    User <span class=\\"token operator\\">=</span> get_user_model<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>
<span class=\\"token keyword\\">else</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token keyword\\">from</span> django<span class=\\"token punctuation\\">.</span>contrib<span class=\\"token punctuation\\">.</span>auth<span class=\\"token punctuation\\">.</span>models <span class=\\"token keyword\\">import</span> User</code></pre></div>
<p>Everywhere I use the User model I changed the import to <code class=\\"language-text\\">from app_name.utils import User</code> where app<em>name in this case was \`django</em>nopassword\`.</p>
<h3>Testing</h3>
<p>To be certain that everything was working correctly with custom user I created some tests and <a href=\\"https://github.com/relekang/django-nopassword/tree/master/tests\\">a test app with a custom user</a>. These tests also work nicely on Django 1.4 since <code class=\\"language-text\\">AUTH_USER_MODEL</code> is ignored in earlier versions of Django. To make it easier to test with different environments I added it to <a href=\\"https://travis-ci.org/\\">Travis</a> and added a hook to the Github repository. The travis settings:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"yaml\\"><pre class=\\"language-yaml\\"><code class=\\"language-yaml\\"><span class=\\"token key atrule\\">language</span><span class=\\"token punctuation\\">:</span> python

<span class=\\"token key atrule\\">python</span><span class=\\"token punctuation\\">:</span>
  <span class=\\"token punctuation\\">-</span> <span class=\\"token string\\">\\"2.6\\"</span>
  <span class=\\"token punctuation\\">-</span> <span class=\\"token string\\">\\"2.7\\"</span>

<span class=\\"token key atrule\\">env</span><span class=\\"token punctuation\\">:</span>
  <span class=\\"token punctuation\\">-</span> DJANGO_VERSION=1.4
  <span class=\\"token punctuation\\">-</span> DJANGO_VERSION=1.5

<span class=\\"token key atrule\\">install</span><span class=\\"token punctuation\\">:</span>
  <span class=\\"token punctuation\\">-</span> pip install psycopg2
  <span class=\\"token punctuation\\">-</span> pip install django==$DJANGO_VERSION

<span class=\\"token key atrule\\">script</span><span class=\\"token punctuation\\">:</span> python setup.py test

<span class=\\"token key atrule\\">before_script</span><span class=\\"token punctuation\\">:</span>
  <span class=\\"token punctuation\\">-</span> psql <span class=\\"token punctuation\\">-</span>c 'create database django_nopassword;' <span class=\\"token punctuation\\">-</span>U postgres</code></pre></div>",
        "@": Object {},
      },
      "date": 2013-05-22T00:00:00.000Z,
      "description": "<p>In Django 1.5 custom users was introduced. This means that the user model can be swapped for a
custom model. How does this affect third-party apps? Foreignkeys and other relations will crash
if they point to <code class=\\"language-text\\">auth.User</code>. It will raise a exception of the type:
<code class=\\"language-text\\">AttributeError: Manager isn&#39;t available; User has been swapped for &#39;myapp.CustomUser&#39;</code></p>
<h3>A possible solution</h3>
<p>In <a href=\\"http://github.com/relekang/django-nopassword/\\">django-nopassword</a> I tried a some different approaches. I found a solution that worked well in that app. I added a file, called it <em>utils.py</em>, did not find a more suitable name. The code is listed below:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"python\\"><pre class=\\"language-python\\"><code class=\\"language-python\\"><span class=\\"token comment\\"># -*- coding: utf-8 -*-</span>
<span class=\\"token keyword\\">import</span> django

<span class=\\"token keyword\\">if</span> django<span class=\\"token punctuation\\">.</span>VERSION <span class=\\"token operator\\">>=</span> <span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">5</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token keyword\\">from</span> django<span class=\\"token punctuation\\">.</span>contrib<span class=\\"token punctuation\\">.</span>auth <span class=\\"token keyword\\">import</span> get_user_model
    User <span class=\\"token operator\\">=</span> get_user_model<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>
<span class=\\"token keyword\\">else</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token keyword\\">from</span> django<span class=\\"token punctuation\\">.</span>contrib<span class=\\"token punctuation\\">.</span>auth<span class=\\"token punctuation\\">.</span>models <span class=\\"token keyword\\">import</span> User</code></pre></div>
<p>Everywhere I use the User model I changed the import to <code class=\\"language-text\\">from app_name.utils import User</code> where app<em>name in this case was \`django</em>nopassword\`.</p>
<h3>Testing</h3>
<p>To be certain that everything was working correctly with custom user I created some tests and <a href=\\"https://github.com/relekang/django-nopassword/tree/master/tests\\">a test app with a custom user</a>. These tests also work nicely on Django 1.4 since <code class=\\"language-text\\">AUTH_USER_MODEL</code> is ignored in earlier versions of Django. To make it easier to test with different environments I added it to <a href=\\"https://travis-ci.org/\\">Travis</a> and added a hook to the Github repository. The travis settings:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"yaml\\"><pre class=\\"language-yaml\\"><code class=\\"language-yaml\\"><span class=\\"token key atrule\\">language</span><span class=\\"token punctuation\\">:</span> python

<span class=\\"token key atrule\\">python</span><span class=\\"token punctuation\\">:</span>
  <span class=\\"token punctuation\\">-</span> <span class=\\"token string\\">\\"2.6\\"</span>
  <span class=\\"token punctuation\\">-</span> <span class=\\"token string\\">\\"2.7\\"</span>

<span class=\\"token key atrule\\">env</span><span class=\\"token punctuation\\">:</span>
  <span class=\\"token punctuation\\">-</span> DJANGO_VERSION=1.4
  <span class=\\"token punctuation\\">-</span> DJANGO_VERSION=1.5

<span class=\\"token key atrule\\">install</span><span class=\\"token punctuation\\">:</span>
  <span class=\\"token punctuation\\">-</span> pip install psycopg2
  <span class=\\"token punctuation\\">-</span> pip install django==$DJANGO_VERSION

<span class=\\"token key atrule\\">script</span><span class=\\"token punctuation\\">:</span> python setup.py test

<span class=\\"token key atrule\\">before_script</span><span class=\\"token punctuation\\">:</span>
  <span class=\\"token punctuation\\">-</span> psql <span class=\\"token punctuation\\">-</span>c 'create database django_nopassword;' <span class=\\"token punctuation\\">-</span>U postgres</code></pre></div>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/django-app-custom-user",
      "image": Object {},
      "link": "https://rolflekang.com/django-app-custom-user",
      "origlink": null,
      "pubDate": "2013-05-22T00:00:00.000Z",
      "pubdate": 2013-05-22T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "django",
          "@": Object {},
        },
        Object {
          "#": "custom user",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "In Django 1.5 custom users was introduced. This means that the user model can be swapped for a
custom model. How does this affect third…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/django-app-custom-user",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/django-app-custom-user",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Wed, 22 May 2013 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Making your Django app ready for custom users",
        "@": Object {},
      },
      "source": Object {},
      "summary": "In Django 1.5 custom users was introduced. This means that the user model can be swapped for a
custom model. How does this affect third…",
      "title": "Making your Django app ready for custom users",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "pypstats",
        "pypi",
        "stats",
        "geek-tool",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p><strong>Update:</strong> <em>PyPi stopped serving stats in may 2013. The script in this blogpost will only be able to get download counts until may 24th. More information can be found on the <a href=\\"http://mail.python.org/pipermail/distutils-sig/2013-May/020855.html\\">distutils mailinglist</a>. Anyways it was fun as long as it worked.</em></p>
<p>I recently stumbled over <a href=\\"https://pypi.python.org/pypi/pypstats\\">pypstats</a> and wanted to combine it with the power of <a href=\\"http://projects.tynsoe.org/en/geektool/\\">Geek Tool</a>. I created a shells-script to download the stats regularly and print total downloads to a text-file.</p>
<p>To install pypstats use <code class=\\"language-text\\">pip install pypstats</code></p>
<div class=\\"gatsby-highlight\\" data-language=\\"bash\\"><pre class=\\"language-bash\\"><code class=\\"language-bash\\"><span class=\\"token shebang important\\">#!/bin/bash</span>
<span class=\\"token assign-left variable\\"><span class=\\"token environment constant\\">PATH</span></span><span class=\\"token operator\\">=</span>/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin
<span class=\\"token builtin class-name\\">cd</span> ~/pypi-stats/
pyps update -q <span class=\\"token operator\\">&lt;</span>project<span class=\\"token operator\\">></span>
pyps total -q <span class=\\"token operator\\">&lt;</span>project<span class=\\"token operator\\">></span>_stats.pkl <span class=\\"token operator\\">></span> <span class=\\"token operator\\">&lt;</span>project<span class=\\"token operator\\">></span>-total.txt</code></pre></div>
<p>It is necessary to set the path beacause crontab does not run with a environment that includes <code class=\\"language-text\\">/usr/local/bin</code>, where pypstats is installed by pip. The <code class=\\"language-text\\">-q</code> makes the operations perform quietly.</p>
<p>Then in Geek Tools I just added this <code class=\\"language-text\\">cat ~/pypi-stats/&lt;project&gt;-total.txt</code></p>",
        "@": Object {},
      },
      "date": 2013-03-03T00:00:00.000Z,
      "description": "<p><strong>Update:</strong> <em>PyPi stopped serving stats in may 2013. The script in this blogpost will only be able to get download counts until may 24th. More information can be found on the <a href=\\"http://mail.python.org/pipermail/distutils-sig/2013-May/020855.html\\">distutils mailinglist</a>. Anyways it was fun as long as it worked.</em></p>
<p>I recently stumbled over <a href=\\"https://pypi.python.org/pypi/pypstats\\">pypstats</a> and wanted to combine it with the power of <a href=\\"http://projects.tynsoe.org/en/geektool/\\">Geek Tool</a>. I created a shells-script to download the stats regularly and print total downloads to a text-file.</p>
<p>To install pypstats use <code class=\\"language-text\\">pip install pypstats</code></p>
<div class=\\"gatsby-highlight\\" data-language=\\"bash\\"><pre class=\\"language-bash\\"><code class=\\"language-bash\\"><span class=\\"token shebang important\\">#!/bin/bash</span>
<span class=\\"token assign-left variable\\"><span class=\\"token environment constant\\">PATH</span></span><span class=\\"token operator\\">=</span>/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin
<span class=\\"token builtin class-name\\">cd</span> ~/pypi-stats/
pyps update -q <span class=\\"token operator\\">&lt;</span>project<span class=\\"token operator\\">></span>
pyps total -q <span class=\\"token operator\\">&lt;</span>project<span class=\\"token operator\\">></span>_stats.pkl <span class=\\"token operator\\">></span> <span class=\\"token operator\\">&lt;</span>project<span class=\\"token operator\\">></span>-total.txt</code></pre></div>
<p>It is necessary to set the path beacause crontab does not run with a environment that includes <code class=\\"language-text\\">/usr/local/bin</code>, where pypstats is installed by pip. The <code class=\\"language-text\\">-q</code> makes the operations perform quietly.</p>
<p>Then in Geek Tools I just added this <code class=\\"language-text\\">cat ~/pypi-stats/&lt;project&gt;-total.txt</code></p>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/stats-are-fun",
      "image": Object {},
      "link": "https://rolflekang.com/stats-are-fun",
      "origlink": null,
      "pubDate": "2013-03-03T00:00:00.000Z",
      "pubdate": 2013-03-03T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "pypstats",
          "@": Object {},
        },
        Object {
          "#": "pypi",
          "@": Object {},
        },
        Object {
          "#": "stats",
          "@": Object {},
        },
        Object {
          "#": "geek-tool",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "Update: PyPi stopped serving stats in may 2013. The script in this blogpost will only be able to get download counts until may 24th. More…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/stats-are-fun",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/stats-are-fun",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Sun, 03 Mar 2013 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Stats are fun",
        "@": Object {},
      },
      "source": Object {},
      "summary": "Update: PyPi stopped serving stats in may 2013. The script in this blogpost will only be able to get download counts until may 24th. More…",
      "title": "Stats are fun",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "alfredapp",
        "jekyll",
        "shell script",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p><a href=\\"http://www.alfredapp.com/\\">Alfred App</a> is the productivity application I use the most, and the one that actually boosts productivity. I recently started to use Jekyll as a blog engine. I wanted an easy way to open a new file with the default parameters already in place. The tool for the job was a shell script as a <a href=\\"http://www.alfredapp.com/powerpack/#extensions-commands\\">Alfred extension</a></p>
<div class=\\"gatsby-highlight\\" data-language=\\"bash\\"><pre class=\\"language-bash\\"><code class=\\"language-bash\\"><span class=\\"token assign-left variable\\">DRAFT_PATH</span><span class=\\"token operator\\">=</span>~/relekang.github.com/drafts/<span class=\\"token punctuation\\">{</span>query<span class=\\"token punctuation\\">}</span>.md

<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span> -f <span class=\\"token variable\\">$DRAFT_PATH</span> <span class=\\"token punctuation\\">]</span>
<span class=\\"token keyword\\">then</span>
  <span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"File exists\\"</span>
  <span class=\\"token function\\">open</span> http://127.0.0.1:4000/drafts/<span class=\\"token punctuation\\">{</span>query<span class=\\"token punctuation\\">}</span>.html
  <span class=\\"token function\\">open</span> <span class=\\"token variable\\">$DRAFT_PATH</span>
<span class=\\"token keyword\\">else</span>
  <span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"Creating file\\"</span>
  <span class=\\"token function\\">touch</span> <span class=\\"token variable\\">$DRAFT_PATH</span>
  <span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"---\\"</span> <span class=\\"token operator\\">></span> <span class=\\"token variable\\">$DRAFT_PATH</span>
  <span class=\\"token function\\">open</span> http://127.0.0.1:4000/drafts/<span class=\\"token punctuation\\">{</span>query<span class=\\"token punctuation\\">}</span>.html
  <span class=\\"token function\\">open</span> <span class=\\"token variable\\">$DRAFT_PATH</span>
<span class=\\"token keyword\\">fi</span></code></pre></div>
<p><em><code class=\\"language-text\\"># { page.title }</code> has double curly-brackets in the script, but I could not get Jekyll to ignore them.</em></p>
<p>I also wanted an easy way to add date and copy the post to <code class=\\"language-text\\">_posts</code> when I am finished writing it.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"bash\\"><pre class=\\"language-bash\\"><code class=\\"language-bash\\"><span class=\\"token assign-left variable\\">DATE</span><span class=\\"token operator\\">=</span>date <span class=\\"token string\\">'+%Y-%m-%d'</span>
<span class=\\"token assign-left variable\\">DRAFT_PATH</span><span class=\\"token operator\\">=</span>~/relekang.github.com/drafts/<span class=\\"token punctuation\\">{</span>query<span class=\\"token punctuation\\">}</span>.md
<span class=\\"token assign-left variable\\">PUBLISH_PATH</span><span class=\\"token operator\\">=</span>~/relekang.github.com/_posts/<span class=\\"token variable\\">$DATE</span>-<span class=\\"token punctuation\\">{</span>query<span class=\\"token punctuation\\">}</span>.md

<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span> -f <span class=\\"token variable\\">$DRAFT_PATH</span> <span class=\\"token punctuation\\">]</span>
<span class=\\"token keyword\\">then</span>
  <span class=\\"token function\\">mv</span> <span class=\\"token variable\\">$DRAFT_PATH</span> <span class=\\"token variable\\">$PUBLISH_PATH</span>
  <span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"Post added to _posts\\"</span>
<span class=\\"token keyword\\">else</span>
  <span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"Could not find draft\\"</span>
<span class=\\"token keyword\\">fi</span></code></pre></div>
<p>Both scripts are set up with Silent = True and Output = True. Silent stops Alfred
from opening a terminal window. Output makes output data appear in notification center.</p>",
        "@": Object {},
      },
      "date": 2013-02-26T00:00:00.000Z,
      "description": "<p><a href=\\"http://www.alfredapp.com/\\">Alfred App</a> is the productivity application I use the most, and the one that actually boosts productivity. I recently started to use Jekyll as a blog engine. I wanted an easy way to open a new file with the default parameters already in place. The tool for the job was a shell script as a <a href=\\"http://www.alfredapp.com/powerpack/#extensions-commands\\">Alfred extension</a></p>
<div class=\\"gatsby-highlight\\" data-language=\\"bash\\"><pre class=\\"language-bash\\"><code class=\\"language-bash\\"><span class=\\"token assign-left variable\\">DRAFT_PATH</span><span class=\\"token operator\\">=</span>~/relekang.github.com/drafts/<span class=\\"token punctuation\\">{</span>query<span class=\\"token punctuation\\">}</span>.md

<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span> -f <span class=\\"token variable\\">$DRAFT_PATH</span> <span class=\\"token punctuation\\">]</span>
<span class=\\"token keyword\\">then</span>
  <span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"File exists\\"</span>
  <span class=\\"token function\\">open</span> http://127.0.0.1:4000/drafts/<span class=\\"token punctuation\\">{</span>query<span class=\\"token punctuation\\">}</span>.html
  <span class=\\"token function\\">open</span> <span class=\\"token variable\\">$DRAFT_PATH</span>
<span class=\\"token keyword\\">else</span>
  <span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"Creating file\\"</span>
  <span class=\\"token function\\">touch</span> <span class=\\"token variable\\">$DRAFT_PATH</span>
  <span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"---\\"</span> <span class=\\"token operator\\">></span> <span class=\\"token variable\\">$DRAFT_PATH</span>
  <span class=\\"token function\\">open</span> http://127.0.0.1:4000/drafts/<span class=\\"token punctuation\\">{</span>query<span class=\\"token punctuation\\">}</span>.html
  <span class=\\"token function\\">open</span> <span class=\\"token variable\\">$DRAFT_PATH</span>
<span class=\\"token keyword\\">fi</span></code></pre></div>
<p><em><code class=\\"language-text\\"># { page.title }</code> has double curly-brackets in the script, but I could not get Jekyll to ignore them.</em></p>
<p>I also wanted an easy way to add date and copy the post to <code class=\\"language-text\\">_posts</code> when I am finished writing it.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"bash\\"><pre class=\\"language-bash\\"><code class=\\"language-bash\\"><span class=\\"token assign-left variable\\">DATE</span><span class=\\"token operator\\">=</span>date <span class=\\"token string\\">'+%Y-%m-%d'</span>
<span class=\\"token assign-left variable\\">DRAFT_PATH</span><span class=\\"token operator\\">=</span>~/relekang.github.com/drafts/<span class=\\"token punctuation\\">{</span>query<span class=\\"token punctuation\\">}</span>.md
<span class=\\"token assign-left variable\\">PUBLISH_PATH</span><span class=\\"token operator\\">=</span>~/relekang.github.com/_posts/<span class=\\"token variable\\">$DATE</span>-<span class=\\"token punctuation\\">{</span>query<span class=\\"token punctuation\\">}</span>.md

<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span> -f <span class=\\"token variable\\">$DRAFT_PATH</span> <span class=\\"token punctuation\\">]</span>
<span class=\\"token keyword\\">then</span>
  <span class=\\"token function\\">mv</span> <span class=\\"token variable\\">$DRAFT_PATH</span> <span class=\\"token variable\\">$PUBLISH_PATH</span>
  <span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"Post added to _posts\\"</span>
<span class=\\"token keyword\\">else</span>
  <span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"Could not find draft\\"</span>
<span class=\\"token keyword\\">fi</span></code></pre></div>
<p>Both scripts are set up with Silent = True and Output = True. Silent stops Alfred
from opening a terminal window. Output makes output data appear in notification center.</p>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/alfred-scripts-for-jekyll",
      "image": Object {},
      "link": "https://rolflekang.com/alfred-scripts-for-jekyll",
      "origlink": null,
      "pubDate": "2013-02-26T00:00:00.000Z",
      "pubdate": 2013-02-26T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "alfredapp",
          "@": Object {},
        },
        Object {
          "#": "jekyll",
          "@": Object {},
        },
        Object {
          "#": "shell script",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "Alfred App is the productivity application I use the most, and the one that actually boosts productivity. I recently started to use Jekyll…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/alfred-scripts-for-jekyll",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/alfred-scripts-for-jekyll",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Tue, 26 Feb 2013 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Alfred scripts for Jekyll",
        "@": Object {},
      },
      "source": Object {},
      "summary": "Alfred App is the productivity application I use the most, and the one that actually boosts productivity. I recently started to use Jekyll…",
      "title": "Alfred scripts for Jekyll",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "tags",
        "postgres",
        "array",
        "pgarray",
        "django",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>I wanted to use arrays in postgresql for tags on this blog. I installed the packages
<code class=\\"language-text\\">djorm-ext-pgarray</code> and <code class=\\"language-text\\">djorm-ext-expressions</code>. The model for the blogposts is displayed below. </p>
<div class=\\"gatsby-highlight\\" data-language=\\"python\\"><pre class=\\"language-python\\"><code class=\\"language-python\\"><span class=\\"token keyword\\">from</span> django<span class=\\"token punctuation\\">.</span>db <span class=\\"token keyword\\">import</span> models
<span class=\\"token keyword\\">from</span> djorm_expressions<span class=\\"token punctuation\\">.</span>models <span class=\\"token keyword\\">import</span> ExpressionManager
<span class=\\"token keyword\\">from</span> djorm_pgarray<span class=\\"token punctuation\\">.</span>fields <span class=\\"token keyword\\">import</span> ArrayField

<span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Post</span> <span class=\\"token punctuation\\">(</span>models<span class=\\"token punctuation\\">.</span>Model<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>
    title <span class=\\"token operator\\">=</span> models<span class=\\"token punctuation\\">.</span>CharField<span class=\\"token punctuation\\">(</span>max_length<span class=\\"token operator\\">=</span><span class=\\"token number\\">80</span><span class=\\"token punctuation\\">)</span>
    slug <span class=\\"token operator\\">=</span> models<span class=\\"token punctuation\\">.</span>SlugField<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>
    pub_date <span class=\\"token operator\\">=</span> models<span class=\\"token punctuation\\">.</span>DateField<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>
    content <span class=\\"token operator\\">=</span> models<span class=\\"token punctuation\\">.</span>TextField<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>
    tags <span class=\\"token operator\\">=</span> ArrayField<span class=\\"token punctuation\\">(</span>dbtype<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"varchar(60)\\"</span><span class=\\"token punctuation\\">)</span>
    objects <span class=\\"token operator\\">=</span> ExpressionManager<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span></code></pre></div>
<p>The tags field is using <code class=\\"language-text\\">djorm_pgarray.fields.ArrayField</code> and the ExpressionManagaer is
needed if one would need to make a query using the ArrayField.</p>",
        "@": Object {},
      },
      "date": 2013-01-27T00:00:00.000Z,
      "description": "<p>I wanted to use arrays in postgresql for tags on this blog. I installed the packages
<code class=\\"language-text\\">djorm-ext-pgarray</code> and <code class=\\"language-text\\">djorm-ext-expressions</code>. The model for the blogposts is displayed below. </p>
<div class=\\"gatsby-highlight\\" data-language=\\"python\\"><pre class=\\"language-python\\"><code class=\\"language-python\\"><span class=\\"token keyword\\">from</span> django<span class=\\"token punctuation\\">.</span>db <span class=\\"token keyword\\">import</span> models
<span class=\\"token keyword\\">from</span> djorm_expressions<span class=\\"token punctuation\\">.</span>models <span class=\\"token keyword\\">import</span> ExpressionManager
<span class=\\"token keyword\\">from</span> djorm_pgarray<span class=\\"token punctuation\\">.</span>fields <span class=\\"token keyword\\">import</span> ArrayField

<span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Post</span> <span class=\\"token punctuation\\">(</span>models<span class=\\"token punctuation\\">.</span>Model<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>
    title <span class=\\"token operator\\">=</span> models<span class=\\"token punctuation\\">.</span>CharField<span class=\\"token punctuation\\">(</span>max_length<span class=\\"token operator\\">=</span><span class=\\"token number\\">80</span><span class=\\"token punctuation\\">)</span>
    slug <span class=\\"token operator\\">=</span> models<span class=\\"token punctuation\\">.</span>SlugField<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>
    pub_date <span class=\\"token operator\\">=</span> models<span class=\\"token punctuation\\">.</span>DateField<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>
    content <span class=\\"token operator\\">=</span> models<span class=\\"token punctuation\\">.</span>TextField<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>
    tags <span class=\\"token operator\\">=</span> ArrayField<span class=\\"token punctuation\\">(</span>dbtype<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"varchar(60)\\"</span><span class=\\"token punctuation\\">)</span>
    objects <span class=\\"token operator\\">=</span> ExpressionManager<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span></code></pre></div>
<p>The tags field is using <code class=\\"language-text\\">djorm_pgarray.fields.ArrayField</code> and the ExpressionManagaer is
needed if one would need to make a query using the ArrayField.</p>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/use-array-in-postgresql",
      "image": Object {},
      "link": "https://rolflekang.com/use-array-in-postgresql",
      "origlink": null,
      "pubDate": "2013-01-27T00:00:00.000Z",
      "pubdate": 2013-01-27T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "tags",
          "@": Object {},
        },
        Object {
          "#": "postgres",
          "@": Object {},
        },
        Object {
          "#": "array",
          "@": Object {},
        },
        Object {
          "#": "pgarray",
          "@": Object {},
        },
        Object {
          "#": "django",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "I wanted to use arrays in postgresql for tags on this blog. I installed the packages
 and . The model for the blogposts is displayed below…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/use-array-in-postgresql",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/use-array-in-postgresql",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Sun, 27 Jan 2013 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Use array in postgresql with django",
        "@": Object {},
      },
      "source": Object {},
      "summary": "I wanted to use arrays in postgresql for tags on this blog. I installed the packages
 and . The model for the blogposts is displayed below…",
      "title": "Use array in postgresql with django",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "puppet",
        "web.py",
        "nginx",
        "uwsgi",
        "github",
        "github-hooks",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>I recently started using github web interface as editor for my puppet configuration. I wanted to be able to push a new configuration without doing it manually, as I do not have a puppet master I wanted to try using Github hooks as in the <a href=\\"/the-github-lamp/\\">Github lamp code</a>. I have the puppet-repo cloned to <code class=\\"language-text\\">/puppet/</code> and the main manifest is in <code class=\\"language-text\\">/puppet/manifests/site.pp</code>. The code below is the web.py script. It checks the payload from Github and will only apply the configuration if changes are pushed to the master branch. A GET request would simply get a 404.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"python\\"><pre class=\\"language-python\\"><code class=\\"language-python\\"><span class=\\"token keyword\\">from</span> fabric<span class=\\"token punctuation\\">.</span>api <span class=\\"token keyword\\">import</span> local<span class=\\"token punctuation\\">,</span> lcd
<span class=\\"token keyword\\">import</span> web<span class=\\"token punctuation\\">,</span> json

urls <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token string\\">'/'</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'GithubHook'</span><span class=\\"token punctuation\\">,</span>
<span class=\\"token punctuation\\">)</span>

render <span class=\\"token operator\\">=</span> web<span class=\\"token punctuation\\">.</span>template<span class=\\"token punctuation\\">.</span>render<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'.'</span><span class=\\"token punctuation\\">)</span>

<span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">GithubHook</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token keyword\\">def</span> <span class=\\"token function\\">POST</span><span class=\\"token punctuation\\">(</span>self<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>
        data <span class=\\"token operator\\">=</span> json<span class=\\"token punctuation\\">.</span>loads<span class=\\"token punctuation\\">(</span>web<span class=\\"token punctuation\\">.</span><span class=\\"token builtin\\">input</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span>payload<span class=\\"token punctuation\\">)</span>
        <span class=\\"token keyword\\">if</span> <span class=\\"token string\\">'ref'</span> <span class=\\"token keyword\\">in</span> data<span class=\\"token punctuation\\">:</span>
            <span class=\\"token keyword\\">if</span> data<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'ref'</span><span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">==</span> <span class=\\"token string\\">'refs/heads/master'</span><span class=\\"token punctuation\\">:</span>
              <span class=\\"token keyword\\">with</span> lcd<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'/puppet/'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>
                    local<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'git pull origin master'</span><span class=\\"token punctuation\\">)</span>
                    local<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'puppet apply /puppet/manifests/site.pp'</span><span class=\\"token punctuation\\">)</span>
                    <span class=\\"token keyword\\">print</span> <span class=\\"token string\\">\\"applied puppet\\"</span>
        <span class=\\"token keyword\\">else</span><span class=\\"token punctuation\\">:</span>
            <span class=\\"token keyword\\">print</span> <span class=\\"token string\\">\\"ref: %s\\"</span> <span class=\\"token operator\\">%</span> data<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'ref'</span><span class=\\"token punctuation\\">]</span>
  <span class=\\"token keyword\\">else</span><span class=\\"token punctuation\\">:</span>
            <span class=\\"token keyword\\">print</span> <span class=\\"token string\\">\\"no ref\\"</span>
        <span class=\\"token keyword\\">return</span> <span class=\\"token string\\">\\"\\"</span>

    <span class=\\"token keyword\\">def</span> <span class=\\"token function\\">GET</span><span class=\\"token punctuation\\">(</span>self<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>
        <span class=\\"token keyword\\">raise</span> web<span class=\\"token punctuation\\">.</span>notfound<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>


<span class=\\"token keyword\\">if</span> __name__ <span class=\\"token operator\\">==</span> <span class=\\"token string\\">\\"__main__\\"</span><span class=\\"token punctuation\\">:</span>
    app <span class=\\"token operator\\">=</span> web<span class=\\"token punctuation\\">.</span>application<span class=\\"token punctuation\\">(</span>urls<span class=\\"token punctuation\\">,</span> <span class=\\"token builtin\\">globals</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>
    app<span class=\\"token punctuation\\">.</span>run<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>

application <span class=\\"token operator\\">=</span> web<span class=\\"token punctuation\\">.</span>application<span class=\\"token punctuation\\">(</span>urls<span class=\\"token punctuation\\">,</span> <span class=\\"token builtin\\">globals</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span> <span class=\\"token boolean\\">True</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span>wsgifunc<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span></code></pre></div>
<p>I running this with uWSGI and Nginx in front. To make the setup a little more secure I added deny all and allow to Github's IP-addresses.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"bash\\"><pre class=\\"language-bash\\"><code class=\\"language-bash\\">server <span class=\\"token punctuation\\">{</span>
    listen <span class=\\"token number\\">80</span><span class=\\"token punctuation\\">;</span>
    server_name puppet.example.com<span class=\\"token punctuation\\">;</span>

    access_log /var/log/nginx/puppet_apply.access.log<span class=\\"token punctuation\\">;</span>
    error_log /var/log/nginx/puppet_apply.error.log<span class=\\"token punctuation\\">;</span>

    location / <span class=\\"token punctuation\\">{</span>
        allow <span class=\\"token number\\">207.97</span>.227.253<span class=\\"token punctuation\\">;</span>
        allow <span class=\\"token number\\">50.57</span>.128.197<span class=\\"token punctuation\\">;</span>
        allow <span class=\\"token number\\">108.171</span>.174.178<span class=\\"token punctuation\\">;</span>
        deny all<span class=\\"token punctuation\\">;</span>

        proxy_pass         http://127.0.0.1:9060<span class=\\"token punctuation\\">;</span>
        proxy_redirect     off<span class=\\"token punctuation\\">;</span>

        proxy_set_header   Host             <span class=\\"token variable\\">$host</span><span class=\\"token punctuation\\">;</span>
        proxy_set_header   X-Real-IP        <span class=\\"token variable\\">$remote_addr</span><span class=\\"token punctuation\\">;</span>
        proxy_set_header   X-Forwarded-For  <span class=\\"token variable\\">$proxy_add_x_forwarded_for</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>

    location <span class=\\"token operator\\">=</span> /favicon.ico <span class=\\"token punctuation\\">{</span>
        access_log off<span class=\\"token punctuation\\">;</span>
        log_not_found off<span class=\\"token punctuation\\">;</span>
        <span class=\\"token builtin class-name\\">return</span> <span class=\\"token number\\">204</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>The web.py script is in <code class=\\"language-text\\">/home/web/puppet_apply/puppet_apply.py</code>. The ini-file used by uWSGI is below.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"ini\\"><pre class=\\"language-ini\\"><code class=\\"language-ini\\"><span class=\\"token selector\\">[uwsgi]</span>
<span class=\\"token constant\\">chdir</span> <span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span> /home/web/puppet_apply</span>
<span class=\\"token constant\\">virtualenv</span> <span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span> /home/web/puppet_apply/venv</span>
<span class=\\"token constant\\">pythonpath</span> <span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span> /home/web/puppet_apply</span>
<span class=\\"token constant\\">procname-prefix</span> <span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span> puppet_apply</span>
<span class=\\"token constant\\">daemonize</span><span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span>/var/log/uwsgi/puppet_apply.log</span>
<span class=\\"token constant\\">wsgi-file</span> <span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span> /home/web/puppet_apply/puppet_apply.py</span>
<span class=\\"token constant\\">http-socket</span> <span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span> 0.0.0.0:9060</span>
<span class=\\"token constant\\">master</span> <span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span> True</span>
<span class=\\"token constant\\">processes</span> <span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span> 1</span></code></pre></div>",
        "@": Object {},
      },
      "date": 2013-01-03T00:00:00.000Z,
      "description": "<p>I recently started using github web interface as editor for my puppet configuration. I wanted to be able to push a new configuration without doing it manually, as I do not have a puppet master I wanted to try using Github hooks as in the <a href=\\"/the-github-lamp/\\">Github lamp code</a>. I have the puppet-repo cloned to <code class=\\"language-text\\">/puppet/</code> and the main manifest is in <code class=\\"language-text\\">/puppet/manifests/site.pp</code>. The code below is the web.py script. It checks the payload from Github and will only apply the configuration if changes are pushed to the master branch. A GET request would simply get a 404.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"python\\"><pre class=\\"language-python\\"><code class=\\"language-python\\"><span class=\\"token keyword\\">from</span> fabric<span class=\\"token punctuation\\">.</span>api <span class=\\"token keyword\\">import</span> local<span class=\\"token punctuation\\">,</span> lcd
<span class=\\"token keyword\\">import</span> web<span class=\\"token punctuation\\">,</span> json

urls <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token string\\">'/'</span><span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">'GithubHook'</span><span class=\\"token punctuation\\">,</span>
<span class=\\"token punctuation\\">)</span>

render <span class=\\"token operator\\">=</span> web<span class=\\"token punctuation\\">.</span>template<span class=\\"token punctuation\\">.</span>render<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'.'</span><span class=\\"token punctuation\\">)</span>

<span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">GithubHook</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token keyword\\">def</span> <span class=\\"token function\\">POST</span><span class=\\"token punctuation\\">(</span>self<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>
        data <span class=\\"token operator\\">=</span> json<span class=\\"token punctuation\\">.</span>loads<span class=\\"token punctuation\\">(</span>web<span class=\\"token punctuation\\">.</span><span class=\\"token builtin\\">input</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span>payload<span class=\\"token punctuation\\">)</span>
        <span class=\\"token keyword\\">if</span> <span class=\\"token string\\">'ref'</span> <span class=\\"token keyword\\">in</span> data<span class=\\"token punctuation\\">:</span>
            <span class=\\"token keyword\\">if</span> data<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'ref'</span><span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">==</span> <span class=\\"token string\\">'refs/heads/master'</span><span class=\\"token punctuation\\">:</span>
              <span class=\\"token keyword\\">with</span> lcd<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'/puppet/'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>
                    local<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'git pull origin master'</span><span class=\\"token punctuation\\">)</span>
                    local<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'puppet apply /puppet/manifests/site.pp'</span><span class=\\"token punctuation\\">)</span>
                    <span class=\\"token keyword\\">print</span> <span class=\\"token string\\">\\"applied puppet\\"</span>
        <span class=\\"token keyword\\">else</span><span class=\\"token punctuation\\">:</span>
            <span class=\\"token keyword\\">print</span> <span class=\\"token string\\">\\"ref: %s\\"</span> <span class=\\"token operator\\">%</span> data<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'ref'</span><span class=\\"token punctuation\\">]</span>
  <span class=\\"token keyword\\">else</span><span class=\\"token punctuation\\">:</span>
            <span class=\\"token keyword\\">print</span> <span class=\\"token string\\">\\"no ref\\"</span>
        <span class=\\"token keyword\\">return</span> <span class=\\"token string\\">\\"\\"</span>

    <span class=\\"token keyword\\">def</span> <span class=\\"token function\\">GET</span><span class=\\"token punctuation\\">(</span>self<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>
        <span class=\\"token keyword\\">raise</span> web<span class=\\"token punctuation\\">.</span>notfound<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>


<span class=\\"token keyword\\">if</span> __name__ <span class=\\"token operator\\">==</span> <span class=\\"token string\\">\\"__main__\\"</span><span class=\\"token punctuation\\">:</span>
    app <span class=\\"token operator\\">=</span> web<span class=\\"token punctuation\\">.</span>application<span class=\\"token punctuation\\">(</span>urls<span class=\\"token punctuation\\">,</span> <span class=\\"token builtin\\">globals</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>
    app<span class=\\"token punctuation\\">.</span>run<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>

application <span class=\\"token operator\\">=</span> web<span class=\\"token punctuation\\">.</span>application<span class=\\"token punctuation\\">(</span>urls<span class=\\"token punctuation\\">,</span> <span class=\\"token builtin\\">globals</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span> <span class=\\"token boolean\\">True</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span>wsgifunc<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span></code></pre></div>
<p>I running this with uWSGI and Nginx in front. To make the setup a little more secure I added deny all and allow to Github's IP-addresses.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"bash\\"><pre class=\\"language-bash\\"><code class=\\"language-bash\\">server <span class=\\"token punctuation\\">{</span>
    listen <span class=\\"token number\\">80</span><span class=\\"token punctuation\\">;</span>
    server_name puppet.example.com<span class=\\"token punctuation\\">;</span>

    access_log /var/log/nginx/puppet_apply.access.log<span class=\\"token punctuation\\">;</span>
    error_log /var/log/nginx/puppet_apply.error.log<span class=\\"token punctuation\\">;</span>

    location / <span class=\\"token punctuation\\">{</span>
        allow <span class=\\"token number\\">207.97</span>.227.253<span class=\\"token punctuation\\">;</span>
        allow <span class=\\"token number\\">50.57</span>.128.197<span class=\\"token punctuation\\">;</span>
        allow <span class=\\"token number\\">108.171</span>.174.178<span class=\\"token punctuation\\">;</span>
        deny all<span class=\\"token punctuation\\">;</span>

        proxy_pass         http://127.0.0.1:9060<span class=\\"token punctuation\\">;</span>
        proxy_redirect     off<span class=\\"token punctuation\\">;</span>

        proxy_set_header   Host             <span class=\\"token variable\\">$host</span><span class=\\"token punctuation\\">;</span>
        proxy_set_header   X-Real-IP        <span class=\\"token variable\\">$remote_addr</span><span class=\\"token punctuation\\">;</span>
        proxy_set_header   X-Forwarded-For  <span class=\\"token variable\\">$proxy_add_x_forwarded_for</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>

    location <span class=\\"token operator\\">=</span> /favicon.ico <span class=\\"token punctuation\\">{</span>
        access_log off<span class=\\"token punctuation\\">;</span>
        log_not_found off<span class=\\"token punctuation\\">;</span>
        <span class=\\"token builtin class-name\\">return</span> <span class=\\"token number\\">204</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>The web.py script is in <code class=\\"language-text\\">/home/web/puppet_apply/puppet_apply.py</code>. The ini-file used by uWSGI is below.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"ini\\"><pre class=\\"language-ini\\"><code class=\\"language-ini\\"><span class=\\"token selector\\">[uwsgi]</span>
<span class=\\"token constant\\">chdir</span> <span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span> /home/web/puppet_apply</span>
<span class=\\"token constant\\">virtualenv</span> <span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span> /home/web/puppet_apply/venv</span>
<span class=\\"token constant\\">pythonpath</span> <span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span> /home/web/puppet_apply</span>
<span class=\\"token constant\\">procname-prefix</span> <span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span> puppet_apply</span>
<span class=\\"token constant\\">daemonize</span><span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span>/var/log/uwsgi/puppet_apply.log</span>
<span class=\\"token constant\\">wsgi-file</span> <span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span> /home/web/puppet_apply/puppet_apply.py</span>
<span class=\\"token constant\\">http-socket</span> <span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span> 0.0.0.0:9060</span>
<span class=\\"token constant\\">master</span> <span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span> True</span>
<span class=\\"token constant\\">processes</span> <span class=\\"token attr-value\\"><span class=\\"token punctuation\\">=</span> 1</span></code></pre></div>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/apply-puppet-configuration-automatically",
      "image": Object {},
      "link": "https://rolflekang.com/apply-puppet-configuration-automatically",
      "origlink": null,
      "pubDate": "2013-01-03T00:00:00.000Z",
      "pubdate": 2013-01-03T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "puppet",
          "@": Object {},
        },
        Object {
          "#": "web.py",
          "@": Object {},
        },
        Object {
          "#": "nginx",
          "@": Object {},
        },
        Object {
          "#": "uwsgi",
          "@": Object {},
        },
        Object {
          "#": "github",
          "@": Object {},
        },
        Object {
          "#": "github-hooks",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "I recently started using github web interface as editor for my puppet configuration. I wanted to be able to push a new configuration without…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/apply-puppet-configuration-automatically",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/apply-puppet-configuration-automatically",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Thu, 03 Jan 2013 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Apply puppet automatically",
        "@": Object {},
      },
      "source": Object {},
      "summary": "I recently started using github web interface as editor for my puppet configuration. I wanted to be able to push a new configuration without…",
      "title": "Apply puppet automatically",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "wikipedia",
        "css",
        "readability",
        "stylebot",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>I have been reading a lot of wikipedia articles lately so I made a stylebot stylesheet to make it a little bit more comfortable to read. If you have some enhancement tips please comment on <a href=\\"https://gist.github.com/4190383\\">the gist</a>.</p>
<p><img src=\\"/images/wikipedia.png\\" alt=\\"Wikipedia\\"></p>
<div class=\\"gatsby-highlight\\" data-language=\\"css\\"><pre class=\\"language-css\\"><code class=\\"language-css\\"><span class=\\"token selector\\">#content, #mw-head-base</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">margin-left</span><span class=\\"token punctuation\\">:</span> 0<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token selector\\">#left-navigation,
#right-navigation</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">margin-top</span><span class=\\"token punctuation\\">:</span> 0<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">top</span><span class=\\"token punctuation\\">:</span> 0<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token selector\\">#mw-content-text</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">font-family</span><span class=\\"token punctuation\\">:</span> Georgia<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">font-size</span><span class=\\"token punctuation\\">:</span> 18px<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">line-height</span><span class=\\"token punctuation\\">:</span> 1.8em<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token selector\\">#mw-content-text,
#firstHeading,
#siteSub, 
contentSub,
#mw-articlefeedback</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">display</span><span class=\\"token punctuation\\">:</span> block<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">margin</span><span class=\\"token punctuation\\">:</span> 0 auto<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">max-width</span><span class=\\"token punctuation\\">:</span> 800px<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">width</span><span class=\\"token punctuation\\">:</span> 100%<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token selector\\">#mw-page-base</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">height</span><span class=\\"token punctuation\\">:</span> 2.5em<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token selector\\">#mw-panel</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">overflow</span><span class=\\"token punctuation\\">:</span> hidden<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">width</span><span class=\\"token punctuation\\">:</span> 10px<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token selector\\">#mw-panel:hover</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">width</span><span class=\\"token punctuation\\">:</span> 120px<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token selector\\">#toc</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">font-family</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">\\"Helvetica Neue\\"</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">font-size</span><span class=\\"token punctuation\\">:</span> 12px<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">opacity</span><span class=\\"token punctuation\\">:</span> 0.3<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">position</span><span class=\\"token punctuation\\">:</span> fixed<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">right</span><span class=\\"token punctuation\\">:</span> 1em<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">top</span><span class=\\"token punctuation\\">:</span> 4em<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token selector\\">.metadata, 
.dablink, 
.infobox, 
.vertical-navbox, 
.citation, 
.references, 
.external</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">font-family</span><span class=\\"token punctuation\\">:</span> Helvetica<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">font-size</span><span class=\\"token punctuation\\">:</span> 11px<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">line-height</span><span class=\\"token punctuation\\">:</span> 14px<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token selector\\">pre</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">font-family</span><span class=\\"token punctuation\\">:</span> monaco<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">font-size</span><span class=\\"token punctuation\\">:</span> 13px<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">line-height</span><span class=\\"token punctuation\\">:</span> 16px<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>",
        "@": Object {},
      },
      "date": 2012-12-02T00:00:00.000Z,
      "description": "<p>I have been reading a lot of wikipedia articles lately so I made a stylebot stylesheet to make it a little bit more comfortable to read. If you have some enhancement tips please comment on <a href=\\"https://gist.github.com/4190383\\">the gist</a>.</p>
<p><img src=\\"/images/wikipedia.png\\" alt=\\"Wikipedia\\"></p>
<div class=\\"gatsby-highlight\\" data-language=\\"css\\"><pre class=\\"language-css\\"><code class=\\"language-css\\"><span class=\\"token selector\\">#content, #mw-head-base</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">margin-left</span><span class=\\"token punctuation\\">:</span> 0<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token selector\\">#left-navigation,
#right-navigation</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">margin-top</span><span class=\\"token punctuation\\">:</span> 0<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">top</span><span class=\\"token punctuation\\">:</span> 0<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token selector\\">#mw-content-text</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">font-family</span><span class=\\"token punctuation\\">:</span> Georgia<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">font-size</span><span class=\\"token punctuation\\">:</span> 18px<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">line-height</span><span class=\\"token punctuation\\">:</span> 1.8em<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token selector\\">#mw-content-text,
#firstHeading,
#siteSub, 
contentSub,
#mw-articlefeedback</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">display</span><span class=\\"token punctuation\\">:</span> block<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">margin</span><span class=\\"token punctuation\\">:</span> 0 auto<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">max-width</span><span class=\\"token punctuation\\">:</span> 800px<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">width</span><span class=\\"token punctuation\\">:</span> 100%<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token selector\\">#mw-page-base</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">height</span><span class=\\"token punctuation\\">:</span> 2.5em<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token selector\\">#mw-panel</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">overflow</span><span class=\\"token punctuation\\">:</span> hidden<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">width</span><span class=\\"token punctuation\\">:</span> 10px<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token selector\\">#mw-panel:hover</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">width</span><span class=\\"token punctuation\\">:</span> 120px<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token selector\\">#toc</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">font-family</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">\\"Helvetica Neue\\"</span><span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">font-size</span><span class=\\"token punctuation\\">:</span> 12px<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">opacity</span><span class=\\"token punctuation\\">:</span> 0.3<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">position</span><span class=\\"token punctuation\\">:</span> fixed<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">right</span><span class=\\"token punctuation\\">:</span> 1em<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">top</span><span class=\\"token punctuation\\">:</span> 4em<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token selector\\">.metadata, 
.dablink, 
.infobox, 
.vertical-navbox, 
.citation, 
.references, 
.external</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">font-family</span><span class=\\"token punctuation\\">:</span> Helvetica<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">font-size</span><span class=\\"token punctuation\\">:</span> 11px<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">line-height</span><span class=\\"token punctuation\\">:</span> 14px<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token selector\\">pre</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token property\\">font-family</span><span class=\\"token punctuation\\">:</span> monaco<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">font-size</span><span class=\\"token punctuation\\">:</span> 13px<span class=\\"token punctuation\\">;</span>
    <span class=\\"token property\\">line-height</span><span class=\\"token punctuation\\">:</span> 16px<span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/readable-wikipedia",
      "image": Object {},
      "link": "https://rolflekang.com/readable-wikipedia",
      "origlink": null,
      "pubDate": "2012-12-02T00:00:00.000Z",
      "pubdate": 2012-12-02T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "wikipedia",
          "@": Object {},
        },
        Object {
          "#": "css",
          "@": Object {},
        },
        Object {
          "#": "readability",
          "@": Object {},
        },
        Object {
          "#": "stylebot",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "I have been reading a lot of wikipedia articles lately so I made a stylebot stylesheet to make it a little bit more comfortable to read. If…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/readable-wikipedia",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/readable-wikipedia",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Sun, 02 Dec 2012 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "Readable Wikipedia",
        "@": Object {},
      },
      "source": Object {},
      "summary": "I have been reading a lot of wikipedia articles lately so I made a stylebot stylesheet to make it a little bit more comfortable to read. If…",
      "title": "Readable Wikipedia",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "django",
        "no-password",
        "email-authentication",
        "authentication",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<p>Some weeks ago I read a <a href=\\"http://notes.xoxco.com/post/27999787765/is-it-time-for-password-less-login\\">blog post</a> by Ben Brown about password less login. I wanted to learn more about custom authentication in Django and I thought that implementing password less login would be good way to learn.</p>
<h4>Build status</h4>
<p><a href=\\"https://travis-ci.org/relekang/django-nopassword\\"><img src=\\"https://travis-ci.org/relekang/django-nopassword.png\\" alt=\\"Build Status\\"></a></p>
<h2>Installation</h2>
<p>Run this command to install django-nopassword</p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\">pip install django-nopassword</code></pre></div>
<h2>Usage</h2>
<p>Add the app to installed apps</p>
<div class=\\"gatsby-highlight\\" data-language=\\"python\\"><pre class=\\"language-python\\"><code class=\\"language-python\\">INSTALLED_APPS <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">.</span>
    <span class=\\"token string\\">'nopassword'</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">.</span>
<span class=\\"token punctuation\\">)</span></code></pre></div>
<p>Set the authentication backend to <em>EmailBackend</em></p>
<div class=\\"gatsby-highlight\\" data-language=\\"python\\"><pre class=\\"language-python\\"><code class=\\"language-python\\">AUTHENTICATION_BACKENDS <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span>
     <span class=\\"token string\\">'nopassword.backends.EmailBackend'</span><span class=\\"token punctuation\\">,</span> 
<span class=\\"token punctuation\\">)</span></code></pre></div>
<p>Add urls to your <em>urls.py</em></p>
<div class=\\"gatsby-highlight\\" data-language=\\"python\\"><pre class=\\"language-python\\"><code class=\\"language-python\\">urlpatterns <span class=\\"token operator\\">=</span> patterns<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">''</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">.</span>
    url<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">r'^accounts/'</span><span class=\\"token punctuation\\">,</span> include<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'nopassword.urls'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">.</span>
<span class=\\"token punctuation\\">)</span></code></pre></div>",
        "@": Object {},
      },
      "date": 2012-09-28T00:00:00.000Z,
      "description": "<p>Some weeks ago I read a <a href=\\"http://notes.xoxco.com/post/27999787765/is-it-time-for-password-less-login\\">blog post</a> by Ben Brown about password less login. I wanted to learn more about custom authentication in Django and I thought that implementing password less login would be good way to learn.</p>
<h4>Build status</h4>
<p><a href=\\"https://travis-ci.org/relekang/django-nopassword\\"><img src=\\"https://travis-ci.org/relekang/django-nopassword.png\\" alt=\\"Build Status\\"></a></p>
<h2>Installation</h2>
<p>Run this command to install django-nopassword</p>
<div class=\\"gatsby-highlight\\" data-language=\\"text\\"><pre class=\\"language-text\\"><code class=\\"language-text\\">pip install django-nopassword</code></pre></div>
<h2>Usage</h2>
<p>Add the app to installed apps</p>
<div class=\\"gatsby-highlight\\" data-language=\\"python\\"><pre class=\\"language-python\\"><code class=\\"language-python\\">INSTALLED_APPS <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span>
    <span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">.</span>
    <span class=\\"token string\\">'nopassword'</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">.</span>
<span class=\\"token punctuation\\">)</span></code></pre></div>
<p>Set the authentication backend to <em>EmailBackend</em></p>
<div class=\\"gatsby-highlight\\" data-language=\\"python\\"><pre class=\\"language-python\\"><code class=\\"language-python\\">AUTHENTICATION_BACKENDS <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span>
     <span class=\\"token string\\">'nopassword.backends.EmailBackend'</span><span class=\\"token punctuation\\">,</span> 
<span class=\\"token punctuation\\">)</span></code></pre></div>
<p>Add urls to your <em>urls.py</em></p>
<div class=\\"gatsby-highlight\\" data-language=\\"python\\"><pre class=\\"language-python\\"><code class=\\"language-python\\">urlpatterns <span class=\\"token operator\\">=</span> patterns<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">''</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">.</span>
    url<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">r'^accounts/'</span><span class=\\"token punctuation\\">,</span> include<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'nopassword.urls'</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>
    <span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">.</span>
<span class=\\"token punctuation\\">)</span></code></pre></div>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/django-nopassword",
      "image": Object {},
      "link": "https://rolflekang.com/django-nopassword",
      "origlink": null,
      "pubDate": "2012-09-28T00:00:00.000Z",
      "pubdate": 2012-09-28T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "django",
          "@": Object {},
        },
        Object {
          "#": "no-password",
          "@": Object {},
        },
        Object {
          "#": "email-authentication",
          "@": Object {},
        },
        Object {
          "#": "authentication",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "Some weeks ago I read a blog post by Ben Brown about password less login. I wanted to learn more about custom authentication in Django and I…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/django-nopassword",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/django-nopassword",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Fri, 28 Sep 2012 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "django-nopassword",
        "@": Object {},
      },
      "source": Object {},
      "summary": "Some weeks ago I read a blog post by Ben Brown about password less login. I wanted to learn more about custom authentication in Django and I…",
      "title": "django-nopassword",
    },
    Object {
      "author": undefined,
      "categories": Array [
        "arduino",
        "github",
        "git",
        "web.py",
      ],
      "comments": null,
      "content:encoded": Object {
        "#": "<blockquote>
<p>Update: This project is now on github: <a href=\\"http://github.com/relekang/lumen\\">relekang/lumen</a></p>
</blockquote>
<p>My arduino has been collecting dust in a drawer for a while. This weekend I figured why not hook it up with github post-receive hooks and do something cool. The hooks can be set up in the <em>Service Hooks</em> section of a repository's admin page on github. Just add a url to where the web.py site is running and github will send that url a POST request everytime someone pushes a commit to the repository. You can fin more info about post-receive hooks at <a href=\\"https://help.github.com/articles/post-receive-hooks\\">help.github.com</a>.</p>
<p>About two years ago I rebuilt a IKEA children-lamp to be controllable with high/low digital signals.</p>
<p><span
      class=\\"gatsby-resp-image-wrapper\\"
      style=\\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\\"
    >
      <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"/static/45313a5d337ccdcd2d96ac38c120353b/b4294/github-lamp.jpg\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >
    <span
    class=\\"gatsby-resp-image-background-image\\"
    style=\\"padding-bottom: 133.51063829787233%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQFAwb/xAAWAQEBAQAAAAAAAAAAAAAAAAADAgT/2gAMAwEAAhADEAAAAUdp/SGUkVI057tMKUophp//xAAeEAABBAMAAwAAAAAAAAAAAAADAAECEgQTFBAhM//aAAgBAQABBQLoM6tlVF6gKdSdUKzI7yGNyLRJaZrH+T+P/8QAGxEAAgEFAAAAAAAAAAAAAAAAAAEDEBESE0H/2gAIAQMBAT8B1xrhkqWP/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAECEgP/2gAIAQIBAT8BrrSMNjNM/8QAHBAAAgICAwAAAAAAAAAAAAAAAAEhMRARQXHh/9oACAEBAAY/AvDeo6JE3RcDahEHBQs//8QAHRABAAICAgMAAAAAAAAAAAAAAQARIUEQYVGBkf/aAAgBAQABPyExBI3G24FYMymthzA7JjKyOCXygrzEdv3Ot9hDuXl//9oADAMBAAIAAwAAABB8HEL/xAAYEQEBAQEBAAAAAAAAAAAAAAABABEhkf/aAAgBAwEBPxBYceQBkGtm/8QAFxEBAQEBAAAAAAAAAAAAAAAAAREAEP/aAAgBAgEBPxBuZRXo/8QAHhABAAICAgMBAAAAAAAAAAAAAQARITFRYRBxgUH/2gAIAQEAAT8QftX0jdpFwkWrLKn2EGAoDNTRHLht6xuIZYNei9Rwhrm2XiZ4R8RH9vRjAFKHvPl//9k='); background-size: cover; display: block;\\"
  ></span>
  <img
        class=\\"gatsby-resp-image-image\\"
        alt=\\"The IKEA lamp\\"
        title=\\"The IKEA lamp\\"
        src=\\"/static/45313a5d337ccdcd2d96ac38c120353b/b4294/github-lamp.jpg\\"
        srcset=\\"/static/45313a5d337ccdcd2d96ac38c120353b/bc01b/github-lamp.jpg 188w,
/static/45313a5d337ccdcd2d96ac38c120353b/bf173/github-lamp.jpg 375w,
/static/45313a5d337ccdcd2d96ac38c120353b/b4294/github-lamp.jpg 600w\\"
        sizes=\\"(max-width: 600px) 100vw, 600px\\"
        style=\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\"
        loading=\\"lazy\\"
      />
  </a>
    </span></p>
<p>I wrote this based on the serial example for the arduino. It turns the lamp on and off according to the commands <em>on</em>, <em>off</em> and <em>blink</em>.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"c\\"><pre class=\\"language-c\\"><code class=\\"language-c\\">String inputString <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"\\"</span><span class=\\"token punctuation\\">;</span>
boolean stringComplete <span class=\\"token operator\\">=</span> false<span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">int</span> led <span class=\\"token operator\\">=</span> <span class=\\"token number\\">5</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token keyword\\">void</span> <span class=\\"token function\\">setup</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
      Serial<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">begin</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">9600</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
      inputString<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">reserve</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">200</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
      <span class=\\"token function\\">pinMode</span><span class=\\"token punctuation\\">(</span>led<span class=\\"token punctuation\\">,</span> OUTPUT<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">void</span> <span class=\\"token function\\">loop</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>stringComplete<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
        <span class=\\"token keyword\\">if</span><span class=\\"token punctuation\\">(</span>inputString <span class=\\"token operator\\">==</span> <span class=\\"token string\\">\\"on\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>
            <span class=\\"token function\\">digitalWrite</span><span class=\\"token punctuation\\">(</span>led<span class=\\"token punctuation\\">,</span> HIGH<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
        <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">else</span> <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>inputString <span class=\\"token operator\\">==</span> <span class=\\"token string\\">\\"off\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>
            <span class=\\"token function\\">digitalWrite</span><span class=\\"token punctuation\\">(</span>led<span class=\\"token punctuation\\">,</span> LOW<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
        <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">else</span> <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>inputString <span class=\\"token operator\\">==</span> <span class=\\"token string\\">\\"blink\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>
            <span class=\\"token function\\">digitalWrite</span><span class=\\"token punctuation\\">(</span>led<span class=\\"token punctuation\\">,</span> HIGH<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
            <span class=\\"token function\\">delay</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
            <span class=\\"token function\\">digitalWrite</span><span class=\\"token punctuation\\">(</span>led<span class=\\"token punctuation\\">,</span> LOW<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
        <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">else</span> <span class=\\"token punctuation\\">{</span>
            Serial<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">println</span><span class=\\"token punctuation\\">(</span>inputString<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
        <span class=\\"token punctuation\\">}</span>
        <span class=\\"token comment\\">// clear the string:</span>
        inputString <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"\\"</span><span class=\\"token punctuation\\">;</span>
        stringComplete <span class=\\"token operator\\">=</span> false<span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">void</span> <span class=\\"token function\\">serialEvent</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">while</span> <span class=\\"token punctuation\\">(</span>Serial<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">available</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
        <span class=\\"token keyword\\">char</span> inChar <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">char</span><span class=\\"token punctuation\\">)</span>Serial<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">read</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
        <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>inChar <span class=\\"token operator\\">==</span> <span class=\\"token string\\">'\\\\n'</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
            stringComplete <span class=\\"token operator\\">=</span> true<span class=\\"token punctuation\\">;</span>
        <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">else</span> <span class=\\"token punctuation\\">{</span>
            inputString <span class=\\"token operator\\">+=</span> inChar<span class=\\"token punctuation\\">;</span>
        <span class=\\"token punctuation\\">}</span>
    <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>The arduino is connected to my mac mini. I have some python code running on the mac to write stuff onto the serial connection between the mac and the arduino. I am using <a href=\\"http://webpy.org/\\">web.py</a> and <a href=\\"http://gunicorn.org/\\">gunicorn</a> to handle the web requests. The web.py-file <em>lighthouse_keeper.py</em> looks like this:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"python\\"><pre class=\\"language-python\\"><code class=\\"language-python\\">SERIALPORT <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"/dev/tty.usbmodemfd121\\"</span>

<span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">GithubHook</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token keyword\\">def</span> <span class=\\"token function\\">POST</span><span class=\\"token punctuation\\">(</span>self<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>
        send_serial_data<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"blink\\\\n\\"</span><span class=\\"token punctuation\\">)</span>
        data <span class=\\"token operator\\">=</span> json<span class=\\"token punctuation\\">.</span>loads<span class=\\"token punctuation\\">(</span>web<span class=\\"token punctuation\\">.</span><span class=\\"token builtin\\">input</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span>payload<span class=\\"token punctuation\\">)</span>
        <span class=\\"token keyword\\">print</span> <span class=\\"token string\\">\\"%s pushed to %s - %s\\"</span> <span class=\\"token operator\\">%</span> <span class=\\"token punctuation\\">(</span>
            data<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'pusher'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'name'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span>
            data<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'repository'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'name'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span>
            data<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'repository'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'homepage'</span><span class=\\"token punctuation\\">]</span>
        <span class=\\"token punctuation\\">)</span>
        <span class=\\"token keyword\\">return</span> <span class=\\"token string\\">\\"\\"</span>

    <span class=\\"token keyword\\">def</span> <span class=\\"token function\\">GET</span><span class=\\"token punctuation\\">(</span>self<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>
        <span class=\\"token keyword\\">return</span> <span class=\\"token string\\">\\"Something is wrong\\"</span>

<span class=\\"token keyword\\">def</span> <span class=\\"token function\\">send_serial_data</span><span class=\\"token punctuation\\">(</span>data<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token comment\\">#open serial port</span>
    <span class=\\"token keyword\\">try</span><span class=\\"token punctuation\\">:</span>
        ser <span class=\\"token operator\\">=</span> serial<span class=\\"token punctuation\\">.</span>Serial<span class=\\"token punctuation\\">(</span>SERIALPORT<span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">9600</span><span class=\\"token punctuation\\">)</span>
    <span class=\\"token keyword\\">except</span> serial<span class=\\"token punctuation\\">.</span>SerialException<span class=\\"token punctuation\\">:</span>
        <span class=\\"token keyword\\">return</span>

    ser<span class=\\"token punctuation\\">.</span>write<span class=\\"token punctuation\\">(</span>data<span class=\\"token punctuation\\">)</span>

    <span class=\\"token comment\\">#close serial port</span>
    ser<span class=\\"token punctuation\\">.</span>close<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>

<span class=\\"token keyword\\">if</span> __name__ <span class=\\"token operator\\">==</span> <span class=\\"token string\\">\\"__main__\\"</span><span class=\\"token punctuation\\">:</span>
    app <span class=\\"token operator\\">=</span> web<span class=\\"token punctuation\\">.</span>application<span class=\\"token punctuation\\">(</span>urls<span class=\\"token punctuation\\">,</span> <span class=\\"token builtin\\">globals</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>
    app<span class=\\"token punctuation\\">.</span>run<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>

application <span class=\\"token operator\\">=</span> web<span class=\\"token punctuation\\">.</span>application<span class=\\"token punctuation\\">(</span>urls<span class=\\"token punctuation\\">,</span> <span class=\\"token builtin\\">globals</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span> <span class=\\"token boolean\\">True</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span>wsgifunc<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span></code></pre></div>
<p>To run gunicorn I just run the command:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"bash\\"><pre class=\\"language-bash\\"><code class=\\"language-bash\\">gunicorn lighthouse_keeper</code></pre></div>",
        "@": Object {},
      },
      "date": 2012-09-16T00:00:00.000Z,
      "description": "<blockquote>
<p>Update: This project is now on github: <a href=\\"http://github.com/relekang/lumen\\">relekang/lumen</a></p>
</blockquote>
<p>My arduino has been collecting dust in a drawer for a while. This weekend I figured why not hook it up with github post-receive hooks and do something cool. The hooks can be set up in the <em>Service Hooks</em> section of a repository's admin page on github. Just add a url to where the web.py site is running and github will send that url a POST request everytime someone pushes a commit to the repository. You can fin more info about post-receive hooks at <a href=\\"https://help.github.com/articles/post-receive-hooks\\">help.github.com</a>.</p>
<p>About two years ago I rebuilt a IKEA children-lamp to be controllable with high/low digital signals.</p>
<p><span
      class=\\"gatsby-resp-image-wrapper\\"
      style=\\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\\"
    >
      <a
    class=\\"gatsby-resp-image-link\\"
    href=\\"/static/45313a5d337ccdcd2d96ac38c120353b/b4294/github-lamp.jpg\\"
    style=\\"display: block\\"
    target=\\"_blank\\"
    rel=\\"noopener\\"
  >
    <span
    class=\\"gatsby-resp-image-background-image\\"
    style=\\"padding-bottom: 133.51063829787233%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQFAwb/xAAWAQEBAQAAAAAAAAAAAAAAAAADAgT/2gAMAwEAAhADEAAAAUdp/SGUkVI057tMKUophp//xAAeEAABBAMAAwAAAAAAAAAAAAADAAECEgQTFBAhM//aAAgBAQABBQLoM6tlVF6gKdSdUKzI7yGNyLRJaZrH+T+P/8QAGxEAAgEFAAAAAAAAAAAAAAAAAAEDEBESE0H/2gAIAQMBAT8B1xrhkqWP/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAECEgP/2gAIAQIBAT8BrrSMNjNM/8QAHBAAAgICAwAAAAAAAAAAAAAAAAEhMRARQXHh/9oACAEBAAY/AvDeo6JE3RcDahEHBQs//8QAHRABAAICAgMAAAAAAAAAAAAAAQARIUEQYVGBkf/aAAgBAQABPyExBI3G24FYMymthzA7JjKyOCXygrzEdv3Ot9hDuXl//9oADAMBAAIAAwAAABB8HEL/xAAYEQEBAQEBAAAAAAAAAAAAAAABABEhkf/aAAgBAwEBPxBYceQBkGtm/8QAFxEBAQEBAAAAAAAAAAAAAAAAAREAEP/aAAgBAgEBPxBuZRXo/8QAHhABAAICAgMBAAAAAAAAAAAAAQARITFRYRBxgUH/2gAIAQEAAT8QftX0jdpFwkWrLKn2EGAoDNTRHLht6xuIZYNei9Rwhrm2XiZ4R8RH9vRjAFKHvPl//9k='); background-size: cover; display: block;\\"
  ></span>
  <img
        class=\\"gatsby-resp-image-image\\"
        alt=\\"The IKEA lamp\\"
        title=\\"The IKEA lamp\\"
        src=\\"/static/45313a5d337ccdcd2d96ac38c120353b/b4294/github-lamp.jpg\\"
        srcset=\\"/static/45313a5d337ccdcd2d96ac38c120353b/bc01b/github-lamp.jpg 188w,
/static/45313a5d337ccdcd2d96ac38c120353b/bf173/github-lamp.jpg 375w,
/static/45313a5d337ccdcd2d96ac38c120353b/b4294/github-lamp.jpg 600w\\"
        sizes=\\"(max-width: 600px) 100vw, 600px\\"
        style=\\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\\"
        loading=\\"lazy\\"
      />
  </a>
    </span></p>
<p>I wrote this based on the serial example for the arduino. It turns the lamp on and off according to the commands <em>on</em>, <em>off</em> and <em>blink</em>.</p>
<div class=\\"gatsby-highlight\\" data-language=\\"c\\"><pre class=\\"language-c\\"><code class=\\"language-c\\">String inputString <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"\\"</span><span class=\\"token punctuation\\">;</span>
boolean stringComplete <span class=\\"token operator\\">=</span> false<span class=\\"token punctuation\\">;</span>
<span class=\\"token keyword\\">int</span> led <span class=\\"token operator\\">=</span> <span class=\\"token number\\">5</span><span class=\\"token punctuation\\">;</span>

<span class=\\"token keyword\\">void</span> <span class=\\"token function\\">setup</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
      Serial<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">begin</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">9600</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
      inputString<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">reserve</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">200</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
      <span class=\\"token function\\">pinMode</span><span class=\\"token punctuation\\">(</span>led<span class=\\"token punctuation\\">,</span> OUTPUT<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">void</span> <span class=\\"token function\\">loop</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>stringComplete<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
        <span class=\\"token keyword\\">if</span><span class=\\"token punctuation\\">(</span>inputString <span class=\\"token operator\\">==</span> <span class=\\"token string\\">\\"on\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>
            <span class=\\"token function\\">digitalWrite</span><span class=\\"token punctuation\\">(</span>led<span class=\\"token punctuation\\">,</span> HIGH<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
        <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">else</span> <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>inputString <span class=\\"token operator\\">==</span> <span class=\\"token string\\">\\"off\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>
            <span class=\\"token function\\">digitalWrite</span><span class=\\"token punctuation\\">(</span>led<span class=\\"token punctuation\\">,</span> LOW<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
        <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">else</span> <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>inputString <span class=\\"token operator\\">==</span> <span class=\\"token string\\">\\"blink\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>
            <span class=\\"token function\\">digitalWrite</span><span class=\\"token punctuation\\">(</span>led<span class=\\"token punctuation\\">,</span> HIGH<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
            <span class=\\"token function\\">delay</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
            <span class=\\"token function\\">digitalWrite</span><span class=\\"token punctuation\\">(</span>led<span class=\\"token punctuation\\">,</span> LOW<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
        <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">else</span> <span class=\\"token punctuation\\">{</span>
            Serial<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">println</span><span class=\\"token punctuation\\">(</span>inputString<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
        <span class=\\"token punctuation\\">}</span>
        <span class=\\"token comment\\">// clear the string:</span>
        inputString <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"\\"</span><span class=\\"token punctuation\\">;</span>
        stringComplete <span class=\\"token operator\\">=</span> false<span class=\\"token punctuation\\">;</span>
    <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span>

<span class=\\"token keyword\\">void</span> <span class=\\"token function\\">serialEvent</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
    <span class=\\"token keyword\\">while</span> <span class=\\"token punctuation\\">(</span>Serial<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">available</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
        <span class=\\"token keyword\\">char</span> inChar <span class=\\"token operator\\">=</span> <span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">char</span><span class=\\"token punctuation\\">)</span>Serial<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">read</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>
        <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>inChar <span class=\\"token operator\\">==</span> <span class=\\"token string\\">'\\\\n'</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>
            stringComplete <span class=\\"token operator\\">=</span> true<span class=\\"token punctuation\\">;</span>
        <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">else</span> <span class=\\"token punctuation\\">{</span>
            inputString <span class=\\"token operator\\">+=</span> inChar<span class=\\"token punctuation\\">;</span>
        <span class=\\"token punctuation\\">}</span>
    <span class=\\"token punctuation\\">}</span>
<span class=\\"token punctuation\\">}</span></code></pre></div>
<p>The arduino is connected to my mac mini. I have some python code running on the mac to write stuff onto the serial connection between the mac and the arduino. I am using <a href=\\"http://webpy.org/\\">web.py</a> and <a href=\\"http://gunicorn.org/\\">gunicorn</a> to handle the web requests. The web.py-file <em>lighthouse_keeper.py</em> looks like this:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"python\\"><pre class=\\"language-python\\"><code class=\\"language-python\\">SERIALPORT <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"/dev/tty.usbmodemfd121\\"</span>

<span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">GithubHook</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token keyword\\">def</span> <span class=\\"token function\\">POST</span><span class=\\"token punctuation\\">(</span>self<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>
        send_serial_data<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"blink\\\\n\\"</span><span class=\\"token punctuation\\">)</span>
        data <span class=\\"token operator\\">=</span> json<span class=\\"token punctuation\\">.</span>loads<span class=\\"token punctuation\\">(</span>web<span class=\\"token punctuation\\">.</span><span class=\\"token builtin\\">input</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span>payload<span class=\\"token punctuation\\">)</span>
        <span class=\\"token keyword\\">print</span> <span class=\\"token string\\">\\"%s pushed to %s - %s\\"</span> <span class=\\"token operator\\">%</span> <span class=\\"token punctuation\\">(</span>
            data<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'pusher'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'name'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span>
            data<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'repository'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'name'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">,</span>
            data<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'repository'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'homepage'</span><span class=\\"token punctuation\\">]</span>
        <span class=\\"token punctuation\\">)</span>
        <span class=\\"token keyword\\">return</span> <span class=\\"token string\\">\\"\\"</span>

    <span class=\\"token keyword\\">def</span> <span class=\\"token function\\">GET</span><span class=\\"token punctuation\\">(</span>self<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>
        <span class=\\"token keyword\\">return</span> <span class=\\"token string\\">\\"Something is wrong\\"</span>

<span class=\\"token keyword\\">def</span> <span class=\\"token function\\">send_serial_data</span><span class=\\"token punctuation\\">(</span>data<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span>
    <span class=\\"token comment\\">#open serial port</span>
    <span class=\\"token keyword\\">try</span><span class=\\"token punctuation\\">:</span>
        ser <span class=\\"token operator\\">=</span> serial<span class=\\"token punctuation\\">.</span>Serial<span class=\\"token punctuation\\">(</span>SERIALPORT<span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">9600</span><span class=\\"token punctuation\\">)</span>
    <span class=\\"token keyword\\">except</span> serial<span class=\\"token punctuation\\">.</span>SerialException<span class=\\"token punctuation\\">:</span>
        <span class=\\"token keyword\\">return</span>

    ser<span class=\\"token punctuation\\">.</span>write<span class=\\"token punctuation\\">(</span>data<span class=\\"token punctuation\\">)</span>

    <span class=\\"token comment\\">#close serial port</span>
    ser<span class=\\"token punctuation\\">.</span>close<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>

<span class=\\"token keyword\\">if</span> __name__ <span class=\\"token operator\\">==</span> <span class=\\"token string\\">\\"__main__\\"</span><span class=\\"token punctuation\\">:</span>
    app <span class=\\"token operator\\">=</span> web<span class=\\"token punctuation\\">.</span>application<span class=\\"token punctuation\\">(</span>urls<span class=\\"token punctuation\\">,</span> <span class=\\"token builtin\\">globals</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>
    app<span class=\\"token punctuation\\">.</span>run<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>

application <span class=\\"token operator\\">=</span> web<span class=\\"token punctuation\\">.</span>application<span class=\\"token punctuation\\">(</span>urls<span class=\\"token punctuation\\">,</span> <span class=\\"token builtin\\">globals</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span> <span class=\\"token boolean\\">True</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span>wsgifunc<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span></code></pre></div>
<p>To run gunicorn I just run the command:</p>
<div class=\\"gatsby-highlight\\" data-language=\\"bash\\"><pre class=\\"language-bash\\"><code class=\\"language-bash\\">gunicorn lighthouse_keeper</code></pre></div>",
      "enclosures": Array [],
      "guid": "https://rolflekang.com/the-github-lamp",
      "image": Object {},
      "link": "https://rolflekang.com/the-github-lamp",
      "origlink": null,
      "pubDate": "2012-09-16T00:00:00.000Z",
      "pubdate": 2012-09-16T00:00:00.000Z,
      "rss:@": Object {},
      "rss:category": Array [
        Object {
          "#": "arduino",
          "@": Object {},
        },
        Object {
          "#": "github",
          "@": Object {},
        },
        Object {
          "#": "git",
          "@": Object {},
        },
        Object {
          "#": "web.py",
          "@": Object {},
        },
      ],
      "rss:description": Object {
        "#": "Update: This project is now on github: relekang/lumen My arduino has been collecting dust in a drawer for a while. This weekend I figured…",
        "@": Object {},
      },
      "rss:guid": Object {
        "#": "https://rolflekang.com/the-github-lamp",
        "@": Object {
          "ispermalink": "false",
        },
      },
      "rss:link": Object {
        "#": "https://rolflekang.com/the-github-lamp",
        "@": Object {},
      },
      "rss:pubdate": Object {
        "#": "Sun, 16 Sep 2012 00:00:00 GMT",
        "@": Object {},
      },
      "rss:title": Object {
        "#": "The Github lamp",
        "@": Object {},
      },
      "source": Object {},
      "summary": "Update: This project is now on github: relekang/lumen My arduino has been collecting dust in a drawer for a while. This weekend I figured…",
      "title": "The Github lamp",
    },
  ],
  "favicon": null,
  "generator": "GatsbyJS",
  "image": Object {},
  "language": null,
  "link": "https://rolflekang.com",
  "parser": "FEEDPARSER",
  "pubDate": 2020-09-12T14:51:45.000Z,
  "pubdate": 2020-09-12T14:51:45.000Z,
  "rss:@": Object {},
  "rss:description": Object {
    "#": "Writing by Rolf Erik Lekang",
    "@": Object {},
  },
  "rss:generator": Object {
    "#": "GatsbyJS",
    "@": Object {},
  },
  "rss:lastbuilddate": Object {
    "#": "Sat, 12 Sep 2020 14:51:45 GMT",
    "@": Object {},
  },
  "rss:link": Object {
    "#": "https://rolflekang.com",
    "@": Object {},
  },
  "rss:title": Object {
    "#": "Writing by Rolf Erik Lekang",
    "@": Object {},
  },
  "title": "Writing by Rolf Erik Lekang",
  "xmlUrl": null,
  "xmlurl": null,
}
`;
